/*!
 * Application Insights JavaScript SDK - Dependencies Plugin, 2.2.4
 * Copyright (c) Microsoft and contributors. All rights reserved.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e.Microsoft=e.Microsoft||{},e.Microsoft.ApplicationInsights={}))}(this,function(e){"use strict";var r,t,p,n,s,i;(t=r=r||{})[t.LocalStorage=0]="LocalStorage",t[t.SessionStorage=1]="SessionStorage",(n=p=p||{})[n.Default=0]="Default",n[n.Required=1]="Required",n[n.Array=2]="Array",n[n.Hidden=4]="Hidden",(i=s=s||{})[i.AI=0]="AI",i[i.AI_AND_W3C=1]="AI_AND_W3C",i[i.W3C=2]="W3C";var a=2,o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function c(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var l=function(){return(l=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},u=(d.isNullOrUndefined=function(e){return null==e},d.disableCookies=function(){d._canUseCookies=!1},d.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(h,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},d);function d(){}var h=/[xy]/g,f=(g.prototype.processTelemetry=function(t){this.channelQueue.forEach(function(e){0<e.length&&e[0].processTelemetry(t)})},Object.defineProperty(g.prototype,"ChannelControls",{get:function(){return this.channelQueue},enumerable:!0,configurable:!0}),g.prototype.initialize=function(n,i,r){var a,o=this;n.isCookieUseDisabled&&u.disableCookies(),this.channelQueue=new Array,n.channels&&n.channels.forEach(function(e){if(e&&0<e.length){e=e.sort(function(e,t){return e.priority-t.priority});for(var t=1;t<e.length;t++)e[t-1].setNextPlugin(e[t]);if(e.forEach(function(e){e.priority<500&&(a=e.identifier),e.initialize(n,i,r)}),a)throw Error("Channel has invalid priority"+a);o.channelQueue.push(e)}});for(var e=new Array,t=0;t<r.length;t++){var s=r[t];500<s.priority&&e.push(s)}if(0<e.length){for(e=e.sort(function(e,t){return e.priority-t.priority}),t=1;t<e.length;t++)e[t-1].setNextPlugin(e[t]);e.forEach(function(e){return e.initialize(n,i,r)}),this.channelQueue.push(e)}},g);function g(){this.identifier="ChannelControllerPlugin",this.priority=500}var m=(v.prototype.initialize=function(e,t,n,i){var r=this;if(this._isInitialized)throw Error("Core should not be initialized more than once");if(!e||u.isNullOrUndefined(e.instrumentationKey))throw Error("Please provide instrumentation key");this.config=e,this._notificationManager=i,this._notificationManager||(this._notificationManager=Object.create({addNotificationListener:function(e){},removeNotificationListener:function(e){},eventsSent:function(e){},eventsDiscarded:function(e,t){}})),this.config.extensions=u.isNullOrUndefined(this.config.extensions)?[]:this.config.extensions,this.config.extensionConfig=u.isNullOrUndefined(this.config.extensionConfig)?{}:this.config.extensionConfig,this._notificationManager&&(this.config.extensionConfig.NotificationManager=this._notificationManager),this.logger=n,this.logger||(this.logger=Object.create({throwInternal:function(e,t,n,i,r){void 0===r&&(r=!1)},warnToConsole:function(e){},resetInternalMessageCount:function(){}})),(o=this._extensions).push.apply(o,t.concat(this.config.extensions)),this._extensions.forEach(function(e){var t=!0;if((u.isNullOrUndefined(e)||u.isNullOrUndefined(e.initialize))&&(t=!1),!t)throw Error("Extensions must provide callback to initialize")}),this._extensions.push(this._channelController),this._extensions=this._extensions.sort(function(e,t){var n=e,i=t,r=typeof n.processTelemetry,a=typeof i.processTelemetry;return"function"==r&&"function"==a?n.priority-i.priority:"function"==r&&"function"!=a?1:"function"!=r&&"function"==a?-1:void 0});var a={};this._extensions.forEach(function(e){var t=e;t&&t.priority&&(u.isNullOrUndefined(a[t.priority])?a[t.priority]=t.identifier:r.logger&&r.logger.warnToConsole("Two extensions have same priority"+a[t.priority]+", "+t.identifier))});for(var o,s=-1,c=0;c<this._extensions.length-1;c++){var l=this._extensions[c];if(!l||"function"==typeof l.processTelemetry){if(l.priority===this._channelController.priority){s=c+1;break}this._extensions[c].setNextPlugin(this._extensions[c+1])}}if(this._channelController.initialize(this.config,this,this._extensions),this._extensions.forEach(function(e){e&&e.priority<r._channelController.priority&&e.initialize(r.config,r,r._extensions)}),s<this._extensions.length&&this._extensions.splice(s),0===this.getTransmissionControls().length)throw new Error("No channels available");this._isInitialized=!0},v.prototype.getTransmissionControls=function(){return this._channelController.ChannelControls},v.prototype.track=function(e){e.iKey||(e.iKey=this.config.instrumentationKey),e.time||(e.time=(new Date).toISOString()),u.isNullOrUndefined(e.ver)&&(e.ver="4.0"),0===this._extensions.length&&this._channelController.processTelemetry(e);for(var t=0;t<this._extensions.length;){if(this._extensions[t].processTelemetry){this._extensions[t].processTelemetry(e);break}t++}},v);function v(){this._isInitialized=!1,this._extensions=new Array,this._channelController=new f}var x,y,I=(D.prototype.addNotificationListener=function(e){this.listeners.push(e)},D.prototype.removeNotificationListener=function(e){for(var t=this.listeners.indexOf(e);-1<t;)this.listeners.splice(t,1),t=this.listeners.indexOf(e)},D.prototype.eventsSent=function(t){for(var n=this,e=function(e){i.listeners[e].eventsSent&&setTimeout(function(){return n.listeners[e].eventsSent(t)},0)},i=this,r=0;r<this.listeners.length;++r)e(r)},D.prototype.eventsDiscarded=function(t,n){for(var i=this,e=function(e){r.listeners[e].eventsDiscarded&&setTimeout(function(){return i.listeners[e].eventsDiscarded(t,n)},0)},r=this,a=0;a<this.listeners.length;++a)e(a)},D);function D(){this.listeners=[]}(y=x=x||{})[y.CRITICAL=1]="CRITICAL",y[y.WARNING=2]="WARNING";var _=1,C=2,S=3,N=4,A=5,b=6,w=13,T=14,M=15,q=16,R=17,H=18,E=23,L=49,j=52,U=55,k=56,O=57,F=61,z=66,P=68,G=69,W=71,X=(V.sanitizeDiagnosticText=function(e){return'"'+e.replace(/\"/g,"")+'"'},V.dataType="MessageData",V.AiNonUserActionablePrefix="AI (Internal): ",V.AiUserActionablePrefix="AI: ",V);function V(e,t,n,i){void 0===n&&(n=!1),this.messageId=e,this.message=(n?V.AiUserActionablePrefix:V.AiNonUserActionablePrefix)+e;var r=(t?" message:"+V.sanitizeDiagnosticText(t):"")+(i?" props:"+V.sanitizeDiagnosticText(JSON.stringify(i)):"");this.message+=r}var B=(K.prototype.throwInternal=function(e,t,n,i,r){void 0===r&&(r=!1);var a=new X(t,n,r,i);if(this.enableDebugExceptions())throw a;if(void 0!==a&&a&&void 0!==a.message){if(r){var o=+a.messageId;(!this._messageLogged[o]||this.consoleLoggingLevel()>=x.WARNING)&&(this.warnToConsole(a.message),this._messageLogged[o]=!0)}else this.consoleLoggingLevel()>=x.WARNING&&this.warnToConsole(a.message);this.logInternalMessage(e,a)}},K.prototype.warnToConsole=function(e){"undefined"!=typeof console&&console&&("function"==typeof console.warn?console.warn(e):"function"==typeof console.log&&console.log(e))},K.prototype.resetInternalMessageCount=function(){this._messageCount=0,this._messageLogged={}},K.prototype.logInternalMessage=function(e,t){if(!this._areInternalMessagesThrottled()){var n=!0,i=this.AIInternalMessagePrefix+t.messageId;if(this._messageLogged[i]?n=!1:this._messageLogged[i]=!0,n&&(e<=this.telemetryLoggingLevel()&&(this.queue.push(t),this._messageCount++),this._messageCount===this.maxInternalMessageLimit())){var r="Internal events throttle limit per PageView reached for this app.",a=new X(E,r,!1);this.queue.push(a),this.warnToConsole(r)}}},K.prototype._areInternalMessagesThrottled=function(){return this._messageCount>=this.maxInternalMessageLimit()},K);function K(e){this.queue=[],this.AIInternalMessagePrefix="AITR_",this._messageCount=0,this._messageLogged={},this.enableDebugExceptions=function(){return!1},this.consoleLoggingLevel=function(){return 0},this.telemetryLoggingLevel=function(){return 1},this.maxInternalMessageLimit=function(){return 25},u.isNullOrUndefined(e)||(u.isNullOrUndefined(e.loggingLevelConsole)||(this.consoleLoggingLevel=function(){return e.loggingLevelConsole}),u.isNullOrUndefined(e.loggingLevelTelemetry)||(this.telemetryLoggingLevel=function(){return e.loggingLevelTelemetry}),u.isNullOrUndefined(e.maxMessageLimit)||(this.maxInternalMessageLimit=function(){return e.maxMessageLimit}),u.isNullOrUndefined(e.enableDebugExceptions)||(this.enableDebugExceptions=function(){return e.enableDebugExceptions}))}var J;c(Q,J=m),Q.prototype.initialize=function(e,t){this._notificationManager=new I,this.logger=new B(e),this.config=e,J.prototype.initialize.call(this,e,t,this.logger,this._notificationManager)},Q.prototype.getTransmissionControls=function(){return J.prototype.getTransmissionControls.call(this)},Q.prototype.track=function(e){if(null===e)throw this._notifyInvalidEvent(e),Error("Invalid telemetry item");this._validateTelemetryItem(e),J.prototype.track.call(this,e)},Q.prototype.addNotificationListener=function(e){this._notificationManager&&this._notificationManager.addNotificationListener(e)},Q.prototype.removeNotificationListener=function(e){this._notificationManager&&this._notificationManager.removeNotificationListener(e)},Q.prototype.pollInternalLogs=function(n){var i=this,e=this.config.diagnosticLogInterval;return 0<e||(e=1e4),setInterval(function(){var e=i.logger?i.logger.queue:[];e.forEach(function(e){var t={name:n||"InternalMessageId: "+e.messageId,iKey:i.config.instrumentationKey,time:(new Date).toISOString(),baseType:X.dataType,baseData:{message:e.message}};i.track(t)}),e.length=0},e)},Q.prototype._validateTelemetryItem=function(e){if(u.isNullOrUndefined(e.name))throw this._notifyInvalidEvent(e),Error("telemetry name required")},Q.prototype._notifyInvalidEvent=function(e){this._notificationManager&&this._notificationManager.eventsDiscarded([e],a)};function Q(){return J.call(this)||this}var $=(Y.requestContextHeader="Request-Context",Y.requestContextTargetKey="appId",Y.requestContextAppIdFormat="appId=cid-v1:",Y.requestIdHeader="Request-Id",Y.traceParentHeader="traceparent",Y.sdkContextHeader="Sdk-Context",Y.sdkContextHeaderAppIdRequest="appId",Y.requestContextHeaderLowerCase="request-context",Y);function Y(){}var Z=(ee.sanitizeKeyAndAddUniqueness=function(e,t,n){var i=t.length,r=ee.sanitizeKey(e,t);if(r.length!==i){for(var a=0,o=r;void 0!==n[o];)a++,o=r.substring(0,ee.MAX_NAME_LENGTH-3)+ee.padNumber(a);r=o}return r},ee.sanitizeKey=function(e,t){var n;return t&&(t=ee.trim(t.toString())).length>ee.MAX_NAME_LENGTH&&(n=t.substring(0,ee.MAX_NAME_LENGTH),e.throwInternal(x.WARNING,O,"name is too long.  It has been truncated to "+ee.MAX_NAME_LENGTH+" characters.",{name:t},!0)),n||t},ee.sanitizeString=function(e,t,n){var i;return void 0===n&&(n=ee.MAX_STRING_LENGTH),t&&(n=n||ee.MAX_STRING_LENGTH,(t=ee.trim(t)).toString().length>n&&(i=t.toString().substring(0,n),e.throwInternal(x.WARNING,F,"string value is too long. It has been truncated to "+n+" characters.",{value:t},!0))),i||t},ee.sanitizeUrl=function(e,t){return ee.sanitizeInput(e,t,ee.MAX_URL_LENGTH,z)},ee.sanitizeMessage=function(e,t){var n;return t&&t.length>ee.MAX_MESSAGE_LENGTH&&(n=t.substring(0,ee.MAX_MESSAGE_LENGTH),e.throwInternal(x.WARNING,k,"message is too long, it has been truncated to "+ee.MAX_MESSAGE_LENGTH+" characters.",{message:t},!0)),n||t},ee.sanitizeException=function(e,t){var n;return t&&t.length>ee.MAX_EXCEPTION_LENGTH&&(n=t.substring(0,ee.MAX_EXCEPTION_LENGTH),e.throwInternal(x.WARNING,j,"exception is too long, it has been truncated to "+ee.MAX_EXCEPTION_LENGTH+" characters.",{exception:t},!0)),n||t},ee.sanitizeProperties=function(t,e){if(e){var n={};for(var i in e){var r=e[i];if("object"==typeof r&&"undefined"!=typeof JSON)try{r=JSON.stringify(r)}catch(e){t.throwInternal(x.WARNING,L,"custom property is not valid",{exception:e},!0)}r=ee.sanitizeString(t,r,ee.MAX_PROPERTY_LENGTH),n[i=ee.sanitizeKeyAndAddUniqueness(t,i,n)]=r}e=n}return e},ee.sanitizeMeasurements=function(e,t){if(t){var n={};for(var i in t){var r=t[i];n[i=ee.sanitizeKeyAndAddUniqueness(e,i,n)]=r}t=n}return t},ee.sanitizeId=function(e,t){return t?ee.sanitizeInput(e,t,ee.MAX_ID_LENGTH,G).toString():t},ee.sanitizeInput=function(e,t,n,i){var r;return t&&(t=ee.trim(t)).length>n&&(r=t.substring(0,n),e.throwInternal(x.WARNING,i,"input is too long, it has been truncated to "+n+" characters.",{data:t},!0)),r||t},ee.padNumber=function(e){var t="00"+e;return t.substr(t.length-3)},ee.trim=function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"")},ee.MAX_NAME_LENGTH=150,ee.MAX_ID_LENGTH=128,ee.MAX_PROPERTY_LENGTH=8192,ee.MAX_STRING_LENGTH=1024,ee.MAX_URL_LENGTH=2048,ee.MAX_MESSAGE_LENGTH=32768,ee.MAX_EXCEPTION_LENGTH=32768,ee);function ee(){}var te=(ne.createDomEvent=function(e){var t=null;return"function"==typeof Event?t=new Event(e):(t=document.createEvent("Event")).initEvent(e,!0,!0),t},ne.disableStorage=function(){ne._canUseLocalStorage=!1,ne._canUseSessionStorage=!1},ne._getLocalStorageObject=function(){return ne.canUseLocalStorage()?ne._getVerifiedStorageObject(r.LocalStorage):null},ne._getVerifiedStorageObject=function(e){var t,n,i=null;try{if("undefined"==typeof window)return null;n=new Date,(i=e===r.LocalStorage?window.localStorage:window.sessionStorage).setItem(n.toString(),n.toString()),t=i.getItem(n.toString())!==n.toString(),i.removeItem(n.toString()),t&&(i=null)}catch(e){i=null}return i},ne.isInternalApplicationInsightsEndpoint=function(e){return-1!==ne._internalEndpoints.indexOf(e.toLowerCase())},ne.canUseLocalStorage=function(){return void 0===ne._canUseLocalStorage&&(ne._canUseLocalStorage=!!ne._getVerifiedStorageObject(r.LocalStorage)),ne._canUseLocalStorage},ne.getStorage=function(t,e){var n=ne._getLocalStorageObject();if(null!==n)try{return n.getItem(e)}catch(e){ne._canUseLocalStorage=!1,t.throwInternal(x.WARNING,_,"Browser failed read of local storage. "+ne.getExceptionName(e),{exception:ne.dump(e)})}return null},ne.setStorage=function(t,e,n){var i=ne._getLocalStorageObject();if(null!==i)try{return i.setItem(e,n),!0}catch(e){ne._canUseLocalStorage=!1,t.throwInternal(x.WARNING,S,"Browser failed write to local storage. "+ne.getExceptionName(e),{exception:ne.dump(e)})}return!1},ne.removeStorage=function(t,e){var n=ne._getLocalStorageObject();if(null!==n)try{return n.removeItem(e),!0}catch(e){ne._canUseLocalStorage=!1,t.throwInternal(x.WARNING,A,"Browser failed removal of local storage item. "+ne.getExceptionName(e),{exception:ne.dump(e)})}return!1},ne._getSessionStorageObject=function(){return ne.canUseSessionStorage()?ne._getVerifiedStorageObject(r.SessionStorage):null},ne.canUseSessionStorage=function(){return void 0===ne._canUseSessionStorage&&(ne._canUseSessionStorage=!!ne._getVerifiedStorageObject(r.SessionStorage)),ne._canUseSessionStorage},ne.getSessionStorageKeys=function(){var e=[];if(ne.canUseSessionStorage())for(var t in window.sessionStorage)e.push(t);return e},ne.getSessionStorage=function(t,e){var n=ne._getSessionStorageObject();if(null!==n)try{return n.getItem(e)}catch(e){ne._canUseSessionStorage=!1,t.throwInternal(x.WARNING,C,"Browser failed read of session storage. "+ne.getExceptionName(e),{exception:ne.dump(e)})}return null},ne.setSessionStorage=function(t,e,n){var i=ne._getSessionStorageObject();if(null!==i)try{return i.setItem(e,n),!0}catch(e){ne._canUseSessionStorage=!1,t.throwInternal(x.WARNING,N,"Browser failed write to session storage. "+ne.getExceptionName(e),{exception:ne.dump(e)})}return!1},ne.removeSessionStorage=function(t,e){var n=ne._getSessionStorageObject();if(null!==n)try{return n.removeItem(e),!0}catch(e){ne._canUseSessionStorage=!1,t.throwInternal(x.WARNING,b,"Browser failed removal of session storage item. "+ne.getExceptionName(e),{exception:ne.dump(e)})}return!1},ne.disableCookies=function(){u.disableCookies()},ne.canUseCookies=function(t){if(void 0===u._canUseCookies){u._canUseCookies=!1;try{u._canUseCookies=void 0!==ne.document.cookie}catch(e){t.throwInternal(x.WARNING,P,"Cannot access document.cookie - "+ne.getExceptionName(e),{exception:ne.dump(e)})}}return u._canUseCookies},ne.setCookie=function(e,t,n,i){var r="",a="";i&&(r=";domain="+i),ne.document.location&&"https:"===ne.document.location.protocol&&(a=";secure"),ne.canUseCookies(e)&&(ne.document.cookie=t+"="+n+r+";path=/"+a)},ne.stringToBoolOrDefault=function(e,t){return void 0===t&&(t=!1),null==e?t:"true"===e.toString().toLowerCase()},ne.getCookie=function(e,t){if(ne.canUseCookies(e)){var n="";if(t&&t.length)for(var i=t+"=",r=ne.document.cookie.split(";"),a=0;a<r.length;a++){var o=r[a];if((o=ne.trim(o))&&0===o.indexOf(i)){n=o.substring(i.length,r[a].length);break}}return n}},ne.deleteCookie=function(e,t){ne.canUseCookies(e)&&(ne.document.cookie=t+"=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;")},ne.trim=function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"")},ne.newId=function(){for(var e="",t=1073741824*Math.random();0<t;)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t%64),t=Math.floor(t/64);return e},ne.random32=function(){return 4294967296*Math.random()|0},ne.generateW3CId=function(){for(var e,t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n="",i=0;i<4;i++)n+=t[15&(e=ne.random32())]+t[e>>4&15]+t[e>>8&15]+t[e>>12&15]+t[e>>16&15]+t[e>>20&15]+t[e>>24&15]+t[e>>28&15];var r=t[8+4*Math.random()|0];return n.substr(0,8)+n.substr(9,4)+"4"+n.substr(13,3)+r+n.substr(16,3)+n.substr(19,12)},ne.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},ne.isError=function(e){return"[object Error]"===Object.prototype.toString.call(e)},ne.isDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)},ne.toISOStringForIE8=function(e){if(ne.isDate(e)){if(Date.prototype.toISOString)return e.toISOString();var t=function(e){var t=String(e);return 1===t.length&&(t="0"+t),t};return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}},ne.getIEVersion=function(e){void 0===e&&(e=null);var t=e?e.toLowerCase():navigator.userAgent.toLowerCase();return-1!==t.indexOf("msie")?parseInt(t.split("msie")[1]):null},ne.msToTimeSpan=function(e){(isNaN(e)||e<0)&&(e=0);var t=""+(e=Math.round(e))%1e3,n=""+Math.floor(e/1e3)%60,i=""+Math.floor(e/6e4)%60,r=""+Math.floor(e/36e5)%24,a=Math.floor(e/864e5);return t=1===t.length?"00"+t:2===t.length?"0"+t:t,n=n.length<2?"0"+n:n,i=i.length<2?"0"+i:i,(0<a?a+".":"")+(r=r.length<2?"0"+r:r)+":"+i+":"+n+"."+t},ne.isCrossOriginError=function(e,t,n,i,r){return("Script error."===e||"Script error"===e)&&!r},ne.dump=function(e){var t=Object.prototype.toString.call(e),n=JSON.stringify(e);return"[object Error]"===t&&(n="{ stack: '"+e.stack+"', message: '"+e.message+"', name: '"+e.name+"'"),t+n},ne.getExceptionName=function(e){return"[object Error]"===Object.prototype.toString.call(e)?e.name:""},ne.addEventHandler=function(e,t){if("undefined"==typeof window||!window||"string"!=typeof e||"function"!=typeof t)return!1;var n="on"+e;if(window.addEventListener)window.addEventListener(e,t,!1);else{if(!window.attachEvent)return!1;window.attachEvent(n,t)}return!0},ne.IsBeaconApiSupported=function(){return"sendBeacon"in navigator&&navigator.sendBeacon},ne.getExtension=function(e,t){for(var n=null,i=0;!n&&i<e.length;)e[i]&&e[i].identifier===t&&(n=e[i]),i++;return n},ne.document="undefined"!=typeof document?document:{},ne._canUseLocalStorage=void 0,ne._canUseSessionStorage=void 0,ne._internalEndpoints=["https://dc.services.visualstudio.com/v2/track","https://breeze.aimon.applicationinsights.io/v2/track","https://dc-int.services.visualstudio.com/v2/track"],ne.NotSpecified="not_specified",ne);function ne(){}var ie=(re.parseUrl=function(e){return re.htmlAnchorElement||(re.htmlAnchorElement=re.document.createElement?re.document.createElement("a"):{host:re.parseHost(e)}),re.htmlAnchorElement.href=e,re.htmlAnchorElement},re.getAbsoluteUrl=function(e){var t,n=re.parseUrl(e);return n&&(t=n.href),t},re.getPathName=function(e){var t,n=re.parseUrl(e);return n&&(t=n.pathname),t},re.getCompleteUrl=function(e,t){return e?e.toUpperCase()+" "+t:t},re.parseHost=function(e){var t=e.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!=t&&2<t.length&&"string"==typeof t[2]&&0<t[2].length?t[2]:null},re.document="undefined"!=typeof document?document:{},re);function re(){}var ae=(oe.canIncludeCorrelationHeader=function(e,t,n){if(e&&e.disableCorrelationHeaders)return!1;if(!t)return!1;var i=ie.parseUrl(t).host.toLowerCase();if(!(e&&e.enableCorsCorrelation||i===n))return!1;var r,a=e&&e.correlationHeaderDomains;if(a&&(a.forEach(function(e){var t=new RegExp(e.toLowerCase().replace(/\./g,".").replace(/\*/g,".*"));r=r||t.test(i)}),!r))return!1;var o=e&&e.correlationHeaderExcludedDomains;if(!o||0===o.length)return!0;for(var s=0;s<o.length;s++)if(new RegExp(o[s].toLowerCase().replace(/\./g,".").replace(/\*/g,".*")).test(i))return!1;return!0},oe.getCorrelationContext=function(e){if(e){var t=oe.getCorrelationContextValue(e,$.requestContextTargetKey);if(t&&t!==oe.correlationIdPrefix)return t}},oe.getCorrelationContextValue=function(e,t){if(e)for(var n=e.split(","),i=0;i<n.length;++i){var r=n[i].split("=");if(2===r.length&&r[0]===t)return r[1]}},oe.correlationIdPrefix="cid-v1:",oe);function oe(){}var se=(ce.ParseDependencyPath=function(e,t,n,i){var r,a=i,o=i;if(t&&0<t.length){var s=ie.parseUrl(t);if(r=s.host,!a)if(null!=s.pathname){var c=0===s.pathname.length?"/":s.pathname;"/"!==c.charAt(0)&&(c="/"+c),o=s.pathname,a=Z.sanitizeString(e,n?n+" "+c:c)}else a=Z.sanitizeString(e,t)}else a=r=i;return{target:r,name:a,data:o}},ce);function ce(){}var le=(ue.Now="undefined"==typeof window?function(){return(new Date).getTime()}:window.performance&&window.performance.now&&window.performance.timing?function(){return window.performance.now()+window.performance.timing.navigationStart}:function(){return(new Date).getTime()},ue.GetDuration=function(e,t){var n=null;return 0===e||0===t||u.isNullOrUndefined(e)||u.isNullOrUndefined(t)||(n=t-e),n},ue);function ue(){}var de,he="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",fe=(c(pe,de=function(){}),pe);function pe(){return de.call(this)||this}var ge;c(me,ge=function(){this.ver=1,this.sampleRate=100,this.tags={}});function me(e,t,n){var i=ge.call(this)||this;return i.name=Z.sanitizeString(e,n)||te.NotSpecified,i.data=t,i.time=te.toISOStringForIE8(new Date),i.aiDataContract={time:p.Required,iKey:p.Required,name:p.Required,sampleRate:function(){return 100===i.sampleRate?p.Hidden:p.Required},tags:p.Required,data:p.Required},i}function ve(){}var xe,ye=(c(Ie,xe=ve),Ie);function Ie(){var e=xe.call(this)||this;return e.ver=2,e.properties={},e.measurements={},e}var De;c(_e,De=ye),_e.envelopeType="Microsoft.ApplicationInsights.{0}.Event",_e.dataType="EventData";function _e(e,t,n,i){var r=De.call(this)||this;return r.aiDataContract={ver:p.Required,name:p.Required,properties:p.Default,measurements:p.Default},r.name=Z.sanitizeString(e,t)||te.NotSpecified,r.properties=Z.sanitizeProperties(e,n),r.measurements=Z.sanitizeMeasurements(e,i),r}function Ce(){}var Se,Ne=(c(Ae,Se=ve),Ae);function Ae(){var e=Se.call(this)||this;return e.ver=2,e.exceptions=[],e.properties={},e.measurements={},e}function be(){this.hasFullStack=!0,this.parsedStack=[]}var we;c(Te,we=Ne),Te.CreateFromInterface=function(t,e){var n=e.exceptions&&e.exceptions.map(function(e){return qe.CreateFromInterface(t,e)});return new Te(t,l({},e,{exceptions:n}))},Te.prototype.toInterface=function(){var e=this,t=e.exceptions,n=e.properties,i=e.measurements,r=e.severityLevel,a=(e.ver,e.problemGroup),o=e.id,s=e.isManual;return{ver:"4.0",exceptions:t instanceof Array&&t.map(function(e){return e.toInterface()})||void 0,severityLevel:r,properties:n,measurements:i,problemGroup:a,id:o,isManual:s}},Te.CreateSimpleException=function(e,t,n,i,r,a){return{exceptions:[{hasFullStack:!0,message:e,stack:r,typeName:t}]}},Te.envelopeType="Microsoft.ApplicationInsights.{0}.Exception",Te.dataType="ExceptionData";function Te(e,t,n,i,r,a){var o=we.call(this)||this;return o.aiDataContract={ver:p.Required,exceptions:p.Required,severityLevel:p.Default,properties:p.Default,measurements:p.Default},t instanceof Error?(o.exceptions=[new qe(e,t)],o.properties=Z.sanitizeProperties(e,n),o.measurements=Z.sanitizeMeasurements(e,i),r&&(o.severityLevel=r),a&&(o.id=a)):(o.exceptions=t.exceptions,o.properties=t.properties,o.measurements=t.measurements,t.severityLevel&&(o.severityLevel=t.severityLevel),t.id&&(o.id=t.id),t.problemGroup&&(o.problemGroup=t.problemGroup),o.ver=2,u.isNullOrUndefined(t.isManual)||(o.isManual=t.isManual)),o}var Me,qe=(c(Re,Me=be),Re.prototype.toInterface=function(){var e=this.parsedStack instanceof Array&&this.parsedStack.map(function(e){return e.toInterface()});return{id:this.id,outerId:this.outerId,typeName:this.typeName,message:this.message,hasFullStack:this.hasFullStack,stack:this.stack,parsedStack:e||void 0}},Re.CreateFromInterface=function(e,t){var n=t.parsedStack instanceof Array&&t.parsedStack.map(function(e){return Ee.CreateFromInterface(e)})||t.parsedStack;return new Re(e,l({},t,{parsedStack:n}))},Re.parseStack=function(e){var t;if("string"==typeof e){var n=e.split("\n");t=[];for(var i=0,r=0,a=0;a<=n.length;a++){var o=n[a];if(Ee.regex.test(o)){var s=new Ee(n[a],i++);r+=s.sizeInBytes,t.push(s)}}if(32768<r)for(var c=0,l=t.length-1,u=0,d=c,h=l;c<l;){if(32768<(u+=t[c].sizeInBytes+t[l].sizeInBytes)){var f=h-d+1;t.splice(d,f);break}d=c,h=l,c++,l--}}return t},Re);function Re(e,t){var n=Me.call(this)||this;if(n.aiDataContract={id:p.Default,outerId:p.Default,typeName:p.Required,message:p.Required,hasFullStack:p.Default,stack:p.Default,parsedStack:p.Array},t instanceof Error){n.typeName=Z.sanitizeString(e,t.name)||te.NotSpecified,n.message=Z.sanitizeMessage(e,t.message)||te.NotSpecified;var i=t.stack;n.parsedStack=Re.parseStack(i),n.stack=Z.sanitizeException(e,i),n.hasFullStack=te.isArray(n.parsedStack)&&0<n.parsedStack.length}else n.typeName=t.typeName,n.message=t.message,n.stack=t.stack,n.parsedStack=t.parsedStack,n.hasFullStack=t.hasFullStack;return n}var He,Ee=(c(Le,He=Ce),Le.CreateFromInterface=function(e){return new Le(e,null)},Le.prototype.toInterface=function(){return{level:this.level,method:this.method,assembly:this.assembly,fileName:this.fileName,line:this.line}},Le.regex=/^([\s]+at)?(.*?)(\@|\s\(|\s)([^\(\@\n]+):([0-9]+):([0-9]+)(\)?)$/,Le.baseSize=58,Le);function Le(e,t){var n=He.call(this)||this;if(n.sizeInBytes=0,n.aiDataContract={level:p.Required,method:p.Required,assembly:p.Default,fileName:p.Default,line:p.Default},"string"==typeof e){var i=e;n.level=t,n.method="<no_method>",n.assembly=te.trim(i),n.fileName="",n.line=0;var r=i.match(Le.regex);r&&5<=r.length&&(n.method=te.trim(r[2])||n.method,n.fileName=te.trim(r[4]),n.line=parseInt(r[5])||0)}else n.level=e.level,n.method=e.method,n.assembly=e.assembly,n.fileName=e.fileName,n.line=e.line,n.sizeInBytes=0;return n.sizeInBytes+=n.method.length,n.sizeInBytes+=n.fileName.length,n.sizeInBytes+=n.assembly.length,n.sizeInBytes+=Le.baseSize,n.sizeInBytes+=n.level.toString().length,n.sizeInBytes+=n.line.toString().length,n}var je,Ue,ke,Oe=(c(Fe,je=ve),Fe);function Fe(){var e=je.call(this)||this;return e.ver=2,e.metrics=[],e.properties={},e}(ke=Ue=Ue||{})[ke.Measurement=0]="Measurement",ke[ke.Aggregation=1]="Aggregation";var ze,Pe=(c(Ge,ze=function(){this.kind=Ue.Measurement}),Ge);function Ge(){var e=null!==ze&&ze.apply(this,arguments)||this;return e.aiDataContract={name:p.Required,kind:p.Default,value:p.Required,count:p.Default,min:p.Default,max:p.Default,stdDev:p.Default},e}var We;c(Xe,We=Oe),Xe.envelopeType="Microsoft.ApplicationInsights.{0}.Metric",Xe.dataType="MetricData";function Xe(e,t,n,i,r,a,o){var s=We.call(this)||this;s.aiDataContract={ver:p.Required,metrics:p.Required,properties:p.Default};var c=new Pe;return c.count=0<i?i:void 0,c.max=isNaN(a)||null===a?void 0:a,c.min=isNaN(r)||null===r?void 0:r,c.name=Z.sanitizeString(e,t)||te.NotSpecified,c.value=n,s.metrics=[c],s.properties=Z.sanitizeProperties(e,o),s}var Ve,Be=(c(Ke,Ve=ye),Ke);function Ke(){var e=Ve.call(this)||this;return e.ver=2,e.properties={},e.measurements={},e}var Je;c(Qe,Je=Be),Qe.envelopeType="Microsoft.ApplicationInsights.{0}.Pageview",Qe.dataType="PageviewData";function Qe(e,t,n,i,r,a,o){var s=Je.call(this)||this;return s.aiDataContract={ver:p.Required,name:p.Default,url:p.Default,duration:p.Default,properties:p.Default,measurements:p.Default,id:p.Default},s.id=Z.sanitizeId(e,o),s.url=Z.sanitizeUrl(e,n),s.name=Z.sanitizeString(e,t)||te.NotSpecified,isNaN(i)||(s.duration=te.msToTimeSpan(i)),s.properties=Z.sanitizeProperties(e,r),s.measurements=Z.sanitizeMeasurements(e,a),s}var $e,Ye=(c(Ze,$e=ve),Ze);function Ze(){var e=$e.call(this)||this;return e.ver=2,e.success=!0,e.properties={},e.measurements={},e}var et,tt=(c(nt,et=Ye),nt.envelopeType="Microsoft.ApplicationInsights.{0}.RemoteDependency",nt.dataType="RemoteDependencyData",nt);function nt(e,t,n,i,r,a,o,s,c,l,u,d){void 0===c&&(c="Ajax");var h=et.call(this)||this;h.aiDataContract={id:p.Required,ver:p.Required,name:p.Default,resultCode:p.Default,duration:p.Default,success:p.Default,data:p.Default,target:p.Default,type:p.Default,properties:p.Default,measurements:p.Default,kind:p.Default,value:p.Default,count:p.Default,min:p.Default,max:p.Default,stdDev:p.Default,dependencyKind:p.Default,dependencySource:p.Default,commandName:p.Default,dependencyTypeName:p.Default},h.id=t,h.duration=te.msToTimeSpan(r),h.success=a,h.resultCode=o+"",h.type=Z.sanitizeString(e,c);var f=se.ParseDependencyPath(e,n,s,i);return h.data=Z.sanitizeUrl(e,i)||f.data,h.target=Z.sanitizeString(e,f.target),l&&(h.target=h.target+" | "+l),h.name=Z.sanitizeString(e,f.name),h.properties=Z.sanitizeProperties(e,u),h.measurements=Z.sanitizeMeasurements(e,d),h}var it,rt=(c(at,it=ve),at);function at(){var e=it.call(this)||this;return e.ver=2,e.properties={},e}var ot;c(st,ot=rt),st.envelopeType="Microsoft.ApplicationInsights.{0}.Message",st.dataType="MessageData";function st(e,t,n,i){var r=ot.call(this)||this;return r.aiDataContract={ver:p.Required,message:p.Required,severityLevel:p.Default,properties:p.Default},t=t||te.NotSpecified,r.message=Z.sanitizeMessage(e,t),r.properties=Z.sanitizeProperties(e,i),n&&(r.severityLevel=n),r}var ct,lt=(c(ut,ct=Be),ut);function ut(){var e=ct.call(this)||this;return e.ver=2,e.properties={},e.measurements={},e}var dt;c(ht,dt=lt),ht.envelopeType="Microsoft.ApplicationInsights.{0}.PageviewPerformance",ht.dataType="PageviewPerformanceData";function ht(e,t,n,i,r,a,o){var s=dt.call(this)||this;return s.aiDataContract={ver:p.Required,name:p.Default,url:p.Default,duration:p.Default,perfTotal:p.Default,networkConnect:p.Default,sentRequest:p.Default,receivedResponse:p.Default,domProcessing:p.Default,properties:p.Default,measurements:p.Default},s.url=Z.sanitizeUrl(e,n),s.name=Z.sanitizeString(e,t)||te.NotSpecified,s.properties=Z.sanitizeProperties(e,r),s.measurements=Z.sanitizeMeasurements(e,a),o&&(s.domProcessing=o.domProcessing,s.duration=o.duration,s.networkConnect=o.networkConnect,s.perfTotal=o.perfTotal,s.receivedResponse=o.receivedResponse,s.sentRequest=o.sentRequest),s}var ft,pt,gt;c(mt,ft=fe);function mt(e,t){var n=ft.call(this)||this;return n.aiDataContract={baseType:p.Required,baseData:p.Required},n.baseType=e,n.baseData=t,n}(gt=pt=pt||{})[gt.Verbose=0]="Verbose",gt[gt.Information=1]="Information",gt[gt.Warning=2]="Warning",gt[gt.Error=3]="Error",gt[gt.Critical=4]="Critical";var vt=(xt.getConfig=function(e,t,n,i){var r;return void 0===i&&(i=!1),r=n&&e.extensionConfig&&e.extensionConfig[n]&&!u.isNullOrUndefined(e.extensionConfig[n][t])?e.extensionConfig[n][t]:e[t],u.isNullOrUndefined(r)?i:r},xt);function xt(){}var yt=(It.create=function(e,t,n,i,r,a){if(n=Z.sanitizeString(i,n)||te.NotSpecified,u.isNullOrUndefined(e)||u.isNullOrUndefined(t)||u.isNullOrUndefined(n))throw Error("Input doesn't contain all required fields");var o={name:n,time:(new Date).toISOString(),iKey:"",ext:a||{},tags:[],data:{},baseType:t,baseData:e};if(!u.isNullOrUndefined(r))for(var s in r)r.hasOwnProperty(s)&&(o.data[s]=r[s]);return o},It);function It(){}var Dt=function(){this.openDone=!1,this.setRequestHeaderDone=!1,this.sendDone=!1,this.abortDone=!1,this.onreadystatechangeCallbackAttached=!1},_t=(Ct.prototype.getAbsoluteUrl=function(){return this.requestUrl?ie.getAbsoluteUrl(this.requestUrl):null},Ct.prototype.getPathName=function(){return this.requestUrl?Z.sanitizeUrl(this._logger,ie.getCompleteUrl(this.method,this.requestUrl)):null},Ct);function Ct(e,t,n){this.completed=!1,this.requestHeadersSize=null,this.requestHeaders=null,this.ttfb=null,this.responseReceivingDuration=null,this.callbackDuration=null,this.ajaxTotalDuration=null,this.aborted=null,this.pageUrl=null,this.requestUrl=null,this.requestSize=0,this.method=null,this.status=null,this.requestSentTime=null,this.responseStartedTime=null,this.responseFinishedTime=null,this.callbackFinishedTime=null,this.endTime=null,this.originalOnreadystatechage=null,this.xhrMonitoringState=new Dt,this.clientFailure=0,this.CalculateMetrics=function(){this.ajaxTotalDuration=Math.round(1e3*le.GetDuration(this.requestSentTime,this.responseFinishedTime))/1e3},this.traceID=e,this.spanID=t,this._logger=n}var St=(Nt.AttachEvent=function(e,t,n){var i=!1;return u.isNullOrUndefined(e)||(u.isNullOrUndefined(e.attachEvent)?u.isNullOrUndefined(e.addEventListener)||(e.addEventListener(t,n,!1),i=!0):(e.attachEvent("on"+t,n),i=!0)),i},Nt.DetachEvent=function(e,t,n){u.isNullOrUndefined(e)||(u.isNullOrUndefined(e.detachEvent)?u.isNullOrUndefined(e.removeEventListener)||e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n))},Nt);function Nt(){}var At=(bt.isValidTraceId=function(e){return e.match(/^[0-9a-f]{32}$/)&&"00000000000000000000000000000000"!==e},bt.isValidSpanId=function(e){return e.match(/^[0-9a-f]{16}$/)&&"0000000000000000"!==e},bt.prototype.toString=function(){return this.version+"-"+this.traceId+"-"+this.spanId+"-"+this.traceFlag},bt.DEFAULT_TRACE_FLAG="01",bt.DEFAULT_VERSION="00",bt);function bt(e,t){this.traceFlag=bt.DEFAULT_TRACE_FLAG,this.version=bt.DEFAULT_VERSION,e&&bt.isValidTraceId(e)?this.traceId=e:this.traceId=te.generateW3CId(),t&&bt.isValidSpanId(t)?this.spanId=t:this.spanId=te.generateW3CId().substr(0,16)}var wt=(Tt.getDefaultConfig=function(){return{maxAjaxCallsPerView:500,disableAjaxTracking:!1,disableFetchTracking:!0,disableCorrelationHeaders:!1,distributedTracingMode:s.AI,correlationHeaderExcludedDomains:["*.blob.core.windows.net","*.blob.core.chinacloudapi.cn","*.blob.core.cloudapi.de","*.blob.core.usgovcloudapi.net"],correlationHeaderDomains:void 0,appId:void 0,enableCorsCorrelation:!1,enableRequestHeaderTracking:!1,enableResponseHeaderTracking:!1}},Tt.getEmptyConfig=function(){return{maxAjaxCallsPerView:void 0,disableAjaxTracking:void 0,disableFetchTracking:void 0,disableCorrelationHeaders:void 0,distributedTracingMode:void 0,correlationHeaderExcludedDomains:void 0,appId:void 0,enableCorsCorrelation:void 0,correlationHeaderDomains:void 0,enableRequestHeaderTracking:void 0,enableResponseHeaderTracking:void 0}},Tt.getFailedAjaxDiagnosticsMessage=function(e){var t="";try{u.isNullOrUndefined(e)||u.isNullOrUndefined(e.ajaxData)||u.isNullOrUndefined(e.ajaxData.requestUrl)||(t+="(url: '"+e.ajaxData.requestUrl+"')")}catch(e){}return t},Tt.prototype.trackDependencyData=function(e,t){this.trackDependencyDataInternal(e,t)},Tt.prototype.processTelemetry=function(e){this._nextPlugin&&this._nextPlugin.processTelemetry&&this._nextPlugin.processTelemetry(e)},Tt.prototype.setNextPlugin=function(e){e&&(this._nextPlugin=e)},Tt.prototype.includeCorrelationHeaders=function(e,t,n,i){if(t){if(ae.canIncludeCorrelationHeader(this._config,e.getAbsoluteUrl(),this.currentWindowHost)){if((n=n||{}).headers=new Headers(n.headers||t instanceof Request&&t.headers||{}),this._isUsingAIHeaders){var r="|"+e.traceID+"."+e.spanID;n.headers.set($.requestIdHeader,r),this._config.enableRequestHeaderTracking&&(e.requestHeaders[$.requestIdHeader]=r)}if((o=this._config.appId||this._context.appId())&&(n.headers.set($.requestContextHeader,$.requestContextAppIdFormat+o),this._config.enableRequestHeaderTracking&&(e.requestHeaders[$.requestContextHeader]=$.requestContextAppIdFormat+o)),this._isUsingW3CHeaders){var a=new At(e.traceID,e.spanID);n.headers.set($.traceParentHeader,a.toString()),this._config.enableRequestHeaderTracking&&(e.requestHeaders[$.traceParentHeader]=a.toString())}return n}return n}if(i){var o;if(this.currentWindowHost&&ae.canIncludeCorrelationHeader(this._config,i.ajaxData.getAbsoluteUrl(),this.currentWindowHost))this._isUsingAIHeaders&&(r="|"+i.ajaxData.traceID+"."+i.ajaxData.spanID,i.setRequestHeader($.requestIdHeader,r),this._config.enableRequestHeaderTracking&&(i.ajaxData.requestHeaders[$.requestIdHeader]=r)),(o=this._config.appId||this._context.appId())&&(i.setRequestHeader($.requestContextHeader,$.requestContextAppIdFormat+o),this._config.enableRequestHeaderTracking&&(i.ajaxData.requestHeaders[$.requestContextHeader]=$.requestContextAppIdFormat+o)),this._isUsingW3CHeaders&&(a=new At(i.ajaxData.traceID,i.ajaxData.spanID),i.setRequestHeader($.traceParentHeader,a.toString()),this._config.enableRequestHeaderTracking&&(i.ajaxData.requestHeaders[$.traceParentHeader]=a.toString()));return i}},Tt.prototype.initialize=function(e,t,n){if(!this.initialized&&!this._fetchInitialized){this._core=t;var i=Tt.getDefaultConfig();for(var r in this._config=Tt.getEmptyConfig(),i)this._config[r]=vt.getConfig(e,r,Tt.identifier,i[r]);if(this._isUsingAIHeaders=this._config.distributedTracingMode===s.AI||this._config.distributedTracingMode===s.AI_AND_W3C,this._isUsingW3CHeaders=this._config.distributedTracingMode===s.AI_AND_W3C||this._config.distributedTracingMode===s.W3C,!1===this._config.disableAjaxTracking&&this.instrumentXhr(),!1===this._config.disableFetchTracking&&this.instrumentFetch(),0<n.length&&n){for(var a=void 0,o=0;!a&&o<n.length;)n[o]&&"AppInsightsPropertiesPlugin"===n[o].identifier&&(a=n[o]),o++;a&&(this._context=a.context)}}},Tt.prototype.trackDependencyDataInternal=function(e,t,n){if(-1===this._config.maxAjaxCallsPerView||this._trackAjaxAttempts<this._config.maxAjaxCallsPerView){var i=yt.create(e,tt.dataType,tt.envelopeType,this._core.logger,t,n);this._core.track(i)}else this._trackAjaxAttempts===this._config.maxAjaxCallsPerView&&this._core.logger.throwInternal(x.CRITICAL,U,"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.",!0);++this._trackAjaxAttempts},Tt.prototype.instrumentFetch=function(){if(this.supportsFetch()&&!this._fetchInitialized){var i=window.fetch,r=this;window.fetch=function(t,e){var n;if(r.isFetchInstrumented(t)&&r.isMonitoredInstance(void 0,void 0,t,e))try{n=r.createFetchRecord(t,e),e=r.includeCorrelationHeaders(n,t,e)}catch(e){r._core.logger.throwInternal(x.CRITICAL,M,"Failed to monitor Window.fetch, monitoring data for this fetch call may be incorrect.",{ajaxDiagnosticsMessage:this.getFailedFetchDiagnosticsMessage(t),exception:te.dump(e)})}return i(t,e).then(function(e){return r.onFetchComplete(e,n),e}).catch(function(e){throw r.onFetchFailed(t,n,e),e})},this._fetchInitialized=!0}},Tt.prototype.instrumentXhr=function(){this.supportsAjaxMonitoring()&&!this.initialized&&(this.instrumentOpen(),this.instrumentSend(),this.instrumentAbort(),this.instrumentSetRequestHeader(),this.initialized=!0)},Tt.prototype.isMonitoredInstance=function(e,t,n,i){var r=!1,a=!0,o=!1;return void 0!==n?(o=this._fetchInitialized,r="object"==typeof n&&!0===n[he]||!!i&&!0===i[he]):void 0!==e&&(o=this.initialized,r=!0===e[he],a=!0===t||!u.isNullOrUndefined(e.ajaxData)),o&&a&&!r},Tt.prototype.supportsAjaxMonitoring=function(){var e=!0;return(u.isNullOrUndefined(XMLHttpRequest)||u.isNullOrUndefined(XMLHttpRequest.prototype)||u.isNullOrUndefined(XMLHttpRequest.prototype.open)||u.isNullOrUndefined(XMLHttpRequest.prototype.send)||u.isNullOrUndefined(XMLHttpRequest.prototype.abort))&&(e=!1),e},Tt.prototype.instrumentOpen=function(){var i=XMLHttpRequest.prototype.open,r=this;XMLHttpRequest.prototype.open=function(e,t,n){try{!r.isMonitoredInstance(this,!0)||this.ajaxData&&this.ajaxData.xhrMonitoringState.openDone||r.openHandler(this,e,t,n)}catch(e){r._core.logger.throwInternal(x.CRITICAL,M,"Failed to monitor XMLHttpRequest.open, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:Tt.getFailedAjaxDiagnosticsMessage(this),exception:te.dump(e)})}return i.apply(this,arguments)}},Tt.prototype.openHandler=function(e,t,n,i){var r=this._context&&this._context.telemetryTrace&&this._context.telemetryTrace.traceID||te.generateW3CId(),a=te.generateW3CId().substr(0,16),o=new _t(r,a,this._core.logger);o.method=t,o.requestUrl=n,o.xhrMonitoringState.openDone=!0,o.requestHeaders={},e.ajaxData=o,this.attachToOnReadyStateChange(e)},Tt.prototype.instrumentSend=function(){var t=XMLHttpRequest.prototype.send,n=this;XMLHttpRequest.prototype.send=function(e){try{n.isMonitoredInstance(this)&&!this.ajaxData.xhrMonitoringState.sendDone&&n.sendHandler(this,e)}catch(e){n._core.logger.throwInternal(x.CRITICAL,R,"Failed to monitor XMLHttpRequest, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:Tt.getFailedAjaxDiagnosticsMessage(this),exception:te.dump(e)})}return t.apply(this,arguments)}},Tt.prototype.sendHandler=function(e,t){e.ajaxData.requestSentTime=le.Now(),(e=this.includeCorrelationHeaders(e.ajaxData,void 0,void 0,e)).ajaxData.xhrMonitoringState.sendDone=!0},Tt.prototype.instrumentAbort=function(){var e=XMLHttpRequest.prototype.abort,t=this;XMLHttpRequest.prototype.abort=function(){try{t.isMonitoredInstance(this)&&!this.ajaxData.xhrMonitoringState.abortDone&&(this.ajaxData.aborted=1,this.ajaxData.xhrMonitoringState.abortDone=!0)}catch(e){t._core.logger.throwInternal(x.CRITICAL,w,"Failed to monitor XMLHttpRequest.abort, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:Tt.getFailedAjaxDiagnosticsMessage(this),exception:te.dump(e)})}return e.apply(this,arguments)}},Tt.prototype.instrumentSetRequestHeader=function(){if(this._config.enableRequestHeaderTracking){var n=XMLHttpRequest.prototype.setRequestHeader,i=this;XMLHttpRequest.prototype.setRequestHeader=function(e,t){try{i.isMonitoredInstance(this)&&(this.ajaxData.requestHeaders[e]=t)}catch(e){i._core.logger.throwInternal(x.CRITICAL,W,"Failed to monitor XMLHttpRequest.setRequestHeader, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:Tt.getFailedAjaxDiagnosticsMessage(this),exception:te.dump(e)})}return n.apply(this,arguments)}}},Tt.prototype.attachToOnReadyStateChange=function(n){var i=this;n.ajaxData.xhrMonitoringState.onreadystatechangeCallbackAttached=St.AttachEvent(n,"readystatechange",function(){try{i.isMonitoredInstance(n)&&4===n.readyState&&i.onAjaxComplete(n)}catch(e){var t=te.dump(e);t&&-1!==t.toLowerCase().indexOf("c00c023f")||i._core.logger.throwInternal(x.CRITICAL,q,"Failed to monitor XMLHttpRequest 'readystatechange' event handler, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:Tt.getFailedAjaxDiagnosticsMessage(n),exception:te.dump(e)})}})},Tt.prototype.onAjaxComplete=function(e){if(e.ajaxData.responseFinishedTime=le.Now(),e.ajaxData.status=e.status,e.ajaxData.CalculateMetrics(),e.ajaxData.ajaxTotalDuration<0)this._core.logger.throwInternal(x.WARNING,T,"Failed to calculate the duration of the ajax call, monitoring data for this ajax call won't be sent.",{ajaxDiagnosticsMessage:Tt.getFailedAjaxDiagnosticsMessage(e),requestSentTime:e.ajaxData.requestSentTime,responseFinishedTime:e.ajaxData.responseFinishedTime});else{var t={id:"|"+e.ajaxData.traceID+"."+e.ajaxData.spanID,target:e.ajaxData.getAbsoluteUrl(),name:e.ajaxData.getPathName(),type:"Ajax",duration:e.ajaxData.ajaxTotalDuration,success:200<=+e.ajaxData.status&&+e.ajaxData.status<400,responseCode:+e.ajaxData.status,method:e.ajaxData.method},n=this.getAjaxCorrelationContext(e);if(n&&(t.correlationContext=n),this._config.enableRequestHeaderTracking&&0<Object.keys(e.ajaxData.requestHeaders).length&&(t.properties=t.properties||{},t.properties.requestHeaders={},t.properties.requestHeaders=e.ajaxData.requestHeaders),this._config.enableResponseHeaderTracking){var i=e.getAllResponseHeaders();if(i){var r=i.trim().split(/[\r\n]+/),a={};r.forEach(function(e){var t=e.split(": "),n=t.shift(),i=t.join(": ");a[n]=i}),0<Object.keys(a).length&&(t.properties=t.properties||{},t.properties.responseHeaders={},t.properties.responseHeaders=a)}}this.trackDependencyDataInternal(t),e.ajaxData=null}},Tt.prototype.getAjaxCorrelationContext=function(t){try{var e=t.getAllResponseHeaders();if(null!==e&&-1!==e.toLowerCase().indexOf($.requestContextHeaderLowerCase)){var n=t.getResponseHeader($.requestContextHeader);return ae.getCorrelationContext(n)}}catch(e){this._core.logger.throwInternal(x.WARNING,H,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{ajaxDiagnosticsMessage:Tt.getFailedAjaxDiagnosticsMessage(t),exception:te.dump(e)})}},Tt.prototype.isFetchInstrumented=function(e){return this._fetchInitialized&&!0!==e[he]},Tt.prototype.supportsFetch=function(){var e=!0;return(!window||u.isNullOrUndefined(window.Request)||u.isNullOrUndefined(window.Request.prototype)||u.isNullOrUndefined(window.fetch))&&(e=!1),e},Tt.prototype.createFetchRecord=function(e,t){var n=this._context&&this._context.telemetryTrace&&this._context.telemetryTrace.traceID||te.generateW3CId(),i=te.generateW3CId().substr(0,16),r=new _t(n,i,this._core.logger);return r.requestSentTime=le.Now(),e instanceof Request?r.requestUrl=e?e.url:"":r.requestUrl=e,t&&t.method?r.method=t.method:e&&e instanceof Request?r.method=e.method:r.method="GET",t&&t.headers&&this._config.enableRequestHeaderTracking?r.requestHeaders=t.headers:r.requestHeaders={},r},Tt.prototype.getFailedFetchDiagnosticsMessage=function(e){var t="";try{u.isNullOrUndefined(e)||(t+="string"==typeof e?"(url: '"+e+"')":"(url: '"+e.url+"')")}catch(e){this._core.logger.throwInternal(x.CRITICAL,M,"Failed to grab failed fetch diagnostics message",{exception:te.dump(e)})}return t},Tt.prototype.onFetchComplete=function(t,e){if(e)try{if(e.responseFinishedTime=le.Now(),e.CalculateMetrics(),e.ajaxTotalDuration<0)this._core.logger.throwInternal(x.WARNING,T,"Failed to calculate the duration of the fetch call, monitoring data for this fetch call won't be sent.",{fetchDiagnosticsMessage:this.getFailedFetchDiagnosticsMessage(t),requestSentTime:e.requestSentTime,responseFinishedTime:e.responseFinishedTime});else{var n={id:"|"+e.traceID+"."+e.spanID,target:e.getAbsoluteUrl(),name:e.getPathName(),type:"Fetch",duration:e.ajaxTotalDuration,success:200<=t.status&&t.status<400,responseCode:t.status,properties:{HttpMethod:e.method}},i=this.getFetchCorrelationContext(t);if(i&&(n.correlationContext=i),this._config.enableRequestHeaderTracking&&0<Object.keys(e.requestHeaders).length&&(n.properties=n.properties||{},n.properties.requestHeaders=e.requestHeaders),this._config.enableResponseHeaderTracking){var r={};t.headers.forEach(function(e,t){r[t]=e}),0<Object.keys(r).length&&(n.properties=n.properties||{},n.properties.responseHeaders=r)}this.trackDependencyDataInternal(n)}}catch(e){this._core.logger.throwInternal(x.WARNING,H,"Failed to calculate the duration of the fetch call, monitoring data for this fetch call won't be sent.",{fetchDiagnosticsMessage:this.getFailedFetchDiagnosticsMessage(t),exception:te.dump(e)})}},Tt.prototype.onFetchFailed=function(t,e,n){if(e)try{if(e.responseFinishedTime=le.Now(),e.CalculateMetrics(),e.ajaxTotalDuration<0)this._core.logger.throwInternal(x.WARNING,T,"Failed to calculate the duration of the failed fetch call, monitoring data for this fetch call won't be sent.",{fetchDiagnosticsMessage:this.getFailedFetchDiagnosticsMessage(t),requestSentTime:e.requestSentTime,responseFinishedTime:e.responseFinishedTime});else{var i={id:"|"+e.traceID+"."+e.spanID,target:e.getAbsoluteUrl(),name:e.getPathName(),type:"Fetch",duration:e.ajaxTotalDuration,success:!1,responseCode:0,properties:{HttpMethod:e.method}};this.trackDependencyDataInternal(i,{error:n.message})}}catch(e){this._core.logger.throwInternal(x.WARNING,H,"Failed to calculate the duration of the failed fetch call, monitoring data for this fetch call won't be sent.",{fetchDiagnosticsMessage:this.getFailedFetchDiagnosticsMessage(t),exception:te.dump(e)})}},Tt.prototype.getFetchCorrelationContext=function(t){try{var e=t.headers.get($.requestContextHeader);return ae.getCorrelationContext(e)}catch(e){this._core.logger.throwInternal(x.WARNING,H,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{fetchDiagnosticsMessage:this.getFailedFetchDiagnosticsMessage(t),exception:te.dump(e)})}},Tt.identifier="AjaxDependencyPlugin",Tt);function Tt(){this.identifier=Tt.identifier,this.priority=120,this._trackAjaxAttempts=0,this.currentWindowHost=window&&window.location&&window.location.host&&window.location.host.toLowerCase(),this.initialized=!1,this._fetchInitialized=!1}e.AjaxPlugin=wt,e.ajaxRecord=_t,Object.defineProperty(e,"__esModule",{value:!0})});
