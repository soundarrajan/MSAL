/*!
 * Application Insights JavaScript SDK - Core, 2.2.4
 * Copyright (c) Microsoft and contributors. All rights reserved.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e.Microsoft=e.Microsoft||{},e.Microsoft.ApplicationInsights={}))}(this,function(a){"use strict";var t={Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5},i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};var g=(e.isNullOrUndefined=function(e){return null==e},e.disableCookies=function(){e._canUseCookies=!1},e.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(n,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e);function e(){}var n=/[xy]/g,o=(r.prototype.processTelemetry=function(t){this.channelQueue.forEach(function(e){0<e.length&&e[0].processTelemetry(t)})},Object.defineProperty(r.prototype,"ChannelControls",{get:function(){return this.channelQueue},enumerable:!0,configurable:!0}),r.prototype.initialize=function(i,n,o){var r,s=this;i.isCookieUseDisabled&&g.disableCookies(),this.channelQueue=new Array,i.channels&&i.channels.forEach(function(e){if(e&&0<e.length){e=e.sort(function(e,t){return e.priority-t.priority});for(var t=1;t<e.length;t++)e[t-1].setNextPlugin(e[t]);if(e.forEach(function(e){e.priority<500&&(r=e.identifier),e.initialize(i,n,o)}),r)throw Error("Channel has invalid priority"+r);s.channelQueue.push(e)}});for(var e=new Array,t=0;t<o.length;t++){var a=o[t];500<a.priority&&e.push(a)}if(0<e.length){for(e=e.sort(function(e,t){return e.priority-t.priority}),t=1;t<e.length;t++)e[t-1].setNextPlugin(e[t]);e.forEach(function(e){return e.initialize(i,n,o)}),this.channelQueue.push(e)}},r);function r(){this.identifier="ChannelControllerPlugin",this.priority=500}var s=(l.prototype.initialize=function(e,t,i,n){var o=this;if(this._isInitialized)throw Error("Core should not be initialized more than once");if(!e||g.isNullOrUndefined(e.instrumentationKey))throw Error("Please provide instrumentation key");this.config=e,this._notificationManager=n,this._notificationManager||(this._notificationManager=Object.create({addNotificationListener:function(e){},removeNotificationListener:function(e){},eventsSent:function(e){},eventsDiscarded:function(e,t){}})),this.config.extensions=g.isNullOrUndefined(this.config.extensions)?[]:this.config.extensions,this.config.extensionConfig=g.isNullOrUndefined(this.config.extensionConfig)?{}:this.config.extensionConfig,this._notificationManager&&(this.config.extensionConfig.NotificationManager=this._notificationManager),this.logger=i,this.logger||(this.logger=Object.create({throwInternal:function(e,t,i,n,o){void 0===o&&(o=!1)},warnToConsole:function(e){},resetInternalMessageCount:function(){}})),(s=this._extensions).push.apply(s,t.concat(this.config.extensions)),this._extensions.forEach(function(e){var t=!0;if((g.isNullOrUndefined(e)||g.isNullOrUndefined(e.initialize))&&(t=!1),!t)throw Error("Extensions must provide callback to initialize")}),this._extensions.push(this._channelController),this._extensions=this._extensions.sort(function(e,t){var i=e,n=t,o=typeof i.processTelemetry,r=typeof n.processTelemetry;return"function"==o&&"function"==r?i.priority-n.priority:"function"==o&&"function"!=r?1:"function"!=o&&"function"==r?-1:void 0});var r={};this._extensions.forEach(function(e){var t=e;t&&t.priority&&(g.isNullOrUndefined(r[t.priority])?r[t.priority]=t.identifier:o.logger&&o.logger.warnToConsole("Two extensions have same priority"+r[t.priority]+", "+t.identifier))});for(var s,a=-1,l=0;l<this._extensions.length-1;l++){var c=this._extensions[l];if(!c||"function"==typeof c.processTelemetry){if(c.priority===this._channelController.priority){a=l+1;break}this._extensions[l].setNextPlugin(this._extensions[l+1])}}if(this._channelController.initialize(this.config,this,this._extensions),this._extensions.forEach(function(e){e&&e.priority<o._channelController.priority&&e.initialize(o.config,o,o._extensions)}),a<this._extensions.length&&this._extensions.splice(a),0===this.getTransmissionControls().length)throw new Error("No channels available");this._isInitialized=!0},l.prototype.getTransmissionControls=function(){return this._channelController.ChannelControls},l.prototype.track=function(e){e.iKey||(e.iKey=this.config.instrumentationKey),e.time||(e.time=(new Date).toISOString()),g.isNullOrUndefined(e.ver)&&(e.ver="4.0"),0===this._extensions.length&&this._channelController.processTelemetry(e);for(var t=0;t<this._extensions.length;){if(this._extensions[t].processTelemetry){this._extensions[t].processTelemetry(e);break}t++}},l);function l(){this._isInitialized=!1,this._extensions=new Array,this._channelController=new o}var c,f=(u.prototype.addNotificationListener=function(e){this.listeners.push(e)},u.prototype.removeNotificationListener=function(e){for(var t=this.listeners.indexOf(e);-1<t;)this.listeners.splice(t,1),t=this.listeners.indexOf(e)},u.prototype.eventsSent=function(t){for(var i=this,e=function(e){n.listeners[e].eventsSent&&setTimeout(function(){return i.listeners[e].eventsSent(t)},0)},n=this,o=0;o<this.listeners.length;++o)e(o)},u.prototype.eventsDiscarded=function(t,i){for(var n=this,e=function(e){o.listeners[e].eventsDiscarded&&setTimeout(function(){return n.listeners[e].eventsDiscarded(t,i)},0)},o=this,r=0;r<this.listeners.length;++r)e(r)},u);function u(){this.listeners=[]}(c=a.LoggingSeverity||(a.LoggingSeverity={}))[c.CRITICAL=1]="CRITICAL",c[c.WARNING=2]="WARNING";var h={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70,FailedMonitorAjaxSetRequestHeader:71,SendBrowserInfoOnUserInit:72},d=(p.sanitizeDiagnosticText=function(e){return'"'+e.replace(/\"/g,"")+'"'},p.dataType="MessageData",p.AiNonUserActionablePrefix="AI (Internal): ",p.AiUserActionablePrefix="AI: ",p);function p(e,t,i,n){void 0===i&&(i=!1),this.messageId=e,this.message=(i?p.AiUserActionablePrefix:p.AiNonUserActionablePrefix)+e;var o=(t?" message:"+p.sanitizeDiagnosticText(t):"")+(n?" props:"+p.sanitizeDiagnosticText(JSON.stringify(n)):"");this.message+=o}var y=(x.prototype.throwInternal=function(e,t,i,n,o){void 0===o&&(o=!1);var r=new d(t,i,o,n);if(this.enableDebugExceptions())throw r;if(void 0!==r&&r&&void 0!==r.message){if(o){var s=+r.messageId;(!this._messageLogged[s]||this.consoleLoggingLevel()>=a.LoggingSeverity.WARNING)&&(this.warnToConsole(r.message),this._messageLogged[s]=!0)}else this.consoleLoggingLevel()>=a.LoggingSeverity.WARNING&&this.warnToConsole(r.message);this.logInternalMessage(e,r)}},x.prototype.warnToConsole=function(e){"undefined"!=typeof console&&console&&("function"==typeof console.warn?console.warn(e):"function"==typeof console.log&&console.log(e))},x.prototype.resetInternalMessageCount=function(){this._messageCount=0,this._messageLogged={}},x.prototype.logInternalMessage=function(e,t){if(!this._areInternalMessagesThrottled()){var i=!0,n=this.AIInternalMessagePrefix+t.messageId;if(this._messageLogged[n]?i=!1:this._messageLogged[n]=!0,i&&(e<=this.telemetryLoggingLevel()&&(this.queue.push(t),this._messageCount++),this._messageCount===this.maxInternalMessageLimit())){var o="Internal events throttle limit per PageView reached for this app.",r=new d(h.MessageLimitPerPVExceeded,o,!1);this.queue.push(r),this.warnToConsole(o)}}},x.prototype._areInternalMessagesThrottled=function(){return this._messageCount>=this.maxInternalMessageLimit()},x);function x(e){this.queue=[],this.AIInternalMessagePrefix="AITR_",this._messageCount=0,this._messageLogged={},this.enableDebugExceptions=function(){return!1},this.consoleLoggingLevel=function(){return 0},this.telemetryLoggingLevel=function(){return 1},this.maxInternalMessageLimit=function(){return 25},g.isNullOrUndefined(e)||(g.isNullOrUndefined(e.loggingLevelConsole)||(this.consoleLoggingLevel=function(){return e.loggingLevelConsole}),g.isNullOrUndefined(e.loggingLevelTelemetry)||(this.telemetryLoggingLevel=function(){return e.loggingLevelTelemetry}),g.isNullOrUndefined(e.maxMessageLimit)||(this.maxInternalMessageLimit=function(){return e.maxMessageLimit}),g.isNullOrUndefined(e.enableDebugExceptions)||(this.enableDebugExceptions=function(){return e.enableDebugExceptions}))}var m,v,_,C=(i(m=T,v=_=s),void(m.prototype=null===v?Object.create(v):(I.prototype=v.prototype,new I)),T.prototype.initialize=function(e,t){this._notificationManager=new f,this.logger=new y(e),this.config=e,_.prototype.initialize.call(this,e,t,this.logger,this._notificationManager)},T.prototype.getTransmissionControls=function(){return _.prototype.getTransmissionControls.call(this)},T.prototype.track=function(e){if(null===e)throw this._notifyInvalidEvent(e),Error("Invalid telemetry item");this._validateTelemetryItem(e),_.prototype.track.call(this,e)},T.prototype.addNotificationListener=function(e){this._notificationManager&&this._notificationManager.addNotificationListener(e)},T.prototype.removeNotificationListener=function(e){this._notificationManager&&this._notificationManager.removeNotificationListener(e)},T.prototype.pollInternalLogs=function(i){var n=this,e=this.config.diagnosticLogInterval;return 0<e||(e=1e4),setInterval(function(){var e=n.logger?n.logger.queue:[];e.forEach(function(e){var t={name:i||"InternalMessageId: "+e.messageId,iKey:n.config.instrumentationKey,time:(new Date).toISOString(),baseType:d.dataType,baseData:{message:e.message}};n.track(t)}),e.length=0},e)},T.prototype._validateTelemetryItem=function(e){if(g.isNullOrUndefined(e.name))throw this._notifyInvalidEvent(e),Error("telemetry name required")},T.prototype._notifyInvalidEvent=function(e){this._notificationManager&&this._notificationManager.eventsDiscarded([e],t.InvalidEvent)},T);function I(){this.constructor=m}function T(){return _.call(this)||this}a.MinChannelPriorty=100,a.EventsDiscardedReason=t,a.AppInsightsCore=C,a.BaseCore=s,a.CoreUtils=g,a.NotificationManager=f,a.DiagnosticLogger=y,a._InternalLogMessage=d,a._InternalMessageId=h,Object.defineProperty(a,"__esModule",{value:!0})});
