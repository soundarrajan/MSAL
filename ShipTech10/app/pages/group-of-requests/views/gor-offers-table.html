
<div style="position: relative; zoom:0.75; overflow: auto;" id="negotiation-table-fixed-container">


    <table id="group_of_requests_table" class="table table-bordered table-hover table-striped table-condensed st-group-of-requests-table bg-white" ng-cloak >
        <thead style="background: #fff;">
            
            <tr>
                <th id="generatedThId143"  colspan="{{$ctrl.calculateFirsRowColSpan()}}" class="vessel-header text-uppercase font-white" style="background:#557b83; padding: 0px; padding-left: 2px !important; border-top: 6px solid #ffffff;">
                    
                    <div class="wrap-counterparty-details" style="display: flex;vertical-align: middle;align-items: end;width: 100%;justify-content: space-between;">
                        <div style="display: inline-block; vertical-align: middle; padding: 2px; font-weight: initial;font-size: 16px;padding: 5px 5px;">
                                Counterparty Details
                        </div>

                        <div class="" style="background: white;padding:2px 12px;display: flex;align-self: stretch;align-items: center; justify-self: end; border: 1px solid #d1d8dd;">

                                <a ng-click="$ctrl.expandAll()" ng-if="!$ctrl.allExpanded">
                                        <i class="fa fa-2x fa-angle-right" style="vertical-align: middle;"></i>
                                    </a>
                
                                <a ng-click="$ctrl.expandAll()" ng-if="$ctrl.allExpanded" >
                                    <i class="fa fa-2x fa-angle-left" style="vertical-align: middle;"></i>
                                </a>

                        </div>
                    </div>
                   
            
                </th>
    
        
                <!-- End expanded seller history tab -->
    
                <!-- Collapsed request tab -->
                <th id="generatedThId144" ng-repeat-start="request in $ctrl.selectedRequests track by $index"
                ng-show="$ctrl.isRequestTabExpanded($index) && !request.isDeleted" class="request-tab-collapsed {{$index == 0 ? 'left-border' : ''}}  border-selected-top bg-blue" style="padding-left:7px !important; border-top:none; border-left:4px solid #d1d8dd !important; width:100%;">
                    <span ng-if="$index == 0" class="font-white text-uppercase" style="font-weight: initial;font-size: 16px;padding: 5px 5px;display: block;">
                        Negotiation Details
                    </span>
                </th>
                <!-- End collapsed request tab -->
    
                <!-- Expanded request tab -->
                <th id="generatedThId145" ng-show="!$ctrl.isRequestTabExpanded($index) && !request.isDeleted" colspan="{{request.newProductCount*2 + 1 }}" class="border-blue request-tab-expanded {{$index == 0 ? 'left-border' : ''}} border-selected-top bg-blue" style="padding-left:7px !important; border-top:none; border-left:4px solid #d1d8dd !important">

                    <span ng-if="$index == 0" class="font-white text-uppercase" style="font-weight: initial;font-size: 16px;padding: 5px 5px;display: block;">
                        Negotiation Details
                    </span>
                </th>
    
                <th id="generatedThId146" ng-repeat-end  style="border-left: 2px solid;" class="border-blue left-border border-selected-top bg-blue">
                </th>
                <!-- End expanded request tab -->
            </tr>
    
            <tr>
                <th id="generatedThId147" colspan="7" style="position: relative; padding-left: 7px !important; padding-top: 7px !important; padding-bottom: 8px !important;">
                    <form class="form-inline">
                        <div class="form-group-sm" style="display: flex;width: 100%;justify-content: space-between;align-items: center;">
                            <label class="mt-checkbox mt-checkbox-outline" ng-if="$ctrl.shouldDisplayCounterpartyTypeFilter(2)" style="white-space: nowrap; margin-bottom: 5px; margin-top: 5px; padding-left: 20px; margin-left:5px; margin-right:15px; padding-right: 15px;">
                                Seller
                                <input ng-model="$ctrl.sellerTypeCheckboxes.Seller" ng-change="$ctrl.changeSellerTypes()" type="checkbox"/>
                                <span></span>
                                <i class="fa fa-user font-green-jungle" style="position: absolute;right: 0;top: 4px;"></i>
                            </label>
    
                            <label class="mt-checkbox mt-checkbox-outline" ng-if="$ctrl.shouldDisplayCounterpartyTypeFilter(3)" style="white-space: nowrap; margin-bottom: 5px; margin-top: 5px; padding-left: 20px; margin-left:5px; margin-right:15px; padding-right: 15px;">
                                Broker
                                <input ng-model="$ctrl.sellerTypeCheckboxes.Broker" ng-change="$ctrl.changeSellerTypes()" type="checkbox"/>
                                <span></span>
                                <i class="fa fa-user font-blue" style="position: absolute;right: 0;top: 4px;"></i>
                            </label>
    
                            <label class="mt-checkbox mt-checkbox-outline" ng-if="$ctrl.shouldDisplayCounterpartyTypeFilter(1)" style="white-space: nowrap; margin-bottom: 5px; margin-top: 5px; padding-left: 20px; margin-left:5px; margin-right:15px; padding-right: 15px;">
                                Physical Supplier <span style=" color: orange;position: absolute;font-size: 9px;margin-left: 2px;"> * </span>
                                <input ng-model="$ctrl.sellerTypeCheckboxes.Supplier" ng-change="$ctrl.changeSellerTypes()" type="checkbox"/>
                                <span></span>
                                <i class="fa fa-user font-yellow-lemon" style="position: absolute;right: 0;top: 4px;"></i>
                            </label>
                            <label class="mt-checkbox mt-checkbox-outline" ng-if="$ctrl.shouldDisplayCounterpartyTypeFilter(11)" style="white-space: nowrap; margin-bottom: 5px; margin-top: 5px; padding-left: 20px; margin-left:5px; margin-right:15px; padding-right: 15px;">
                                Sludge
                                <input ng-model="$ctrl.sellerTypeCheckboxes['Sludge']" ng-change="$ctrl.changeSellerTypes()" type="checkbox"/>
                                <span></span>
                                <i class="fa fa-user font-yellow-red" style="position: absolute;right: 0;top: 4px;"></i>
                            </label>
                            <div class="hidden">
                                {{$ctrl.sellerTypesAreSelected = $ctrl.checkedSellerTypesSelected()}}
                            </div>
                            <label  style="white-space: nowrap; margin-bottom: 5px; margin-top: 5px;" class="mt-checkbox mt-checkbox-outline">
                                All
                                <span class="hidden">
                                    {{$ctrl.sellerTypeCheckboxes.Supplier && $ctrl.sellerTypeCheckboxes.Broker && $ctrl.sellerTypeCheckboxes.Seller ? checkAllCounterpartyTypes = true : checkAllCounterpartyTypes = false}}
                                </span>
                                <input ng-model="checkAllCounterpartyTypes" ng-change="$ctrl.selectAllCounterpartyTypeFilters(checkAllCounterpartyTypes)" type="checkbox"/>
                                <span></span>
                            </label>
                        </div>
                    </form>
                    
                </th>
    
    
                <th id="generatedThId148" ng-if="$ctrl.counterpartyCommentsVisibility == 1" ng-show="$ctrl.allExpanded" style="{{$ctrl.counterpartyCommentsVisibility == 1 ? 'min-width: 415px;' : ''}} position:relative;">Comments Section
                    <span class="hidden" ng-init="$ctrl.commentsSectionIsExpanded = !$ctrl.checkIfGroupHasRFQ()" ng-if="$ctrl.requests"></span>
    
                </th>
                <th id="generatedThId149" colspan="{{$ctrl.isSellerHistoryExpanded ? 10 : 4}}" ng-show="$ctrl.isSellerHistoryExpanded" ng-if="$ctrl.sellerHistoryVisibility == 1" class="text-uppercase">History</th>
    
    
    
                <!-- Collapsed request tab -->
                <th id="generatedThId150" ng-repeat-start="request in $ctrl.selectedRequests track by $index"
                ng-show="$ctrl.isRequestTabExpanded($index) && !request.isDeleted" class="request-tab-collapsed left-border border-selected-left border-selected-top font-white" style="background: #86cdd8">
                    <form class="form-inline">
                        <label class="control-label">{{request.name}} - {{request.vesselDetails.vessel.name}}</label>
                    </form>
                </th>
    
                <th id="generatedThId151" ng-show="$ctrl.isRequestTabExpanded($index) && !request.isDeleted" style="position: relative; width:30px" class="expander right-border border-selected-right border-selected-top">
                    <a ng-click="$ctrl.toggleRequestTab($index);">
                        <i class="fa fa-2x fa-angle-right" style="position: absolute;top: 50%;left: 50%;transform:  translate(-50%, -50%);line-height: 50px;" ></i>
                    </a>
                </th>
                <!-- End collapsed request tab -->
    
                <!-- Expanded request tab -->
                <th id="generatedThId152" ng-show="!$ctrl.isRequestTabExpanded($index) && !request.isDeleted" colspan="{{request.newProductCount*2 + 1 }}" class="request-tab-expanded left-border border-selected-left border-selected-top font-white" style="background: #86cdd8; position: relative;">
                    <form class="form-inline" style="position: absolute;height: 100%;top: 0;background: #f1f5f8;left: 0;min-width: 190px;text-align: center;color: #000;box-shadow: 0px 0px 8px 1px #3641504f; padding: 0 5px; font-size:16px;">
                        <label style="height: 100%;padding: 0;margin: 0;position: relative;float: left;display: flex;justify-content: center;align-items: center;" class="control-label"><b>{{request.name | decodeReadOnly}} - {{request.vesselDetails.vessel.name | decodeReadOnly}}</b></label>
                    </form>
                </th>
    
                <th id="generatedThId153" ng-repeat-end ng-show="!$ctrl.isRequestTabExpanded($index) && !request.isDeleted" class="expander right-border border-selected-right border-selected-top" style="background: #86cdd8 !important; padding: 0 !important; border-left: 3px solid #86cdd8; position: relative;">
                    <a ng-click="$ctrl.toggleRequestTab($index);" class="pull-right" style="position:relative; line-height: 45px;display: block;padding: 0 10px;background: #fff;position: absolute;height: 100%;top: 0;right: 0;">
                        <i class="fa fa-2x fa-angle-left" style="position: absolute;top: 50%;left: 50%;transform:  translate(-50%, -50%);"></i>
                    </a>
                </th>
                <!-- End expanded request tab -->
    
            </tr>
    
            <tr>
    
            </tr>
            <tr>
                <th id="generatedThId154" colspan="7" rowspan="2" class="vessel-subheader" style="min-width: 450px;">
                    <form class="form-inline">
                        <div class="form-group-sm">
                            <select ng-model="$ctrl.sellerSortOrder" ng-change="$ctrl.sortSellers()" class="select form-control">
                                <option value="{{$ctrl.SELLER_SORT_ORDER.PREFERENCE}}">Preference</option>
                                <option value="{{$ctrl.SELLER_SORT_ORDER.RATING}}">Rating</option>
                                <option value="{{$ctrl.SELLER_SORT_ORDER.ALPHABET}}">Alphabet</option>
                            </select>
                            <div class="input-group">
                                <input decode-input-format ng-disabled="!$ctrl.sellerTypesAreSelected" ng-model="$ctrl.newSeller[0]" placeholder="Seller" uib-typeahead="seller as seller.name for seller in $ctrl.sellerAutocompleteList  | typeaheadCustomFilter:$viewValue:'name' | decodeReadOnly" class="form-control" typeahead-on-select="$ctrl.addSellerToAllLocations($ctrl.newSeller[0].id, $ctrl.locations)" ng-click="$ctrl.setLookupInput(null)" typeahead-editable="false" ng-keypress="$ctrl.keyPress()">

                                <span ng-controller="Controller_Master as CM" class="input-group-addon {{$ctrl.sellerTypesAreSelected ? '' : 'disabled'}}" ng-click="$ctrl.setLookupInput(null); triggerModal('general', 'procurement_requestcounterpartytypes', 'seller', 'seller','','', '', $ctrl.sellerTypeIds)">
                                    <i class="fa fa-search"></i>
                                </span>
                            </div>
    
                        </div>
                    </form>
                </th>
                <th id="generatedThId155" ng-if="$ctrl.counterpartyCommentsVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" rowspan="2" style="padding:0 !important">
                    <div class="pull-left energy-content-cell" style="width:100px; height: 100%;">General Seller Status</div>
                    <div class="pull-left energy-content-cell" style="width:100px; height: 100%;">General Seller Comments</div>
                    <div class="pull-left energy-content-cell" style="width:100px; height: 100%;">Port Seller Status</div>
                    <div class="pull-left energy-content-cell" style="width:100px; height: 100%; border-right: none">Port Seller Comments</div>
                </th>
                <!-- collapsed history tab -->

                <th id="generatedThId156" ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" colspan="3" >
                    <div style="margin-bottom: 10px">Volume</div>
                    <div class="text-center">
                        <span class="pull-left">3M</span>
                        <span>6M</span>
                        <span class="pull-right">12M</span>
                    </div>
                </th>
                <th id="generatedThId157" ng-if="$ctrl.sellerHistoryVisibility == 1 && !$ctrl.tenantSetting.shiptechLite" ng-show="$ctrl.isSellerHistoryExpanded" rowspan="2" style="min-width:170px;">
                    <div style="margin-bottom: 10px">
                        Exposure
                    </div>
                    (Delivered-Invoiced)
                </th>
                <th id="generatedThId158" ng-if="$ctrl.sellerHistoryVisibility == 1 && !$ctrl.tenantSetting.shiptechLite" ng-show="$ctrl.isSellerHistoryExpanded" rowspan="2" style="min-width:170px;">Claims Last 12m<br/> Close-Open</th>
                <th id="generatedThId159" ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" colspan="{{$ctrl.isSellerHistoryExpanded ? 1 : 2}}" class="{{$ctrl.isSellerHistoryExpanded ? '' : 'left-border'}}" rowspan="2" >Avg. Drop <br/>(Last-First)<br/> ALL PRODUCTS</th>
                <th id="generatedThId160" ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" rowspan="2"  style="min-width:85px;" >Win rate <br/> Last 12m %</th>
                <span class="hide">
                    {{$ctrl.tenantSetting.shiptechLite ? $ctrl.colspanPayment = 5 : $ctrl.colspanPayment = 3}}
                </span>
                <th id="generatedThId161" ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" colspan="{{$ctrl.colspanPayment}}" rowspan="2" ><!-- CREDIT PERIOD --> Payment term</th>
        
                <!-- Collapsed request tab -->
                <th id="generatedThId162" ng-repeat-start="requestProducts in $ctrl.products track by $index" ng-show="$ctrl.isRequestTabExpanded($index)" rowspan="2" colspan="2" class="left-border border-selected-left right-border border-selected-right bg-default" style="min-width: 220px;">
                    <form class="form-inline">
                        <div ng-repeat="product in requestProducts" class="form-group-sm">
                            
                            <label class="control-label st-product-name" style="width: auto;"><strong>{{product.product.name}}</strong></label>
                            <hr ng-hide="$last"/>
                        </div>
                    </form>
                </th>
                <!-- End collapsed request tab -->
    
                <!-- Expanded request tab -->
                <th id="generatedThId163" ng-show="!$ctrl.isRequestTabExpanded($index)" rowspan="2" class="left-border border-selected-left" style="background: #f1f5f8; width: 20px;">
                    <!-- Actions -->
                </th>

                <th id="generatedThId164" ng-show="!$ctrl.isRequestTabExpanded($index)" rowspan="2" class="border-selected-left" style="display: none">
                    Incoterm
                </th>
                <th id="generatedThId165" ng-show="!$ctrl.isRequestTabExpanded($index)" ng-class="{fakeHideColumn : $ctrl.totalColumnIsHidden == true}" rowspan="2" class="border-selected-left" style="background: #f1f5f8;">
                    TOTAL
                </th>
                <th id="generatedThId166" width={{$ctrl.calculateProductColumnWidth()}} ng-repeat-start="(reqProdKey,product) in requestProducts" ng-show="!$ctrl.isRequestTabExpanded($parent.$index)" style="background: #f1f5f8 !important; min-width: 150px; max-width: 160px; position:relative;box-shadow: 0px 0px 8px 1px #3641504f; padding-left: 2px !important;">
                    <form class="form-inline" style="width: calc(100% - 20px); display: flex; align-items: center; height: 35px;justify-content: space-between;">
                        <div class="form-group-sm">
                            
                            <label class="control-label font-dark" ><b ng-click="$ctrl.goToOrderForProduct(product)" ng-class="{'productHasOrderLink' : $ctrl.checkIfProductHasOrder(product)}">{{product.product.name | decodeReadOnly}}</b></label>
                        </div>
                        <a href="" style="margin-right: 10px;font-size: 20px;" ng-if="$ctrl.checkIfCanInitEnergyCalculation(product)" ng-click="$ctrl.openGeneralWidgetBlade('energyCalculation', product)"><i class="fa fa-tint font-dark"></i></a>
                    </form>
                </th>
    

                <th id="generatedThId167" ng-repeat-end style="background: #f1f5f8 !important; padding: 0 !important; border-left: 2px solid #86cdd8; position: relative;   " ng-if="!$ctrl.isRequestTabExpanded($parent.$index)">
                        <div class="wrapper" ng-show="!$ctrl.isRequestTabExpanded($parent.$parent.$index)"  >
                            <span ng-init="$ctrl.priceDetailsDefaultView.id == 1 ? $ctrl.priceExpanded['prod'+product.requestId+reqProdKey] = true : $ctrl.priceExpanded['prod'+product.requestId+reqProdKey] = false "> <!-- if Expanded --> </span>
                            <div ng-show="$ctrl.energyContentExpanded['prod'+product.requestId+reqProdKey]" style="width:100px" class="energy-content-cell">Price Diff</div>
                            <div ng-show="$ctrl.energyContentExpanded['prod'+product.requestId+reqProdKey]" style="width:100px" class="energy-content-cell">TCO</div>
                            <div ng-show="$ctrl.priceExpanded['prod'+product.requestId+reqProdKey] || $ctrl.isEnergyCalculationRequired" ng-if="$ctrl.displayAdditionalCostColumn" style="width:100px;min-width: 100px;" class="energy-content-cell">Add. Cost</div>
                            <div ng-show="$ctrl.priceExpanded['prod'+product.requestId+reqProdKey] || $ctrl.isEnergyCalculationRequired" style="width:100px" class="energy-content-cell">Total price</div>
                            <div ng-show="$ctrl.priceExpanded['prod'+product.requestId+reqProdKey] || $ctrl.isEnergyCalculationRequired" style="width:100px" class="energy-content-cell">Amount</div>
                        </div>
                    
                        <div>
                            <a ng-click="$ctrl.toggleEnergyContentTab(product, reqProdKey);" class="pull-right" style="border-left: 1px solid #dde4ec;position: absolute;min-width:20px;z-index: 9999;background: white;left: 0;display: block;height: 100%;top: 0;transform: translateX(-100%);" 
                                ng-show="$ctrl.isEnergyCalculationRequired ? !$ctrl.energyContentExpanded['prod'+product.requestId+reqProdKey] : !$ctrl.priceExpanded['prod'+product.requestId+reqProdKey]">
                                <i class="fa fa-2x fa-angle-right" style="position: absolute;top: 50%;left: 50%;transform:  translate(-50%, -50%);"></i>
                            </a>
                            <a ng-click="$ctrl.toggleEnergyContentTab(product, reqProdKey);" class="pull-right" style="border-left: 1px solid #dde4ec;position: absolute;min-width:20px;z-index: 9999;background: white;right: 0;height: 100%;top: 0;" 
                                ng-show="$ctrl.isEnergyCalculationRequired ? $ctrl.energyContentExpanded['prod'+product.requestId+reqProdKey] : $ctrl.priceExpanded['prod'+product.requestId+reqProdKey] ">
                                <i class="fa fa-2x fa-angle-left" style="position: absolute;top: 50%;left: 50%;transform:  translate(-50%, -50%);" ></i>
                            </a>                            
                        </div>
                        

                </th>

                <th id="generatedThId168" ng-repeat-end ng-hide="true"></th>
                <!-- End expanded request tab -->
    
            </tr>

            <tr class="expanded-request-header hidden">
                <th id="generatedThId169" ng-if="$ctrl.counterpartyCommentsVisibility == 1" ng-show="$ctrl.allExpanded">
                </th>
                <th id="generatedThId170" class="forIncoterm"></th>
                <!-- collapsed history tab -->
                <th id="generatedThId171" ng-show="$ctrl.isSellerHistoryExpanded" style="border-left: none">3m</th>
                <th id="generatedThId172" ng-show="$ctrl.isSellerHistoryExpanded">6m</th>
                <th id="generatedThId173" ng-show="$ctrl.isSellerHistoryExpanded">12m</th>
                <!-- End collapsed history tab -->
                <th id="generatedThId174" ng-if="$ctrl.sellerHistoryVisibility == 1" && ng-show="ctrl.isSellerContactHidden"></th>
                <!-- Expanded request tab -->
                <th id="generatedThId175" ng-repeat-start="requestProducts in $ctrl.products track by $index" ng-hide="true"></th>
    
    

                </th>
                <th id="generatedThId176" ng-repeat-end  ng-show="!$ctrl.isRequestTabExpanded($parent.$index)" style="padding: 0px !important; font-weight:600;">
    
                   </th>
                <th id="generatedThId177" ng-repeat-end ng-hide="true"></th>
                <!-- End Expanded request tab -->
            </tr>
    
        </thead>
        <tbody>
            <tr ng-repeat-start="(locationKey, location) in $ctrl.locationsGroupedByULI " ng-init="locationIndex = $index">
                <th id="generatedThId178" colspan="7" class="negotiationLocationRowGroup" style="position: relative;" >
                    <span class="">
    
                    </span>
                    <form class="form-inline" style="box-shadow: 0px 0px 8px 1px #3641504f;height: 100%;line-height: 35px;float: left;padding: 0 15px;">
                        <div class="form-group-sm" style="display: flex; align-items: center;">
                            <b class="font-lg">
                                <i style="font-weight: bold;" class="fa fa-angle-double-down" ng-show="!location[0].fullLocationSellersExpanded" ng-click="location[0].fullLocationSellersExpanded = !location[0].fullLocationSellersExpanded"></i>
                                <i style="font-weight: bold;" class="fa fa-angle-double-up" ng-show="location[0].fullLocationSellersExpanded" ng-click="location[0].fullLocationSellersExpanded = !location[0].fullLocationSellersExpanded"></i>
                            </b>
                            &nbsp;&nbsp;
                            <b tooltip tooltip-trigger="hover" data-original-title="{{location[0].portRestrictionComments | decodeReadOnly}}">
                            {{location[0].location.name | decodeReadOnly}} 
                        	{{location[0].optionId ?  (" - " +  location[0].optionId) : '' | decodeReadOnly}} 
                        	{{location[0].terminal ? ( " - " + location[0].terminal.name) : ''  | decodeReadOnly}}</b>
                        </div>
                    </form>
                </th>
    
                <th id="generatedThId179" ng-if="$ctrl.counterpartyCommentsVisibility == 1" ng-show="$ctrl.allExpanded"></th>
                <!-- collapsed history tab -->
                <th id="generatedThId180" ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" colspan="2" class="left-border"></th>
                <th id="generatedThId181" ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" ><!-- volume 6m --></th>
                <th id="generatedThId182" ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" ><!-- terms --></th>
                <!-- end collapsed history tab -->
    
                <!-- expanded history tab -->
                <th id="generatedThId183" ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" colspan="1" class="left-border"><!-- icons --></th>
                <th id="generatedThId184" ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" colspan="5" ></th>
                <!-- end expanded history tab -->
    
                <th id="generatedThId185" ng-repeat-start="requestProducts in $ctrl.products track by $index" ng-show="$ctrl.isRequestTabExpanded($index)" colspan="2" class="left-border border-selected-left right-border border-selected-right">
    
                </th>
    
    
    
    
                <!-- Expanded request tab -->
                <th id="generatedThId186" ng-show="!$ctrl.isRequestTabExpanded($index)" class="left-border no-top-border border-selected-left"></th>
                <th id="generatedThId187" ng-show="!$ctrl.isRequestTabExpanded($index)" class="no-top-border border-selected-left" style="display: none">incoterm</th>
                <th id="generatedThId188" ng-show="!$ctrl.isRequestTabExpanded($index)" class="no-top-border border-selected-left" ng-class="{fakeHideColumn : $ctrl.totalColumnIsHidden == true}" ></th>
                <th id="generatedThId189" ng-repeat-start="productTop in requestProducts" class="negotiationProductTh" ng-show="!$ctrl.isRequestTabExpanded($parent.$index)" class="no-top-border">
                    <span ng-init="productTop.productLocations['L' + location[0].uniqueLocationIdentifier] ? product = productTop.productLocations['L' + location[0].uniqueLocationIdentifier] : ''">

                    <span ng-if="product">
                        </span>

                        <span class="hidden">
                            {{maxQuantity = $ctrl.getProductMaxQuantityOnLocation(product, location)['qty']}}
                            {{maxQuantityUom = $ctrl.getProductMaxQuantityOnLocation(product, location)['uom']}}
                        </span>
                        <span ng-if="maxQuantity">
                            <span style="margin-top:2px; float: left;">
                                <strong>Qty</strong>
                            </span>
                            <div class="input-group pull-right" style=" max-width: 100px; float: right;">
                                <input class="form-control ng-pristine ng-untouched ng-valid ng-not-empty" style="height:26px" disabled ng-model="maxQuantity">
                                <span class="input-group-addon bg-grey-steel" style="padding: 5px;"><b>
                                    {{maxQuantityUom.name | decodeReadOnly}}
                                </b></span>
                            </div>
                        </span>
                    </span>
                </th>
    
                <th id="generatedThId190" ng-repeat-end ng-show="!$ctrl.isRequestTabExpanded($parent.$index)" style="padding: 0px !important; font-weight:600; border-top: none">
                    <span ng-show="$ctrl.energyContentExpanded['prod'+product.requestId+reqProdKey]">

                        <div style="width:100px" class="energy-content-cell"><span style="opacity:0">Price Diff</span></div>
                        <div style="width:100px" class="energy-content-cell"><span style="opacity:0">Price Diff</span></div>
                        <div style="width:50px" class="energy-content-cell icon text-center"></div>
                    </span>
                    <span ng-show="$ctrl.priceExpanded['prod'+product.requestId+reqProdKey]">
                        <div ng-if="$ctrl.displayAdditionalCostColumn" style="width:100px" class="energy-content-cell"><span style="opacity:0">Add. Cost</span></div>
                        <div style="width:100px" class="energy-content-cell"><span style="opacity:0">Total Price</span></div>
                        <div style="width:100px" class="energy-content-cell"><span style="opacity:0">Amount</span></div>
                    </span>
                </th>
                <th id="generatedThId191" ng-repeat-end ng-hide="true">
                <!-- End expanded request tab -->
    
            </tr>
    
            <!-- Additional location row -->
            <tr style="background: #f1f5f8;">
                <td colspan="1" style="width:65px">Check All</td>
                <td colspan="1" style="width:20">
                    <label class="mt-checkbox mt-checkbox-outline">
                        <input type="checkbox" class="checkAllOnLocation" checkAllUniqueLocationIdentifier="{{location[0].uniqueLocationIdentifier}}" ng-click="$ctrl.checkAll(location[0].uniqueLocationIdentifier, $event)"/>
                        <span style="left: 6px;"></span>
                    </label>
                </td>
                <td colspan="5">
                    <form class="form-inline">
                        <div class="form-group-sm" style="display: flex; align-items: center;">
                            <span>Counterparty &nbsp;&nbsp;</span>
                            <div class="input-group">
                                <input decode-input-format ng-disabled="!$ctrl.sellerTypesAreSelected" ng-model="$ctrl.newSeller[location.id]" placeholder="Add counterparty" uib-typeahead="seller as seller.name for seller in $ctrl.sellerAutocompleteList | typeaheadCustomFilter:$viewValue:'name'" class="form-control" typeahead-on-select="$ctrl.addSellerToLocations($ctrl.newSeller[location.id].id, location)" ng-click="$ctrl.setLookupInput(location);" typeahead-editable="false"  ng-keypress="$ctrl.keyPress()">          
                                <span ng-controller="Controller_Master as CM" class="input-group-addon {{$ctrl.sellerTypesAreSelected ? '' : 'disabled' }}" ng-click="$ctrl.newSellerLocation = location; $ctrl.setLookupInput(location); triggerModal('general', 'procurement_requestcounterpartytypes', 'counterparty', 'counterparty','','', '', $ctrl.sellerTypeIds)">
                                    <i class="fa fa-search"></i>
                                </span>
                            </div>
                        </div>
                    </form>
                </td>
    
                <th id="generatedThId192" ng-if="$ctrl.counterpartyCommentsVisibility == 1" ng-show="$ctrl.allExpanded">
    
                </th>
                <td ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" colspan="{{$ctrl.isSellerHistoryExpanded ? 10 : 4}}" class="text-uppercase left-border border-selected-left"></td>
    

    <!-- Collapsed request tab -->
                <td ng-repeat-start="requestProducts in $ctrl.products track by $index"
                    ng-show="$ctrl.isRequestTabExpanded($index)"
                    ng-init=""
                    colspan="2" class="left-border border-selected-left right-border border-selected-right">
                    <div ng-repeat="individualLocation in location" ng-if="individualLocation.requestId === requestProducts[0].requestId" class="form-group-sm form-inline">
                        <label class="control-label"><strong>ETA:</strong></label>
                        <div class="input-group" style=" max-width: 180px;">
                            <b>
                            <input class="form-control"
                                    ng-model="individualLocation.recentEta"
                                    disabled
                                    st-date-format>
                            </b>
                            <span class="input-group-addon">
                                <i class="fa fa-calendar"></i>
                            </span>
                        </div>
                    </div>
                </td>
                <!-- End collapsed request tab -->
                <td ng-show="!$ctrl.isRequestTabExpanded($index)" class="left-border border-selected-left" colspan="{{$ctrl.counterpartyDetailsIsExpanded ? 2 : 2}}" style="min-width: 145px; max-width: 175px;" >
                    <div ng-repeat="individualLocation in location" ng-if="individualLocation.requestId === requestProducts[0].requestId" class="form-group-sm form-inline" style="box-shadow: 0px 0px 8px 1px #3641504f;padding:5px;border: 1px solid #d1d8dd;">
                        <label class="control-label"><strong> ETA: </strong></label>
                        <span class="hidden">
                            {{individualLocation.computedEta = individualLocation.recentEta ? individualLocation.recentEta : individualLocation.eta}}
                        </span>
                        <b>
                            <input class="form-control" style="max-width: 120px; padding:0;"
                                    ng-model="individualLocation.computedEta"
                                    disabled
                                    st-date-format>
                        </b>

                    </div>
                </td>
    
                <td ng-repeat-start="productTop in requestProducts track by $index" style="position: relative;" ng-show="!$ctrl.isRequestTabExpanded($parent.$index)"
    
                ng-init="productTop.productLocations['L' + location[0].uniqueLocationIdentifier] ? product = productTop.productLocations['L' + location[0].uniqueLocationIdentifier] : ''">
                <span ng-if="product" ng-init="maxQuantity = $ctrl.getProductMaxQuantityOnLocation(product, location);">
                    <span style="font-size: 12px">Market Price</span>  
                    <span>
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"  data-hover="dropdown" data-close-others="true" ng-click="$ctrl.getMarketPriceData(product, location)" >
                            <span ng-mouseover="portSellerStatustooltip['marketPrice'] = true; " ng-mouseleave="portSellerStatustooltip['marketPrice'] = false;"  style="position:relative;overflow:auto; top: 7px;">
                                <span style="max-width: 100%;overflow: auto;display: initial; text-overflow: ellipsis;" class="ng-binding">
                                    <img  style="width: 20px; height: 20px" src="img/info.png" alt="logo" class="logo-default" />
                                </span>
                                <span class="groupOfRequestTableTooltip marketPricePopup" ng-show="portSellerStatustooltip['marketPrice']" style="opacity: 1;">
                                    click to see market price history
                                </span>
                            </span>
                        </a>
                        <ul class="dropdown-menu marketPriceHistoryListPopup" style="z-index: 100000;overflow:auto;" ng-if="marketPriceHistoryList.length>0">
                            <li>
                                <div class="col-sm-12">
                                    <div style="display: flex;align-items: center;justify-content: space-around;font-size: 14px;height: 100%;padding-top: 7px;" >
                                        <table class="table table-condensed" cellpadding='6' cellspacing='6' style="font-weight:bold;font-size:1.1em;padding-left: 5px;border: 1px solid lightgray;border-left: 4px solid lightgray;"  >  
                                            <thead>
                                                <tr> 
                                                    <td colspan="2" style="background-color: white;" >
                                                        Market Price History
                                                        <button type="button" class="close" data-dismiss="modal"></button>
                                                        <br>
                                                    </td>                 
                                                </tr> 
                                                <tr style="min-width:initial;background-color: white;">   
                                                    <td >Location:&nbsp;&nbsp;<b>{{location[0].location.name | decodeReadOnly}}</b></td> 
                                                    <td >Product:&nbsp;&nbsp;<b>{{product.product.name | decodeReadOnly}}</b></td> 
                                                </tr> 
                                                <tr  style="width:100%;min-width:initial;background-color: rgb(235, 230, 230);">  
                                                    <td style="width:25%;border-right: 5px solid #fff;">Date</td> 
                                                    <td style="width:25%;">Market Price</td> 
                                                </tr>
                                            </thead>  
                                            <tbody style="min-width:initial">
                                                <tr  ng-repeat="entity in marketPriceHistoryList"> 
                                                    <td >{{$ctrl.formatDate(entity.date, $ctrl.tenantSetting.tenantFormats.dateFormat.name)}} </td>
                                                    <td >{{entity.price | number : $ctrl.numberPrecision.pricePrecision}}&nbsp;{{entity.currencies }}</td> 
                                                </tr>
                                            </tbody>                                     
                                        </table> 
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </span> 
                    <span class="pull-right bg-grey font-dark" style="padding: 5px;position: absolute;right: 0;top: 50%;transform: translateY(-50%);" ng-mouseover="$ctrl.getWidth('.groupOfRequestTableTooltipLastProduct'); marketPrice['seller.id + product.id'] = true;" ng-mouseout="marketPrice['seller.id + product.id'] = false">
                        <span style="z-index: 999;" ng-class="requestProducts.length - 1 == $index ? 'groupOfRequestTableTooltipLastProduct' : 'groupOfRequestTableTooltip'" ng-show="marketPrice['seller.id + product.id'] && $ctrl.getMarketPricePopup(product, location)" ng-bind-html="$ctrl.getMarketPricePopup(product, location)"></span>
                        <span class="pull-right" ng-mouseover="$ctrl.gettWidthTooltip(groupOfRequestTableTooltip)">
                            {{maxQuantity.quotePrice != null ? (maxQuantity.quotePrice | number : $ctrl.numberPrecision.amountPrecision) : "-"}}
                        </span>
                    </span>
                </span>
            </td>

                <td ng-repeat-end ng-show="!$ctrl.isRequestTabExpanded($parent.$index)" style="padding: 0px !important;">
    
                </td>
                <td ng-repeat-end ng-hide="true"></td>
                <!-- End expanded request tab -->

    
            </tr>
    
            <tr ng-repeat-start="(key, seller) in $ctrl.getSortedLocationSellers(location)"
                ng-init="seller.isCloned ? sellerDetails = {} : sellerDetails = $ctrl.sellers[seller.sellerCounterparty.id]; seller.isInSearch = true; seller.viewEditRatingIcon = false"
                ng-show="seller.shouldBeVisible && seller.isInSearch "
                style="{{seller.isNotInterested == true ? 'background: #bec4c5!important' : ''}}"
                class="bg-white {{seller.packageType == 'seller' ? 'pkgSellerRow' : '' }} {{seller.packageType == 'buyer' ? 'pkgBuyerRow' : '' }} "
                >
                <td style="text-align: center;">

                    <span class="hidden">{{ seller.shouldBeVisible = $ctrl.calculateSellerIsVisible(key, seller, location) }}</span>

                    <span ng-if="seller.packageType != 'seller' && seller.packageType != 'buyer' ">
                        <span>&nbsp;</span>

                    </span>
    
                    <div style="display: flex;align-items: center;justify-content: space-around;font-size: 14px;height: 100%;margin-top: -10px;">
                        <a style="padding: 0; width:21px; height:21px; font-size: 20px;width: 21px;height: 21px;"  ng-if="seller.packageType != 'seller' && seller.packageType != 'buyer' " class="st-btn-icon" ng-click="$ctrl.duplicateSeller(seller, location, $event)" >
                            <b>+</b>
                        </a>
                        <a style="padding: 0; width:21px; height:21px; font-size: 20px;width: 21px;height: 21px;"  class="st-btn-icon" ng-click="$ctrl.removeSellerRevokedRFQsFromLocation(seller, location)">
                            <b>-</b>
                        </a>
                    </div>

    
                    <span class="hidden">
                        {{sellerDetails = $ctrl.sellers[seller.sellerCounterparty.id]}}
                    </span>
    
                </td>
                <td>
                    <label class="mt-checkbox mt-checkbox-outline" ng-if="seller.packageType == 'individual' ">

                        <input  type="checkbox" ng-checked="$ctrl.hasCounterpartyAllRowRequirements(seller.sellerCounterparty.id, location, seller, location[0].uniqueLocationIdentifier, seller.randUniquePkg)"
                            ng-click="$ctrl.createSellerRequirements(seller, location, $event, location[0].uniqueLocationIdentifier, seller.randUniquePkg, $event)" uniqueLocationIdentifier="{{location[0].uniqueLocationIdentifier}}"/>
                        <span style="left: 6px;"></span>
                    </label>
    
                    <label class="mt-checkbox mt-checkbox-outline" ng-if="seller.packageType == 'seller' || seller.packageType == 'buyer' ">
                        <input  type="checkbox" ng-checked="$ctrl.hasPackageRequirement(seller)" uniqueLocationIdentifier="{{location[0].uniqueLocationIdentifier}}"
                            ng-click="$ctrl.hasPackageRequirement(seller) ? $ctrl.removePackageRequirements(seller, location, productOffer.packageId) : $ctrl.createSellerRequirementsForProductPackage(seller, location)" />
                        <span style="left: 6px;"></span>
                    </label>

    
                </td>
                <td style="max-width:160px; min-width: 160px;">
                    <div style="position:relative">
                        <input class="form-control bg-white" value="{{seller.sellerCounterparty.name | decodeReadOnly}}" ng-readonly="true" style="padding-right: 30px"/>
                        <span ng-init="uniqueCounterpartyType = $ctrl.calculateUniqueCounterpartyType(seller)" style="position: absolute;top: 10px;right: 10px;">
                            <i class="fa fa-user {{uniqueCounterpartyType.counterpartyTypeFontClass}}"></i>
                        </span>
                    </div>
                </td>
                <td style="position: relative;">
                    <div class="input-group physicalSupplier" style="min-width:200px; padding-top: 1px; display: inline-block; float: none; {{$ctrl.packagesConfigurationEnabled && (seller.packageType == 'buyer' || seller.packageType == 'seller') ? 'margin-right: 30px;' : '';}}" ng-if="!$ctrl.fieldVisibility.isPhysicalSupplierHidden" ng-click="$ctrl.checkIfPhysicalSupplierChanged(seller.offers[0].physicalSupplierCounterparty, seller)" >
                        <span ng-init="seller.oldPhysicalSupplier = seller.offers[0].physicalSupplierCounterparty"></span>
                        <input decode-input-format ng-model="seller.offers[0].physicalSupplierCounterparty"
                        class="form-control"
                        placeholder="Physical Supplier"
                        uib-typeahead="seller as seller.name for seller in $ctrl.physicalSupplierList  | typeaheadCustomFilter:$viewValue:'name'"
                        ng-blur="$ctrl.updatePhysicalSupplierForSellers(seller, seller.offers[0].physicalSupplierCounterparty, location, $event);" 
                        ng-click="$ctrl.setLookupInput(null); seller.oldPhysicalSupplier = seller.offers[0].physicalSupplierCounterparty"
                        typeahead-editable="false"                        
                        ng-disabled="$ctrl.disablePhysicalSupplierLookup"
                        style="width: calc(100% - 40px);" 
                        ng-keypress="$ctrl.keyPress()" >

    
                        <!--  new phy supplier modal -->
                        <span ng-controller="Controller_Master as CM"  ng-show="!$ctrl.disablePhysicalSupplierLookup;"  class="input-group-addon" style="line-height: 20px;" ng-click="$ctrl.setLookupInput(null); seller.oldPhysicalSupplier = seller.offers[0].physicalSupplierCounterparty; $ctrl.physicalSupplierUpdate = {'sellerKey': key, 'location': location}; $ctrl.setLookupInput(location); triggerModal('general', 'procurement_requestcounterpartytypes', 'physical_supplier', 'physical_supplier','','', '', [1])">
                            <i class="fa fa-search"></i>
                        </span>
                        <!-- end new phy supplier modal-->
                    </div>
    

                    <div class="input-group" style="min-width:250px; padding-top: 1px; display: inline-block; float: none; {{$ctrl.packagesConfigurationEnabled && (seller.packageType == 'buyer' || seller.packageType == 'seller') ? 'margin-right: 30px;' : '';}}" ng-if="!$ctrl.fieldVisibility.isBrokerHidden" ng-show="$ctrl.counterpartyDetailsIsExpanded">
                        <span ng-init="seller.oldBroker = seller.offers[0].brokerCounterparty"></span>
                        <input  decode-input-format ng-model="seller.offers[0].brokerCounterparty"
                        class="form-control"
                        placeholder="Broker"
                        uib-typeahead="seller as seller.name for seller in $ctrl.brokerList  | typeaheadCustomFilter:$viewValue:'name' | decodeReadOnly"
                        typeahead-on-select="$ctrl.updateBrokerForSellers(seller, seller.offers[0].brokerCounterparty, location)"
                        ng-click="$ctrl.setLookupInput(null); seller.oldBroker = seller.offers[0].brokerCounterparty"
                        typeahead-editable="false"
                        ng-keypress="$ctrl.keyPress()"
                        ng-disabled="$ctrl.disableBrokerLookup || !seller.id"
                        style="width: calc(100% - 40px);">
     
    

    
                         <!--  new broker modal -->
                         <span ng-controller="Controller_Master as CM"  ng-class="{'disabled': !seller.id}"  class="input-group-addon" style="line-height: 20px;" ng-click="$ctrl.setLookupInput(null); seller.oldBroker = seller.offers[0].brokerCounterparty; $ctrl.brokerUpdate = {'sellerKey': key, 'location': location}; $ctrl.setLookupInput(location); triggerModal('general', 'procurement_requestcounterpartytypes', 'broker', 'broker','','', '', [3])">
                            <i class="fa fa-search"></i>
                        </span>
                        <!-- end broker modal-->
                    </div>
    
                    <div class="input-group" style="min-width:250px; padding-top: 1px; display: inline-block; float: none; {{$ctrl.packagesConfigurationEnabled && (seller.packageType == 'buyer' || seller.packageType == 'seller') ? 'margin-right: 30px;' : '';}}" ng-if="!$ctrl.fieldVisibility.isSellerContactHidden" ng-show="$ctrl.counterpartyDetailsIsExpanded">
                        <span ng-init="seller.oldContact = seller.offers[0].contactCounterparty; $ctrl.getContactListForSeller(seller)"></span>
                        <input decode-input-format ng-model="seller.offers[0].contactCounterparty"
                        class="form-control"
                        placeholder="Contact"
                        uib-typeahead="seller as seller.name for seller in $ctrl.sellerContactList['s'+seller.sellerCounterparty.id]  | typeaheadCustomFilter:$viewValue:'name' | decodeReadOnly"
                        typeahead-on-select="$ctrl.updateContactForSellers(seller, seller.offers[0].contactCounterparty, location)"
                        ng-click="$ctrl.setLookupInput(null); seller.oldContact = seller.offers[0].contactCounterparty"
                        typeahead-editable="false"
                        ng-keypress="$ctrl.keyPress()"
                        ng-disabled="$ctrl.disableContactLookup"
                        style="width: calc(100% - 40px);">
                        <span class="input-group-addon"  ng-class="{'disabled': $ctrl.disableContactLookup}" style="line-height: 20px;" ng-click="$ctrl.openContactCounterpartyModal(seller,location); seller.oldContact = seller.offers[0].contactCounterparty">
                            <i class="fa fa-search"></i>
                        </span>
    
                          <!--  new contact modal -->

                        <!-- end contact modal-->
                    </div>
    
                    <span class="rowOfferInfo" ng-if="$ctrl.packagesConfigurationEnabled">

                        <span ng-if="seller.packageType == 'buyer' ">O</span>
                        <span ng-if="seller.packageType == 'seller' ">P{{$ctrl.countUniqueVessels(seller.randUniquePkg)}}</span>
                    </span>
    
                </td>
                <td class="text-center" style="max-width: 65px">

                    <span class="{{seller.id ? '' : 'font-default'}}"  style="font-size: 15px; position:relative; color: #2f353b; cursor: pointer" ng-click="seller.id ? $ctrl.openSellerInterstedModal(seller, location) : '' " ng-mouseover="tooltip['seller.id'] = true; $ctrl.calculateTooltipPosition($event);" ng-mouseleave="tooltip['seller.id'] = false;">
                        <i class="fa fa-ban" style="position: absolute;left: -2px;font-size: 29px;top: 3px; opacity:0.9" ng-if="seller.isNotInterested == true"></i>
                        <i class="fa fa-user"></i>
                        <sup style="left: -5px"><i class="fa fa-commenting-o"></i></sup>
                        <span class="groupOfRequestTableTooltip"  ng-show="tooltip['seller.id'] && seller.isNotInterested ">
                             {{seller.notInterestedComments | decodeReadOnly}}
                        </span>
                    </span>
                    <a ng-click="$ctrl.viewEditCounterpartyBlade(seller.sellerCounterparty.id, location, seller)" >
                        <i class="fa fa-users font-dark"></i>
                    </a>
                </td>
                <td style="width: 65px !important;" ng-mouseleave="seller.viewEditRatingIcon = false"  ng-mouseover="seller.viewEditRatingIcon = true" class="padding">
                    <div style="text-align: center; width: 65px; display: inline-flex;">
                        <div style="width: 40px;"> 
                            <span ng-class="seller.viewEditRatingIcon? 'rating-with-border' : '' ">
                                <span class="hidden">
                                    {{seller.rating = $ctrl.getSellerRatingForCounterpartyForSpecificLocation(location, seller.sellerCounterparty.id)}} 
                                </span>
                                {{seller.rating ? $ctrl.formatNumber(seller.rating) : 'NA'}}
                            </span>
                        </div>
                        <span>
                            <i style="color: #337AB7; font-size: 18px;" ng-click="$ctrl.viewBladeSellerRating(seller.sellerCounterparty.id, location, seller)" class="fa fa-star"></i>
                        </span>
                    </div>
                </td>
                <td style="text-align: center;">

                    <i style="margin-right: 8px;" class="glyphicon glyphicon-envelope clickable {{ $ctrl.checkIfSellerHasRFQ(seller.randUniquePkg, location) }}" ng-click="$ctrl.previewEmail(seller, location)" ></i>
               

                    <i class="fa fa-refresh clickable" data-toggle="modal" href="#requote"
                        ng-class="{'font-grey' : !$ctrl.hasSellerRequirements(seller.sellerCounterparty.id, location, seller)}"
                        ng-click="$ctrl.hasSellerRequirements(seller.sellerCounterparty.id, location, seller) ? $ctrl.viewRequote(seller, location, true) : '' "
                        ng-if="seller.packageType == 'individual'"></i>
                    <i class="fa fa-refresh clickable" data-toggle="modal" href="#requote"
                        ng-class="{'font-grey' : !$ctrl.hasPackageRequirement(seller)}"
                        ng-click="$ctrl.hasPackageRequirement(seller) ? $ctrl.viewRequote(seller, location) : '' "
                        ng-if="seller.packageType == 'seller' || seller.packageType == 'buyer' "></i>
                </td>
    
                    
                <td ng-if="$ctrl.counterpartyCommentsVisibility == 1" ng-show="$ctrl.allExpanded" style="padding:0 !important">

                    <div ng-mouseover="generalSellerStatustooltip['seller.id'] = true; $ctrl.setWidthTooltip(seller)" ng-mouseout="generalSellerStatustooltip['seller.id'] = false" class="pull-left energy-content-cell" style="position:relative; width:100px; height: 100%;overflow:visible;">
                        <span style="max-width: 100%; overflow: hidden;display: block; text-overflow: ellipsis;">{{seller.generalSellerStatus}}</span>
                      <span class="groupOfRequestTableTooltip" ng-show="generalSellerStatustooltip['seller.id'] && seller.generalSellerStatus">{{seller.generalSellerStatus}}</span>
                    </div> 

                    <div ng-mouseover="generalSellerCommenttooltip['seller.id'] = true; $ctrl.setWidthTooltip(seller) " ng-mouseleave="generalSellerCommenttooltip['seller.id'] = false;" tooltip-trigger="click" data-original-title="{{seller.generalSellerComment}}" class="pull-left energy-content-cell" style="position:relative; width:100px; height: 100%;overflow:visible;">
                        <span style="max-width: 100%; overflow: hidden; display: block; text-overflow: ellipsis;">{{seller.generalSellerComment}}</span>
                        <span class="groupOfRequestTableTooltip" ng-show="generalSellerCommenttooltip['seller.id'] && seller.generalSellerComment">{{seller.generalSellerComment | decodeReadOnly}}</span>
                    </div>
                    <div ng-mouseover="portSellerStatustooltip['seller.id'] = true; $ctrl.setWidthTooltip(seller)" ng-mouseleave="portSellerStatustooltip['seller.id'] = false;" class="pull-left energy-content-cell" style="position:relative; width:100px; height: 100%; overflow:visible;">
                        <span style="max-width: 100%; overflow: hidden;display: block; text-overflow: ellipsis;">{{seller.portSellerStatus}}</span>
                        <span class="groupOfRequestTableTooltip" ng-show="portSellerStatustooltip['seller.id'] && seller.portSellerStatus">{{seller.portSellerStatus}}</span>
                    </div>
                    <div ng-mouseover="portSellerCommenttooltip['seller.id'] = true; $ctrl.setWidthTooltip(seller)" ng-mouseleave="portSellerCommenttooltip['seller.id'] = false;" class="pull-left energy-content-cell" style="position:relative; width:100px; height: 100%; overflow:visible;">
                        <span style="max-width: 100%; overflow: hidden;display: block; text-overflow: ellipsis;">{{seller.portSellerComment}}</span>
                        <span class="groupOfRequestTableTooltip" ng-show="portSellerCommenttooltip['seller.id'] && seller.portSellerComment">{{seller.portSellerComment | decodeReadOnly}}</span>
                    </div>                    

                </td>
                <!-- collapsed history tab -->
             
              </td>
    
                      <!-- volume -->
                <td ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" ng-class="{'bg-baby-blue-light': $index % 2 != 0, 'bg-baby-blue-dark': $index % 2 == 0}" title="3m">{{sellerDetails.volume3m | number : $ctrl.numberPrecision.amountPrecision }}</td>
                <td ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" ng-class="{'bg-baby-blue-light': $index % 2 != 0, 'bg-baby-blue-dark': $index % 2 == 0}" title="6m">{{sellerDetails.volume6m | number : $ctrl.numberPrecision.amountPrecision }}</td>
                <td ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" ng-class="{'bg-baby-blue-light': $index % 2 != 0, 'bg-baby-blue-dark': $index % 2 == 0}" title="12m">{{sellerDetails.volume12m | number : $ctrl.numberPrecision.amountPrecision }}</td>
    
                    <!-- exposure -->
                <td ng-if="$ctrl.sellerHistoryVisibility == 1 && !$ctrl.tenantSetting.shiptechLite" ng-show="$ctrl.isSellerHistoryExpanded" ng-class="{'bg-baby-blue-light': $index % 2 != 0, 'bg-baby-blue-dark': $index % 2 == 0}" title="exposure">
                    <div class="stack-bar" ng-if="sellerDetails.exposureLeft !== undefined && sellerDetails.exposureRight !== undefined">
                        <div class="stack-bar-inner stack-bar-left" ng-style="{width: $ctrl.calcStackBarStyles(sellerDetails.exposureLeft, sellerDetails.exposureRight).left}">
                            {{sellerDetails.exposureLeft | number : $ctrl.numberPrecision.amountPrecision }}
                        </div>
                        <div class="stack-bar-inner stack-bar-right" ng-style="{width: $ctrl.calcStackBarStyles(sellerDetails.exposureLeft, sellerDetails.exposureRight).right}">
                            {{sellerDetails.exposureRight | number : $ctrl.numberPrecision.amountPrecision }}
                        </div>
                    </div></td>
    
                    <!-- claims 12m-->
                <td ng-if="$ctrl.sellerHistoryVisibility == 1  && !$ctrl.tenantSetting.shiptechLite" ng-show="$ctrl.isSellerHistoryExpanded" ng-class="{'bg-baby-blue-light': $index % 2 != 0, 'bg-baby-blue-dark': $index % 2 == 0}" title="closedClaims12mValue">
                        <div class="stack-bar" ng-if="sellerDetails.closedClaims12mValue !== undefined && sellerDetails.openClaims12mValue !== undefined">
                            <div class="stack-bar-inner stack-bar-left" ng-style="{width: $ctrl.calcStackBarStyles(sellerDetails.closedClaims12mValue, sellerDetails.openClaims12mValue).left}">
                                {{sellerDetails.closedClaims12mValue | number : $ctrl.numberPrecision.amountPrecision }}
                            </div>
                            <div class="stack-bar-inner stack-bar-right-dark" ng-style="{width: $ctrl.calcStackBarStyles(sellerDetails.closedClaims12mValue, sellerDetails.openClaims12mValue).right}">
                                {{sellerDetails.openClaims12mValue | number : $ctrl.numberPrecision.amountPrecision }}
                            </div>
                        </div>
                    </td>
    
              
    
                <!-- average drop value -->
                <td ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" ng-class="{'bg-baby-blue-light': $index % 2 != 0, 'bg-baby-blue-dark': $index % 2 == 0}" title="averageDropValue">{{sellerDetails.averageDropValue}}</td>
    

                    <!-- win rate-->
                <td ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" ng-class="{'bg-baby-blue-light': $index % 2 != 0, 'bg-baby-blue-dark': $index % 2 == 0}" title="winRate12mValue">{{sellerDetails.winRate12mValue}}</td>
    
                <!-- expanded history tab -->
               
                <td ng-if="$ctrl.sellerHistoryVisibility == 1" ng-show="$ctrl.isSellerHistoryExpanded" ng-class="{'bg-baby-blue-light': $index % 2 != 0, 'bg-baby-blue-dark': $index % 2 == 0}" title="sellerPaymentTerm" colspan="{{$ctrl.colspanPayment}}">

                    {{sellerDetails.sellerPaymentTerm}}

                </td>
                <!-- end expanded history tab -->
    
    
    
    
                <!-- Collapsed request tab -->
                <td ng-repeat-start="(rpkey,requestProducts) in $ctrl.products track by $index"
                    ng-show="$ctrl.isRequestTabExpanded($index)"
                    ng-init=""
                    colspan="2" class="left-border border-selected-left right-border border-selected-right">
                    <span ng-if="seller.isCloned">-</span>
                    <span ng-if="!seller.isCloned">
                        <span class="hidden">

                            {{seller.totalAmountInRequest = $ctrl.calculateTotalAmountForProductsPerRequestperSeller(requestProducts, location, seller)}}

                        </span>
                            {{ seller.totalAmountInRequest > 0 ? (seller.totalAmountInRequest | number : $ctrl.numberPrecision.amountPrecision) : "-" }}
    
                    </span>
                </td>
                <!-- End collapsed request tab -->
    
    
                <td ng-show="!$ctrl.isRequestTabExpanded($index)" class="left-border border-selected-left">
                    <span> <!-- ??mail?? --> </span>&nbsp;&nbsp;
                    <span style="position: relative;" >
    
                        <a ng-click="$ctrl.viewSupplierCardBlade(seller, location, requestProducts); $ctrl.supplierCardActiveRequestId = requestProducts[0].requestId" ng-show="!$ctrl.getRequestComment(requestProducts, product, location, seller.sellerCounterparty.id, seller)" class="font-dark">
                            <b>
                                <i class="fa fa-clone"></i>
                            </b>
                        </a>


                        <span class="groupOfRequestTableTooltip" ng-show="tooltip[seller.id + '-' + location[0].uniqueLocationIdentifier + '-' + location[0].requestId]">{{$ctrl.getRequestComment(requestProducts, product, location, seller.sellerCounterparty.id, seller) | decodeReadOnly }}</span>

                        <a ng-click="$ctrl.viewSupplierCardBlade(seller, location, requestProducts); $ctrl.supplierCardActiveRequestId = requestProducts[0].requestId" ng-show="$ctrl.getRequestComment(requestProducts, product, location, seller.sellerCounterparty.id, seller)" class="font-dark" ng-mouseover="tooltip[seller.id + '-' + location[0].uniqueLocationIdentifier + '-' + location[0].requestId] = true" ng-mouseout="tooltip[seller.id + '-' + location[0].uniqueLocationIdentifier + '-' + location[0].requestId] = false" data-original-title="{{$ctrl.getRequestComment(requestProducts, product, location, seller.sellerCounterparty.id, seller) | decodeReadOnly}} ">
                            <b>
                                <i class="fa fa-clone" style="color: #e8a404;text-shadow: 1px 1px 0px;font-weight: bold;"></i>
                            </b>
                        </a>

                    </span>&nbsp;&nbsp;
                </td>

                <td ng-show="!$ctrl.isRequestTabExpanded($index)" class="border-selected-left" style="display: none">
                    <!-- ??Terms?? -->

                    <div class="input-group" style="min-width:180px; display: inline-block; float: none;">
                        <span ng-init="incoterm = $ctrl.getIncoterm(requestProducts[0].requestId, location, seller)"></span>

                        <select ng-options="defaultIncoterm as defaultIncoterm.name for defaultIncoterm in $ctrl.lists.Incoterm track by defaultIncoterm.id" class="select form-control" ng-model="incoterm.incoterm" title="{{incoterm.incoterm.id}}" ng-change="$ctrl.updateIncoterm(incoterm.incoterm, location, seller, requestProducts[0].requestId)" ng-disabled="incoterm.hasSellerOffer == 0"></select>
                    </div>
                </td>
    
                <!-- Expanded request tab -->
                <td ng-show="!$ctrl.isRequestTabExpanded($index)" class="border-selected-left {{ $ctrl.isMinimumTotal(requestProducts, location,seller) ? 'bg-green-jungle' : '' }}" ng-class="{fakeHideColumn : $ctrl.totalColumnIsHidden == true }">
                    <span ng-if="!seller.isCloned">
                        <span class="hidden">
                            {{seller.totalAmountInRequest = $ctrl.calculateTotalAmountForProductsPerRequestperSeller(requestProducts, location, seller)}}
                        </span>
                        {{ seller.totalAmountInRequest > 0 ? (seller.totalAmountInRequest | number : $ctrl.numberPrecision.amountPrecision) : "-" }}
                    </span>
                </td>
                <td ng-repeat-start="(pkey,productTop) in requestProducts" ng-show="!$ctrl.isRequestTabExpanded($parent.$index)" style="position: relative;"
                    ng-init="productTop.productLocations['L' + location[0].uniqueLocationIdentifier] ? product = productTop.productLocations['L' + location[0].uniqueLocationIdentifier] : '';
                                product ? (productOffer = $ctrl.getSellerProductOfferOnLocationRewrite(product, location, seller.sellerCounterparty.id, seller)) : '';
                                product ? (maxQuantity = $ctrl.getProductMaxQuantityOnLocation(product, location)) : '';
                                product ? (productAvailable = $ctrl.productAvailableOnLocation(product, location)) : ''
                                
                            "
                            ng-attr-style="{{!productOffer.id && !seller.isCloned && seller.packageId ? 'opacity: 0.5' : '';}}">
                    <span ng-if="product">
                        <span class="hidden">
                            {{productOffer = $ctrl.getSellerProductOfferOnLocationRewrite(product, location, seller.sellerCounterparty.id, seller)}}
                            {{productStatus = $ctrl.getSellerProductStatusOnLocation(product, location, seller)}}
                            {{requestStatus = $ctrl.getSellerRequestStatusOnLocation(product, location, seller)}}
                        </span>

                            <span class="hidden">
                                {{productOffer.id ? seller.isCloned = false : ''}}
                        </span>
                            <form class="form-inline" style="position: relative; width: 100%;">

                                <div class="form-group GORpriceCheckbox {{$ctrl.checkIfIsPrefferedProductForSeller(product.product.id, seller) ? 'isPreferredProduct' : 'isNotPreferredProduct' }} {{productOffer.id ? 'hasOffer' : '' }} " ng-mouseover="quotedProductTooltip['productOffer.id'] = true" ng-mouseout="quotedProductTooltip['productOffer.id'] = false" style="width: 100%; height: 34px; position: absolute; top: -16px;display: flex;align-items:center; justify-content: start; flex-direction: row;">

                                    <span ng-if="$ctrl.resetSellerInitChecks" ng-init="($ctrl.sellerShouldBeCheckedOnInit(location[0].location.id, product.id, seller.sellerCounterparty.id, seller.randUniquePkg, location[0].uniqueLocationIdentifier)) ? $ctrl.createSellerRequirementsForProduct(seller, location, product, location[0].uniqueLocationIdentifier, seller.randUniquePkg) : ''" class="hidden"></span>

                                    <span ng-if="!$ctrl.prefferedSellerCheckbox" ng-init="($ctrl.sellerShouldBeCheckedOnInit(location[0].location.id, product.id, seller.sellerCounterparty.id, seller.randUniquePkg, location[0].uniqueLocationIdentifier)) ? $ctrl.createSellerRequirementsForProduct(seller, location, product, location[0].uniqueLocationIdentifier, seller.randUniquePkg) : '' "></span>
                                    <label style="margin-left:5px" class="mt-checkbox mt-checkbox-outline pull-left" ng-hide="!productAvailable || productStatus == 'Stemmed' || productOffer.hasNoQuote" ng-if="seller.packageType == 'individual' ">
                                        <input unique-row-identifier="{{seller.randUniquePkg}}-{{location[0].uniqueLocationIdentifier}}" type="checkbox" ng-disabled="!productAvailable || productStatus == 'Stemmed' || productOffer.hasNoQuote" class="checkSlr"ng-checked="$ctrl.hasSellerProductRequirements(seller, location, seller.offers[0].physicalSupplierCounterparty.id, product, productOffer)"
                                        ng-click="$ctrl.createSellerRequirementsForProduct(seller, location, product, location[0].uniqueLocationIdentifier, seller.randUniquePkg, $event)"/>
                                        <span style="height: 23px;width: 23px; top: -1px"></span>
                                    </label>
                                    <!-- package action -->
                                    <label class="mt-checkbox mt-checkbox-outline pull-left" ng-hide="!productAvailable || productOffer.hasNoQuote" style="{{productOffer.hasNoQuote ? 'opacity:0' : ''}}" ng-if="productOffer.packageId != null">
                                        <input type="checkbox" ng-disabled="!productAvailable || productOffer.hasNoQuote" class="checkSlr"
                                        ng-checked="$ctrl.hasPackageRequirement(seller)"
                                        ng-click="$ctrl.hasPackageRequirement(seller) ? $ctrl.removePackageRequirements(seller, location, productOffer.packageId) : $ctrl.createSellerRequirementsForProductPackage(seller, location)"/>
                                        <span style="height: 23px;width: 23px;"></span>
                                    </label>
                                    <span ng-show="!productOffer.id || seller.isCloned" >-</span>
                                    <span ng-if="productOffer.id && !seller.isCloned" style="display: flex; justify-content: space-between; align-items: center;">
                                      <label style="margin-left: 5px;" class="mt-checkbox mt-checkbox-outline pull-left" ng-show="productOffer.hasNoQuote" style="">
                                        <input type="checkbox" ng-disabled="!productAvailable" class="checkSlr" product-offer-id="{{productOffer.id}}" has-no-quote="{{productOffer.hasNoQuote}}" ng-model="$ctrl.selectedNoQuoteItems['nq'+productOffer.id]" ng-change="$ctrl.listOfNoQuote(seller, location, product, productOffer)">
                                        <span style="height: 23px;width: 23px; margin-top: -4px;"></span>
                                      </label>
                                        <span style="display: none" ng-if="!productOffer.price">
                                            {{productOffer.price = (productOffer.price | number : $ctrl.numberPrecision.pricePrecision)}}
                                        </span>
<!--                                         {{productOffer.supplyDeliveryDate}}
										{{productOffer.supplyQuantity}} -->
                                        <input ng-if="productOffer !== null && !seller.isCloned" type="text" ng-disabled="productOffer.hasNoQuote || $ctrl.priceInputsDisabled || productStatus == 'Stemmed'" class="form-control pull-right productOfferPrice {{ ($ctrl.isMinimumAmountOrTco(productOffer) && productOffer.totalAmount && !productOffer.energyParameterValues.tco) ? 'bg-green-jungle' : '' }}" ng-model="productOffer.price" ng-focus="$ctrl.checkIfPriceChanged(productOffer.price); oldPrice = productOffer.price" style="max-width:110px; width: calc(100%); {{productOffer.price ? 'width:calc(100% - 25px);' : '' }}" ng-blur="$ctrl.savePriceChange(productOffer.price, productOffer.id, seller, location, product)" ng-hide="productOffer.hasNoQuote" productPriceIndexNo="{{1+locationIndex+''+key+''+rpkey+''+pkey}}" ng-keydown="$ctrl.goToNextPriceInput($event)" ng-class="{'differentQuotedProduct': productOffer.quotedProduct.id !=  productTop.product.id}" ng-mouseover="quotedProductTooltip['productOffer.id'] = true" format="number:{{$ctrl.numberPrecision.pricePrecision}}" tooltip tooltip-trigger="hover" data-original-title="{{location[0].portRestrictionComments | decodeReadOnly}}" >
                                      
                                        <span ng-style="{'color': 'white' }" class="groupOfRequestTableTooltip" 
                                        	ng-show="(quotedProductTooltip['productOffer.id'] && (productOffer.quotedProduct.id != productTop.product.id)) || ( quotedProductTooltip['productOffer.id'] && (productOffer.maxQuantity != productOffer.supplyQuantity && productOffer.computedEta != productOffer.supplyDeliveryDate))" style="top: -50%;"> 
                                        	<div ng-if="quotedProductTooltip['productOffer.id'] && (productOffer.quotedProduct.id != productTop.product.id)">
	                                        	{{ productOffer.quotedProduct.name }}
                                        	</div>
                                        	<div ng-if="productOffer.maxQuantity != productOffer.supplyQuantity && productOffer.computedEta != productOffer.supplyDeliveryDate">
	                                        	Supply Qty : {{productOffer.supplyQuantity}}
	                                        	<br>
	                                        	Delivery Date : {{$ctrl.formatDate(productOffer.supplyDeliveryDate, $ctrl.tenantSetting.tenantFormats.dateFormat.name)}}
                                        	</div>
	                                    </span>
                                      <input class="form-control pull-left {{ ($ctrl.isMinimumAmountOrTco(productOffer) && productOffer.totalAmount && !productOffer.energyParameterValues.tco) ? 'bg-green-jungle' : '' }}" style="max-width:110px; width: calc(100% - 50px); {{productOffer.price ? 'width:calc(100% - 75px);' : '' }}" type="text" ng-show="productOffer.hasNoQuote" value="No Quote" disabled>
                                        <i ng-if="productOffer.price && !seller.isCloned" class="fa fa-external-link clickable pull-right" ng-click="$ctrl.setLatestOfferProduct(product, location, seller)" data-toggle="modal" href="#prices" style="line-height: 35px;margin-left: 10px;"></i>
                                    </span>
                                </div>
                            </form>                         
                    </span>
                </td>
    
                <td ng-repeat-end ng-show="!$ctrl.isRequestTabExpanded($parent.$index)" ng-attr-style="padding: 0px !important; {{!productOffer.id && !seller.isCloned && seller.packageId ? 'opacity: 0.5' : '';}};"  >
                    <span ng-show="$ctrl.energyContentExpanded['prod'+product.requestId+pkey]">

                        <div style="width:100px" class="energy-content-cell priceGap">
                            {{!productOffer.energyParameterValues.priceGap ?  ( 0 | number : $ctrl.numberPrecision.pricePrecision )  : ( productOffer.energyParameterValues.priceGap  | number : $ctrl.numberPrecision.pricePrecision ) }}
                        </div>
                        <div style="width:100px" class="energy-content-cell tco {{ ($ctrl.isMinimumAmountOrTco(productOffer) && productOffer.totalAmount && productOffer.energyParameterValues.tco) ? 'bg-green-jungle' : '' }}">
                            {{productOffer.energyParameterValues.tco ? (productOffer.energyParameterValues.tco | number : $ctrl.numberPrecision.amountPrecision) : '-'}}
                        </div>

                    </span>
                    <span ng-show="$ctrl.priceExpanded['prod'+product.requestId+pkey] || $ctrl.isEnergyCalculationRequired">
                        <div style="width:100px;" class="energy-content-cell" ng-if="$ctrl.displayAdditionalCostColumn">
                            <!-- add cost -->
                            {{(productOffer !== null) ? (productOffer.additionalCostPerUnit * maxQuantity.qty | number : $ctrl.numberPrecision.amountPrecision) : "-" }}
                        </div>
                        <div style="width:100px" class="energy-content-cell">
                            <!-- total price -->
                            {{(productOffer.price + productOffer.additionalCostPerUnit) | number : $ctrl.numberPrecision.pricePrecision}}
                        </div>                    
                        <div style="width:100px" class="energy-content-cell ">
                            <!-- amount -->
                            <span ng-if="$ctrl.negotiationDisplayDecimal">
                                {{( (!productOffer.totalAmount) ? (0 | number : $ctrl.numberPrecision.amountPrecision) : (productOffer.totalAmount | number : $ctrl.numberPrecision.amountPrecision))}}
                            </span>
                           <span ng-if="!$ctrl.negotiationDisplayDecimal">
                                {{ !productOffer.totalAmount ? 0 : ($ctrl.stripDecimals(productOffer.totalAmount) | number : 0) }}
                                
                            </span>                         
                        </div>
                    </span>
                    <span ng-show="$ctrl.energyContentExpanded['prod'+product.requestId+pkey]">
                        <div style="width:50px" class="energy-content-cell icon text-center">
                            <span ng-show="productOffer.id && !seller.isCloned && product.isEnergyCalculationRequired" >
                                <a href="" ng-click="$ctrl.viewEnergyContentBlade(seller, location, requestProducts, productOffer);$ctrl.getSellerOffers(seller, location);"><i class="fa fa-table font-dark"></i></a>
                            </span>
                        </div>
                    </span>                    
                </td>
                <td ng-repeat-end ng-hide="true"></td>
                <!-- End expanded request tab -->
            </tr>
            <tr ng-repeat-end ng-hide="true" ></tr>
            <tr>
                <td colspan="7" class="bg-grey-steel">
                    <span class="hidden" ng-init="$ctrl.gorTableRendered($index)"></span>
                    <i class="fa fa-angle-double-down" ng-show="!location[0].sellersExpanded" ng-click="location[0].sellersExpanded = !location[0].sellersExpanded"></i>
                    <i class="fa fa-angle-double-up" ng-show="location[0].sellersExpanded" ng-click="location[0].sellersExpanded = !location[0].sellersExpanded"></i>
                    <span ng-if="$ctrl.searchTermNegotiationTable.length > 0" >
                        <b><i>Search Result: {{$ctrl.findTotalSellersOnLocation(location).found}} found of {{$ctrl.findTotalSellersOnLocation(location).total}}</i></b>
                    </span>
                    <span ng-if="$ctrl.searchTermNegotiationTable.length == 0 || !$ctrl.searchTermNegotiationTable " >
                        <b><i>Search Result: {{$ctrl.findTotalSellersOnLocation(location).total}} found</i></b>
                    </span>
                </td>
            </tr>
            <tr ng-repeat-end ng-hide="true"></tr>
        </tbody>
    </table>
    
    
    </div>
    
    
