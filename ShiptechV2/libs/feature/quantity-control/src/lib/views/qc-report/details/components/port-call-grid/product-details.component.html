<ag-grid-angular
  AgGridExternalSearch
  [gridOptions]="viewModel.gridViewModel.gridOptions"
  [rowData]="viewModel.productTypes$ | async"
  [onSearch]="viewModel.gridViewModel.onSearch.bind(viewModel.gridViewModel)"
  appAgGridFilterPresets
  appAgGridFirstColumnLocked
  appAgGridSizeToFit
  appDeselectFiltredRows
  class="ag-theme-balham"
  groupId="quantityControlCallView"
  id="quantityControlProductsGrid"
  style="height:500px">
</ag-grid-angular>


<ng-template [columnDef]="viewModel.gridViewModel.bdnDeliveredQuantityCol"
             appTemplateRenderer
             let-model="data.model" let-value="value">
  <ng-container>
    <div fxLayout="row" fxLayoutAlign="center center">
      <a href="#">{{value | number: viewModel.numberDisplayFormat}}</a>
    </div>
  </ng-container>
</ng-template>

<ng-template [columnDef]="[
              viewModel.gridViewModel.robBeforeDeliveryColGroup,
              viewModel.gridViewModel.robAfterDeliveryColGroup,
              viewModel.gridViewModel.deliveredQuantityColGroup]"
             appHeaderRenderer
             let-title="title">
  <div class="ag-header-group-cell-label p-2" ref="agContainer">
    <div class="row" style="width: 100%">
      <div class="col-6">
        <span class="ag-header-group-text" ref="agLabel">{{ title }}</span>
      </div>
      <div class="col-6">
        <shiptech-uom-selector></shiptech-uom-selector>
      </div>
    </div>
  </div>
</ng-template>


<ng-template [columnDef]="[
              viewModel.gridViewModel.logBookBeforeDeliveryCol,
              viewModel.gridViewModel.measuredRobBeforeDeliveryCol,
              viewModel.gridViewModel.measuredDeliveredQuantityCol,
              viewModel.gridViewModel.logBookAfterDeliveryCol,
              viewModel.gridViewModel.measuredRobAfterDeliveryCol]"
             appTemplateRenderer let-column="column" let-model="data" let-value="value">
  <ng-container>
    <div fxLayout="row" fxLayoutAlign="center center">
      <p-inputMask
        (ngModelChange)="viewModel.updateProductType(column, model, $event)"
        [mask]="viewModel.numberMaskFormat"
        [ngModelOptions]="{updateOn: 'blur'}"
        [ngModel]="value"></p-inputMask>
    </div>
  </ng-container>
</ng-template>


<ng-template [columnDef]="[
             viewModel.gridViewModel.differenceDeliveredQuantityCol,
             viewModel.gridViewModel.differenceRobBeforeDeliveryCol,
             viewModel.gridViewModel.differenceRobAfterDeliveryCol]"
             appTemplateRenderer
             let-model="data.model" let-value="value">
  <ng-container>
    <!--    TODO: Add UOM conversion -->
    <div fxLayout="row" fxLayoutAlign="center center">
      <div class="row">
        <div class="col-6">{{value | number: viewModel.numberDisplayFormat}}</div>
        <div class="col-6" style="border-left: 1px solid grey;">UOM</div>
      </div>
    </div>
  </ng-container>
</ng-template>
