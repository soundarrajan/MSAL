<div class="row">
    <div class="st-main-content-menu st-displaceable-menu tabbable-line">
        <div class="pull-left">
            <div class=" form-inline">
                <span>
                    <span   class="select_visible_sections_label">
                        Display:
                    </span>
                    <select id="multiple" ng-model="visible_sections" class="form-control selectpicker col-md-8 visibleSectionsFilter" multiple multi-select data-selected-text-format="count> 3"  ng-change="showHideSections(visible_sections)">
                        <option value="" disabled=""></option>
                        <option value="vessel_details">
                            Vessel Details
                        </option>
                        <option value="request_details">
                            Request Details
                        </option>
                    </select>
                    <label class="mt-checkbox">
                        <input type="checkbox" ng-model="moreInformations" ng-init="moreInformations = true" >
                        <span></span>
                        More Information
                    </label>
                </span>
            </div>
        </div>

        <div class="pull-right buttons">
            <div class="st-new-request-form">
                <a class="control-label select_from" ng-click="$ctrl.goEmail()" style="{{$ctrl.previewEmailDisabled ? ('opacity:0.5') : '';}}" ng-class="{'disabled' : $ctrl.isReadonlyForm || $ctrl.previewEmailDisabled || $ctrl.disableAllFields}">
                    Email Preview
                    <i class="glyphicon glyphicon-envelope"></i>
                </a>
            </div>

            
              
            <a class="btn orange btn-outline" ng-show="$ctrl.request.requestStatus.id == $ctrl.STATUS.PartiallyStemmed.id" ng-click="$ctrl.completeRequest()">
                Complete Request
            </a> 
            <a ng-show="$ctrl.canSave($ctrl.screenActions) && !$ctrl.disableAllFields" class="btn orange btn-outline" ng-click="$ctrl.saveRequest()" ng-class="{'disabled' : $ctrl.buttonsDisabled}">
                Save
            </a>
            <a class="btn orange btn-outline" ng-click="$ctrl.confirmContractSelection()" ng-show="$ctrl.contractHasProduct && $ctrl.canSave($ctrl.screenActions) && $ctrl.checkGoContract() && !$ctrl.selectedContractHasStemmedProduct" ng-class="{'disabled' : $ctrl.buttonsDisabled}">
                Proceed to order
            </a>
            <a ng-show="$ctrl.canSave($ctrl.screenActions) && $ctrl.hasAction($ctrl.SCREEN_ACTIONS.GOSPOT)" class="btn orange btn-outline" ng-click="$ctrl.goSpot(true)" ng-class="{'disabled' : $ctrl.buttonsDisabled}">
                Go spot
            </a>
            <div class="btn-group">
                <a class="btn btn-default dropdown-toggle st-show-buttons" data-toggle="dropdown" aria-expanded="false" ng-class="{'disabled' : $ctrl.extraButtons() || $ctrl.buttonsDisabled}">
                    &hellip;
                </a>
                <ul class="dropdown-menu st-extra-buttons" role="menu">
                    <li ng-if="$ctrl.hasAction($ctrl.SCREEN_ACTIONS.COPY) && $ctrl.request.requestStatus.name != 'Cancelled'">
                        <a ng-click="$ctrl.copyRequest()">
                            Copy
                        </a>
                    </li>
                    <!-- <li ng-if="$ctrl.hasAction($ctrl.SCREEN_ACTIONS.CANCEL)">
                        <a ng-click="$ctrl.cancelRequest()">
                            Cancel
                        </a>
                    </li> -->
                    <li ng-if="$ctrl.canCancel()> 0">
                        <a ng-click="$ctrl.showCancelRequestConfirm()">
                            Cancel
                        </a>
                    </li>
                    <li ng-if="$ctrl.canValidate()> 0">
                        <a ng-click="$ctrl.validatePreRequest()">
                            Validate
                        </a>
                    </li>
                    <li ng-if="$ctrl.canQuestionnaire()> 0">
                        <a ng-click="$ctrl.sendQuestionnaire()">
                            Send Questionnaire
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="st-main-content-menu st-displaceable-menu tabbable-line tabs_bar"  ng-show="moreInformations">
        <ul class="nav nav-tabs pull-left">
            <li class="open">
                <a>
                    Request
                </a>
            </li>
            <li>
                <a ng-class="{'disabled' : !$ctrl.request.id}" ui-sref="default.view-request-documents({requestId: NAV.requestId})" >
                    Documents
                </a>
            </li>
            <li>
                <a ng-class="{'disabled' : !$ctrl.request.id}" ui-sref="default.view-request-emaillog({requestId: NAV.requestId})">
                    Email Log
                </a>
            </li>
            <li>
                <a ng-class="{'disabled' : !$ctrl.request.id}" ui-sref="default.view-request-auditlog({requestId: NAV.requestId})">
                    Audit Log
                </a>
            </li>
<!--             <li>
                <a>
                    Configure UI
                </a>
            </li>
            <li>
                <a>
                    Rate Supplier
                </a>
            </li> -->
        </ul>
        <div class="clearfix"></div>
    </div>
</div>
<fieldset ng-disabled="$ctrl.isReadonlyForm">
    <div class="row">
        <div class="portlet light" ng-hide="visible_sections.indexOf('vessel_details') < 0">
            <div class="portlet-title">
                <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title=""></a>
                </div>
                <div class="caption">
                    <span class="caption-subject">
                        Vessel Details 
                </span>
            </div>
        </div>
        <div class="portlet-body" ng-controller="Controller_Master as CM">

            <form id="vesselDetails" class="form-inline st-new-request-form collapse in" name="forms.vesselDetailsForm" novalidate autocomplete="off">
                <div sorted-form field-ids="$ctrl.ui.vesselDetails.fields" get-from-id="vesselDetails">
                    <!-- Not implemented -->
                </div>
                <div class="container-fluid">
                <div class="row">

                    <div ng-if="$ctrl.vesselDetailsFields.Vessel.visible" class="col-md-4" ng-init='CM.getOptions({"Name": "Vessel","masterSource": "Vessel"})' tooltip data-original-title="{{ $ctrl.defaultProductsTooltip() }}">
                        <div class="row" >
                            <label class="control-label col-md-5">
                                {{ $ctrl.vesselDetailsFields.Vessel.caption | translate }}
                            </label>
                            <div class="form-group-sm00">
                                <div class="input-group col-md-7" >
                                    <input name="{{ $ctrl.vesselDetailsFields.Vessel.name }}" id="id_{{ $ctrl.vesselDetailsFields.Vessel.name }}" uib-typeahead="vessel as vessel.name for vessel in options.Vessel | filter:$viewValue | limitTo:5" typeahead-on-select="$ctrl.selectVessel($item.id); CM.getOptions({'Name': 'BunkerablePort','masterSource': 'masters_locations', 'filters': $ctrl.request.vesselDetails.vessel})" typeahead-editable="false" class="typeahead form-control" ng-model="$ctrl.request.vesselDetails.vessel.name" required  ng-disabled="$ctrl.request.id || $ctrl.disableAllFields">
                                    <span class="input-group-addon" ng-click="triggerModal('general', 'masters_vessellist', $ctrl.vesselDetailsFields.Vessel.caption | translate, '$ctrl.request.vesselDetails.vessel','','',$ctrl.vesselDetailsFields.Vessel.name)"  ng-class="{'disabled' : ($ctrl.isReadonlyForm || $ctrl.request.id)}" ng-disabled="$ctrl.request.id || $ctrl.disableAllFields">
                                        <i class="fa fa-search"></i>
                                        <!-- ng-click="$ctrl.setDialogType($ctrl.vesselDetailsFields.Vessel.name)" -->
                                    </span>
                                    <span class="input-group-addon" data-toggle="modal"  href="#route_schedule" tooltip data-original-title="View Vessel Voyage" ng-class="{'disabled' : $ctrl.isReadonlyForm}" ng-disabled="!$ctrl.request.vesselDetails.vessel || $ctrl.disableAllFields">
                                        <i class="fa fa-anchor"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div ng-if="$ctrl.vesselDetailsFields.VesselImoNo.visible" class="col-md-4" ng-init='CM.getOptions({"Name": "VesselWithImo","masterSource": "VesselWithImo"})' tooltip data-original-title="{{ $ctrl.defaultProductsTooltip() }}">
                        <div class="row">
                            <label class="control-label col-md-5">
                                {{ $ctrl.vesselDetailsFields.VesselImoNo.caption | translate }}
                            </label>
                            <div class="form-group-sm00">
                                <span ng-init="$ctrl.options.VesselWithImo = options.VesselWithImo" ng-if="$ctrl.options.VesselWithImo"></span>
                                <div class="input-group col-md-7">
                                    <input ng-disabled="$ctrl.requestId ? true : false || $ctrl.disableAllFields" name="{{ $ctrl.vesselDetailsFields.VesselImoNo.name }}" id="id_{{ $ctrl.vesselDetailsFields.VesselImoNo.name }}" placeholder="{{ $ctrl.vesselDetailsFields.VesselImoNo.placeholder }}" uib-typeahead="vesselimo as vesselimo.name for vesselimo in options.VesselWithImo | filter:$viewValue  | limitTo:5" typeahead-on-select="$ctrl.selectVessel($item.id)" typeahead-editable="false" class="typeahead form-control" ng-model="$ctrl.request.vesselDetails.vesselImoNo" required >
                                    <span ng-disabled="$ctrl.requestId ? true : false || $ctrl.disableAllFields" class="input-group-addon"  ng-click="triggerModal('general', 'masters_vessellist', $ctrl.vesselDetailsFields.VesselImoNo.caption | translate, '$ctrl.request.vesselDetails.vesselImoNo','','',$ctrl.vesselDetailsFields.VesselImoNo.name)" ng-class="{'disabled' : $ctrl.isReadonlyForm}">
                                        <i class="fa fa-search"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <span ng-if="$ctrl.requestTenantSettings.displayOfService.id == 1">
                        <div ng-if="$ctrl.vesselDetailsFields.ServiceCode.visible" class="col-md-4" ng-init='CM.getOptions({"Name": "Service","masterSource": "Service"})'>
                            <div class="row">
                                <label class="control-label col-md-5" >
                                	{{ $ctrl.tenantSettings.serviceDisplayName.name + ' Code' | translate }}
                                </label>
                                <div class="form-group-sm00">
                                    <div class="input-group col-md-7" >
                                        <input ng-disabled="$ctrl.disableAllFields" name="{{ $ctrl.vesselDetailsFields.ServiceCode.name }}" id="id_{{ $ctrl.vesselDetailsFields.ServiceCode.name }}" placeholder="{{ $ctrl.vesselDetailsFields.ServiceCode.placeholder }}" uib-typeahead="service as service.name for service in options.Service | filter:$viewValue | limitTo:5" typeahead-on-select="$ctrl.selectService($item.id)" typeahead-editable="false" class="typeahead form-control" ng-model="$ctrl.request.vesselDetails.service.name" required >
                                      
                                        <span ng-disabled="$ctrl.disableAllFields" class="input-group-addon" ng-class="{'disabled' : $ctrl.isReadonlyForm}" ng-click="triggerModal('general', 'masters_servicelist', $ctrl.tenantSettings.serviceDisplayName.name + ' Code' | translate, '$ctrl.request.vesselDetails.service','','',$ctrl.vesselDetailsFields.ServiceCode.name)">
                                            <i class="fa fa-search"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </span>


                    <div ng-if="$ctrl.vesselDetailsFields.Chartered.visible" class="col-md-4 checkbox_keep_height">
                        <div class="row">
                            <label class="control-label col-md-5">
                                {{ $ctrl.vesselDetailsFields.Chartered.caption | translate }}
                            </label>
                            <div class="form-group-sm">
                                <div class="input-group col-md-7 row">
                                    <label class="mt-checkbox mt-checkbox-outline">
                                        <input name="{{ $ctrl.vesselDetailsFields.Chartered.name }}" id="id_{{ $ctrl.vesselDetailsFields.Chartered.name }}" placeholder="{{ $ctrl.vesselDetailsFields.Chartered.placeholder }}" type="checkbox" ng-checked="($ctrl.lists.VesselOwnership | filter: {id : $ctrl.request.vesselDetails.vesselOwnershipId})[0].name == 'Chartered'" disabled >
                                        <span></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <span ng-if="$ctrl.requestTenantSettings.displayOfCompany.id == 1">
                        <div ng-if="$ctrl.vesselDetailsFields.Company.visible" class="col-md-4">
                            <div class="row" >
                                <label class="control-label col-md-5">
                                    {{ $ctrl.tenantSettings.companyDisplayName.name | translate }}
                                </label>
                                <div class="form-group-sm00">
                                    <div class="input-group col-md-7">
                                        <input name="{{ $ctrl.vesselDetailsFields.Company.name }}" id="id_{{ $ctrl.vesselDetailsFields.Company.name }}" placeholder="{{ $ctrl.vesselDetailsFields.Company.placeholder }}" uib-typeahead="company as company.name for company in $ctrl.lists.Company | filter:$viewValue | limitTo:5" typeahead-on-select="$ctrl.selectCompany($item.id)" typeahead-editable="false" class="typeahead form-control" ng-model="$ctrl.request.company.name" required >
                                        <span class="input-group-addon"  ng-click="triggerModal('general', 'masters_companylist', $ctrl.tenantSettings.companyDisplayName.name | translate, '$ctrl.request.company.name','','',$ctrl.vesselDetailsFields.Company.name)"  ng-class="{'disabled' : $ctrl.isReadonlyForm}">
                                            <i class="fa fa-search"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </span>

                    <div ng-if="$ctrl.vesselDetailsFields.RequestDate.visible" class="col-md-4 ">
                        <div class="row">
                            <label class="control-label col-md-5">
                                {{ $ctrl.vesselDetailsFields.RequestDate.caption | translate }}
                            </label>
                            <div class="form-group-sm00">
                                <div class="input-group col-md-7">
                                    <input name="{{ $ctrl.vesselDetailsFields.RequestDate.name }}" id="id_{{ $ctrl.vesselDetailsFields.RequestDate.name }}" placeholder="{{ $ctrl.vesselDetailsFields.RequestDate.placeholder }}" class="form-control date form_meridian_datetime" ng-model="$ctrl.request.requestDate" st-date-format st-date-to-local disabled >
                                    <span class="input-group-addon disabled">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div ng-if="$ctrl.vesselDetailsFields.linebreak_1.visible" class="clearfix"></div>
                    </div> <!-- .row -->
                    </div> <!-- .container-fluid -->
                </form>

            <div class="clearfix"></div>
        </div>
    </div>

<!-- ROB Details -->
	<div >
        <div class="portlet light" ng-if="$ctrl.vesselCharteredDetails.vesselOwnership.id == 2">
            <div class="portlet-title">
                <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title=""></a>
                </div>
                <div class="caption">
                    <span class="caption-subject">
                        <!-- ROB Details -->
                        Chartering details
                </span>
            </div>
	    </div>
        <div class="portlet-body">

			<!-- <span ng-if="$ctrl.request.vesselDetails.vessel.id" ng-init="$ctrl.selectVessel($ctrl.request.vesselDetails.vessel.id)"></span> -->
        	<form id="charteringDetails"  class="form-inline st-new-request-form collapse in" novalidate autocomplete="off">
        		<div class="row">
        			<div class="col-sm-4">
        				<div class="row">
							<label class="control-label col-md-5">
							    Charterer Name
							</label>
							<div class="form-group-sm00" >
							    <div class="input-group col-sm-7">
							        <input  name="chartererName" readonly="" class="form-control" ng-model="$ctrl.vesselCharteredDetails.chartererName">
							    </div>
							</div>
		        		</div>
        			</div>
		        	<div class="col-sm-4">
		        		<div class="row">
							<label class="control-label col-md-5">
							    Delivery Date
							</label>
							<div class="form-group-sm00" >
							    <div class="input-group col-sm-7">
							        <input  name="delivery" readonly="" class="form-control" st-date-format ng-model="$ctrl.vesselCharteredDetails.delivery">
							        <span class="input-group-addon bg-grey-steel disabled">
							            <i class="glyphicon glyphicon-calendar"></i>
							        </span>
							    </div>
							</div>
		        		</div>
		        	</div>
		        	<div class="col-sm-4">
		        		<div class="row">
							<label class="control-label col-md-5">
							    Expiry Date
							</label>
							<div class="form-group-sm00" >
							    <div class="input-group col-sm-7">
							        <input  name="expiry" readonly="" class="form-control" st-date-format ng-model="$ctrl.vesselCharteredDetails.expiry" >
							        <span class="input-group-addon bg-grey-steel disabled">
							            <i class="glyphicon glyphicon-calendar"></i>
							        </span>
							    </div>
							</div>
		        		</div>
                    </div>
                    <div ng-if="$ctrl.vesselDetailsFields.EarliestRedeliveryDate.visible && ($ctrl.lists.VesselOwnership | filter: {id : $ctrl.request.vesselDetails.vesselOwnershipId})[0].name == 'Chartered'" class="col-md-4">
                        <div class="row">
                            <label class="control-label col-md-5">
                                {{ $ctrl.vesselDetailsFields.EarliestRedeliveryDate.caption | translate }}
                            </label>
                            <div class="form-group-sm00">
                                <div class="input-group col-md-7">
                                    <input name="{{ $ctrl.vesselDetailsFields.EarliestRedeliveryDate.name }}" only-date="true" id="id_{{ $ctrl.vesselDetailsFields.EarliestRedeliveryDate.name }}" placeholder="{{ $ctrl.vesselDetailsFields.EarliestRedeliveryDate.placeholder }}" class="form-control date form_meridian_datetime" ng-model="$ctrl.request.vesselDetails.earliestRedeliveryDate" st-date-format readonly="" >
                                    <span class="input-group-addon bg-grey-steel disabled">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-if="$ctrl.vesselDetailsFields.EstimatedRedeliveryDate.visible && ($ctrl.lists.VesselOwnership | filter: {id : $ctrl.request.vesselDetails.vesselOwnershipId})[0].name == 'Chartered'" class="col-md-4">
                        <div class="row">
                            <label class="control-label col-md-5">
                                {{ $ctrl.vesselDetailsFields.EstimatedRedeliveryDate.caption | translate }}
                            </label>
                            <div class="form-group-sm00">
                                <div class="input-group col-md-7">
                                    <input name="{{ $ctrl.vesselDetailsFields.EstimatedRedeliveryDate.name }}" only-date="true" id="id_{{ $ctrl.vesselDetailsFields.EstimatedRedeliveryDate.name }}" placeholder="{{ $ctrl.vesselDetailsFields.EstimatedRedeliveryDate.placeholder }}" class="form-control date form_meridian_datetime" ng-model="$ctrl.request.vesselDetails.estimatedRedeliveryDate" st-date-format readonly="" >
                                    <span class="input-group-addon bg-grey-steel disabled">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-if="$ctrl.vesselDetailsFields.LatestRedeliveryDate.visible && ($ctrl.lists.VesselOwnership | filter: {id : $ctrl.request.vesselDetails.vesselOwnershipId})[0].name == 'Chartered'" class="col-md-4">
                        <div class="row">
                            <label class="control-label col-md-5">
                                {{ $ctrl.vesselDetailsFields.LatestRedeliveryDate.caption | translate }}
                            </label>
                            <div class="form-group-sm00">
                                <div class="input-group col-md-7">
                                    <input name="{{ $ctrl.vesselDetailsFields.LatestRedeliveryDate.name }}" only-date="true" id="id_{{ $ctrl.vesselDetailsFields.LatestRedeliveryDate.name }}" placeholder="{{ $ctrl.vesselDetailsFields.LatestRedeliveryDate.placeholder }}" class="form-control date form_meridian_datetime" ng-model="$ctrl.request.vesselDetails.latestRedeliveryDate" st-date-format readonly="" >
                                    <span class="input-group-addon bg-grey-steel disabled">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
		        	<div class="col-sm-4">
		        		<div class="row">
							<label class="control-label col-md-5">
							    Latest Redelivery Port
							</label>
							<div class="form-group-sm00" >
							    <div class="input-group col-sm-7">
							        <input  name="redeliveryLocation" readonly="" class="form-control" ng-model="$ctrl.vesselCharteredDetails.redeliveryLocation.name">
                                    <span class="input-group-addon bg-grey-steel disabled"  ng-class="{'disabled' : $ctrl.isReadonlyForm}" ng-click="triggerModal('general', 'procurement_location', 'Select Latest Redelivery Port', '', '', '', 'ports', $ctrl.vesselCharteredDetails.redeliveryLocation.name)" ng-disabled="!$ctrl.request.vesselDetails.vessel || $ctrl.disableAllFields">
                                        <!-- procurement_bunkerableport -->
                                        <!-- masters_locationlist -->
                                        <i class="fa fa-search"></i>
                                    </span>
							    </div>
							</div>
		        		</div>
		        	</div>

        		</div>
        	</form>


	        <form id="RobDetails" class="form-inline st-new-request-form collapse in" name="forms.robDetailsForm" novalidate autocomplete="off">

       	        <div class="row">
		        	<div class="col-sm-4">
		        		<div class="row">
							<label class="control-label col-md-5">
							    ROB Date
							</label>
							<div class="form-group-sm00" >
							    <div class="input-group col-sm-7">
							        <input  name="robDate" readonly="" class="form-control" ng-model="$ctrl.robDetails.robDate" st-date-format >
							        <span class="input-group-addon bg-grey-steel disabled">
							            <i class="glyphicon glyphicon-calendar"></i>
							        </span>
							    </div>
							</div>
		        		</div>
		        	</div>
		        </div>
       	        <div class="row">
		        	<div class="col-sm-4">
		        		<div class="row">
							<label class="control-label col-md-5">
							    ROB HSFO on Delivery
							</label>
							<div class="form-group-sm00" >
							    <div class="input-group col-sm-7">
							        <input  name="robDate" readonly="" class="form-control" ng-model="$ctrl.robDetails.robHsfoDeliveryQuantity" >
							        <span class="input-group-addon bg-grey-steel disabled">
							            {{$ctrl.robDetails.robHsfoDeliveryUom.name}}
							        </span>
							    </div>
							</div>
		        		</div>
		        	</div>
		        	<div class="col-sm-4">
		        		<div class="row">
							<label class="control-label col-md-5">
							    ROB LSFO on Delivery
							</label>
							<div class="form-group-sm00" >
							    <div class="input-group col-sm-7">
							        <input  name="robDate" readonly="" class="form-control" ng-model="$ctrl.robDetails.robLsfoDeliveryQuantity" >
							        <span class="input-group-addon bg-grey-steel disabled">
							            {{$ctrl.robDetails.robLsfoDeliveryUom.name}}
							        </span>
							    </div>
							</div>
		        		</div>
		        	</div>
		        	<div class="col-sm-4">
		        		<div class="row">
							<label class="control-label col-md-5">
							   ROB DO/GO on Delivery
							</label>
							<div class="form-group-sm00" >
							    <div class="input-group col-sm-7">
							        <input  name="robDate" readonly="" class="form-control" ng-model="$ctrl.robDetails.robDoGoDeliveryQuantity" >
							        <span class="input-group-addon bg-grey-steel disabled">
							            {{$ctrl.robDetails.robDoGoDeliveryUom.name}}
							        </span>
							    </div>
							</div>
		        		</div>
		        	</div>
		        	<div class="col-sm-4">
		        		<div class="row">
							<label class="control-label col-md-5">
							   ROB HSFO on Redelivery
							</label>
							<div class="form-group-sm00" >
							    <div class="input-group col-sm-7">
							        <input  name="robDate" readonly="" class="form-control" ng-model="$ctrl.robDetails.robHsfoRedeliveryQuantity" >
							        <span class="input-group-addon bg-grey-steel disabled">
							            {{$ctrl.robDetails.robHsfoRedeliveryUom.name}}
							        </span>
							    </div>
							</div>
		        		</div>
		        	</div>
		        	<div class="col-sm-4">
		        		<div class="row">
							<label class="control-label col-md-5">
							    ROB LSFO on Redelivery
							</label>
							<div class="form-group-sm00" >
							    <div class="input-group col-sm-7">
							        <input  name="robDate" readonly="" class="form-control" ng-model="$ctrl.robDetails.robLsfoRedeliveryQuantity" >
							        <span class="input-group-addon bg-grey-steel disabled">
							            {{$ctrl.robDetails.robLsfoRedeliveryUom.name}}
							        </span>
							    </div>
							</div>
		        		</div>
		        	</div>
		        	<div class="col-sm-4">
		        		<div class="row">
							<label class="control-label col-md-5">
							    ROB DO/GO on Redelivery
							</label>
							<div class="form-group-sm00" >
							    <div class="input-group col-sm-7">
							        <input  name="robDate" readonly="" class="form-control" ng-model="$ctrl.robDetails.robDoGoRedeliveryQuantity" >
							        <span class="input-group-addon bg-grey-steel disabled">
							            {{$ctrl.robDetails.robDoGoRedeliveryUom.name}}
							        </span>
							    </div>
							</div>
		        		</div>
		        	</div>
		        </div>

	        </form>
	        <div class="clearfix"></div>
        </div>

	</div>
<!-- END ROB Details -->

    <div class="portlet light" ng-hide="visible_sections.indexOf('request_details') < 0">
        <div class="portlet-title">
            <div class="tools">
                <a href="javascript:;" class="collapse" data-original-title="" title=""></a>
            </div>
            <div class="caption">
                <span class="caption-subject">
                    Request Details - REQ {{ $ctrl.stateParams.requestId }}
                </span>
            </div>
            <div class="pull-right" ng-if="$ctrl.request.requestGroup.id">
                <b>
                    View Negotiation details:
                    <a href="#/group-of-requests/{{ $ctrl.request.requestGroup.id }}">
                        {{ $ctrl.request.requestGroup.id }}
                    </a>
                </b>
            </div>
        </div>
        <div class="portlet-body">
            <div class="row">
                <div class="col-md-12">

                </div>
                <div class="col-md-12" ng-controller="Controller_Master as CM">
                    <form class="form-inline st-new-request-form ports" name="forms.portsForm" novalidate autocomplete="off">
                        <div class="form-group-sm00 row">
                            <div class="input-group col-md-3">
                                <label class="control-label col-md-5" ng-init='CM.getOptions({"Name": "BunkerablePort","masterSource": "masters_locations"})'>
                                    Select Bunkerable Port
                                </label>
                                <div class="form-group-sm00">
                                    <div class="input-group col-md-7">
                                 <input name="ports" id="id_Ports" ng-model="dumm" class="typeahead form-control" ng-class="{'ng-invalid': $ctrl.request.locations.length == 0}" uib-typeahead="destPort as destPort.name for destPort in updateDestinations($viewValue)" type="text" typeahead-on-select="addTypeLocation(dumm.id, dumm)" typeahead-loading="$ctrl.loadedTypeaheadPort" typeahead-wait-ms="100" ng-model-options="{ allowInvalid: false, debounce: 100 }" ng-disabled="!$ctrl.request.vesselDetails.vessel || $ctrl.disableAllFields">
                                        <!-- <a ng&#45;class="{'disabled' : !$ctrl.request.vesselDetails.vessel}" class="input&#45;group&#45;addon" ng&#45;click="$ctrl.setDialogType('Voyages'); portsModal = true;" data&#45;toggle="modal" href="#lookup_dialog" ng&#45;class="{'disabled' : $ctrl.isReadonlyForm}"> -->
                                        <!--     <i class="fa fa&#45;search"></i> -->
                                        <!-- </a> -->

<!-- {{options.BunkerablePort}} -->
<!-- {{CM.listsCache.Location}} -->
                                        <!-- <input name="ports" id="id_Ports" uib&#45;typeahead="destPort as destPort.name for destPort in CM.listsCache.Location | filter:{name: $viewValue} | limitTo:5" typeahead&#45;on&#45;select="addTypeLocation($ctrl.new_location.id, $ctrl.new_location)" typeahead&#45;editable="false" class="typeahead form&#45;control" ng&#45;model="$ctrl.new_location" ng&#45;disabled="!$ctrl.request.vesselDetails.vessel"> -->
                                        <span class="input-group-addon"  ng-class="{'disabled' : $ctrl.isReadonlyForm}" ng-click="triggerModal('general', 'procurement_bunkerableport', 'Bunkerable Port', '$ctrl.new_location' ,'','', 'ports', $ctrl.request.vesselDetails.vessel)" ng-disabled="!$ctrl.request.vesselDetails.vessel || $ctrl.disableAllFields">
                                            <!-- procurement_bunkerableport -->
                                            <!-- masters_locationlist -->
                                            <i class="fa fa-search"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 label-list">
                                <span ng-repeat="location in $ctrl.request.locations" class="tag label label-info" ng-if="!location.isDeleted && location.location !== null" data-original-title=" {{ location.location.name }}">
                                    <!-- <i ng-click="$ctrl.deleteLocation(location)" class="fa fa-close clickable" ng-class="{'disabled' : $ctrl.isReadonlyForm}"></i> -->
                                    <a href="javascript:;" ng-click="$ctrl.showDeleteLocationConfirm(location)" ng-disabled="$ctrl.disableAllFields">
                                        <i class="fa fa-close clickable" ng-class="{'disabled' : $ctrl.isReadonlyForm}"></i>
                                        {{location.location.name }}
                                    </a>
                                </span>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <hr >
            <div class=" product-info" ng-controller="Controller_Master as CM">
                <div ng-repeat="(locationIdx, location) in $ctrl.request.locations track by $index" ng-if="!location.isDeleted && location.location !== null">
                    <div class="" ng-init="$ctrl.initializeDateInputs(); $ctrl.isEnabledEta(locationIdx)" ng-mouseover="$ctrl.initializeDateInputs()">
                        <div class="st-product-info-form-container">
                            <form class="st-new-request-form form-horizontal" name="forms.locationForm[$index]" novalidate autocomplete="off">
                                <div class="col-md-12 location-label">
                                    <span class="caption-subject row">
                                        <a role="button" data-toggle="collapse" href="#location{{ $index }}"  >
                                            <i class="fa fa-angle-double-down"></i>
                                        </a>
                                        {{ location.location.name }} 
	                                    {{ location.voyageCode ? ' - '+ location.voyageCode : '' }} 
                                        {{location.portCallId ? ' - '+ location.portCallId : '' }}
                                    </span>
                                </div>
                                <div class="col-md-12" ng-init="">
                                    <div class="row">
                                        <div ng-if="$ctrl.productInfoFields.Eta.visible" class="col-md-4">
                                            <div class="row">
                                                <label class="control-label col-md-4">
                                                    {{ $ctrl.productInfoFields.Eta.caption | translate }}
                                                </label>
                                            <!--     <pre>{{$ctrl.requestTenantSettings}}</pre> -->
                                            <!-- ng-if="$ctrl.isEnabledEta() && location.eta && location.id" -->
                                                <div class="form-group-sm00" ng-if="!$ctrl.etaEnabled[locationIdx]">
                                                    <!-- ng-if="!$ctrl.isEnabledEta(locationIdx)" -->
                                                	<!-- disabled ETA -->
                                                    <div class="input-group col-md-8">
	                                                	<input class="form-control" disabled readonly="" type="text" ng-model="location.eta" name="{{ $ctrl.productInfoFields.Eta.name }}" st-date-format>
	                                                </div>
                                                </div>
                                                <!-- !location.eta || $ctrl.isEnabledEta() || ($ctrl.isEnabledEta() && !location.id) -->
                                                <div class="form-group-sm00" ng-if="$ctrl.etaEnabled[locationIdx]">
                                                	<!-- enabled ETA -->
                                                    <div class="input-group date form_meridian_datetime col-md-8">
                                                        <input  name="{{ $ctrl.productInfoFields.Eta.name }}" readonly="" id="id_{{ $ctrl.productInfoFields.Eta.name }}" class="form-control" ng-model="location.eta" date-before="{{ location.etb }}" st-date-format required ng-change="$ctrl.etaChanged(location, $event)" ng-disabled="$ctrl.disableAllFields">
                                                        <span class="input-group-btn" ng-show="!$ctrl.isReadonlyForm" ng-disabled="$ctrl.disableAllFields">
                                                            <button class="btn btn-sm date-set" type="button" ng-disabled="$ctrl.disableAllFields">
                                                                <i class="fa fa-calendar"></i>
                                                            </button>
                                                        </span>
                                                        <span class="input-group-addon" ng-show="$ctrl.isReadonlyForm" ng-disabled="$ctrl.disableAllFields">
                                                            <i class="glyphicon glyphicon-calendar"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div ng-if="$ctrl.productInfoFields.Etb.visible" class="col-md-4">
                                            <div class="row">
                                                <label class="control-label col-md-4">
                                                    {{ $ctrl.productInfoFields.Etb.caption | translate }}
                                                </label>
                                                <div class="form-group-sm00">
                                                    <div class="input-group date form_meridian_datetime col-md-8">
                                                        <input name="{{ $ctrl.productInfoFields.Etb.name }}" readonly="" id="id_{{ $ctrl.productInfoFields.Etb.name }}" class="form-control" date-before="{{ location.etd }}" ng-model="location.etb" st-date-format required ng-disabled="$ctrl.disableAllFields">
                                                        <span class="input-group-btn" ng-show="!$ctrl.isReadonlyForm">
                                                            <button class="btn btn-sm date-set" type="button" ng-disabled="$ctrl.disableAllFields">
                                                                <i class="fa fa-calendar"></i>
                                                            </button>
                                                        </span>
                                                        <span class="input-group-addon" ng-show="$ctrl.isReadonlyForm" ng-disabled="$ctrl.disableAllFields">
                                                            <i class="glyphicon glyphicon-calendar"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div ng-if="$ctrl.productInfoFields.Etd.visible" class="col-md-4">
                                            <div class="row">
                                                <label class="control-label col-md-4">
                                                    {{ $ctrl.productInfoFields.Etd.caption | translate }}
                                                </label>
                                                <div class="form-group-sm00">
                                                    <div class="input-group date form_meridian_datetime col-md-8">
                                                        <input name="{{ $ctrl.productInfoFields.Etd.name }}" readonly="" id="id_{{ $ctrl.productInfoFields.Etd.name }}" class="form-control" ng-model="location.etd" st-date-format required  ng-class="{'etb_invalid': location.etb > location.etd}" ng-disabled="$ctrl.disableAllFields">
                                                        <span class="input-group-btn" ng-show="!$ctrl.isReadonlyForm">
                                                            <button class="btn btn-sm date-set" type="button" ng-disabled="$ctrl.disableAllFields">
                                                                <i class="fa fa-calendar"></i>
                                                            </button>
                                                        </span>
                                                        <span class="input-group-addon" ng-show="$ctrl.isReadonlyForm" ng-disabled="$ctrl.disableAllFields">
                                                            <i class="glyphicon glyphicon-calendar"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="col-md-4" ng-if="$ctrl.requestTenantSettings.recentEta.id == 1">
                                            <div class="row">
                                                <label class="control-label col-md-4">
                                                    {{ 'PAGES.NEW_REQUEST.RECENT_ETA' | translate }}
                                                </label>
                                                <div class="form-group-sm00">
                                                    <div class="input-group date form_meridian_datetime col-md-8">
                                                        <input name="Recent ETA" readonly="" id="id_Recent_ETA" class="form-control" ng-model="location.recentEta" st-date-format ng-disabled="$ctrl.disableAllFields">
                                                        <span class="input-group-btn" ng-show="!$ctrl.isReadonlyForm" >
                                                            <button class="btn btn-sm date-set" type="button" ng-disabled="$ctrl.disableAllFields">
                                                                <i class="fa fa-calendar"></i>
                                                            </button>
                                                        </span>
                                                        <span class="input-group-addon" ng-show="$ctrl.isReadonlyForm" ng-disabled="$ctrl.disableAllFields">
                                                            <i class="glyphicon glyphicon-calendar"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                       <!-- DELIVERYWINDOWDISPLAY -->
                                        <div class="col-md-4" ng-if="$ctrl.requestTenantSettings.deliveryWindowDisplay.id == 1"  >
                                            <div class="row">
                                                <label class="control-label col-md-4">
                                                    {{ 'PAGES.NEW_REQUEST.DELIVERY_FROM' | translate }}
                                                </label>
                                                <div class="form-group-sm00">
                                                    <div class="input-group date form_meridian_date col-md-8">
                                                        <input name="Delivery From" readonly="" id="id_delivery_from" class="form-control" ng-model="location.deliveryFrom" only-date="true" st-date-format ng-class="{'etb_invalid': $ctrl.datesValid(locationIdx)}" ng-required="true" ng-disabled="$ctrl.disableAllFields">
                                                         <!-- date-before="{{ location.deliveryTo }}" -->
                                                        <span class="input-group-btn" ng-show="!$ctrl.isReadonlyForm">
                                                            <button class="btn btn-sm date-set" type="button" ng-disabled="$ctrl.disableAllFields">
                                                                <i class="fa fa-calendar"></i>
                                                            </button>
                                                        </span>
                                                        <span class="input-group-addon" ng-show="$ctrl.isReadonlyForm" ng-disabled="$ctrl.disableAllFields">
                                                            <i class="glyphicon glyphicon-calendar"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4" ng-if="$ctrl.requestTenantSettings.deliveryWindowDisplay.id == 1"  >
                                            <div class="row">
                                                <label class="control-label col-md-4">
                                                    {{ 'PAGES.NEW_REQUEST.DELIVERY_TO' | translate }}
                                                </label>
                                                <div class="form-group-sm00">
                                                    <div class="input-group date form_meridian_date col-md-8">
                                                        <input name="Delivery To" readonly="" id="id_delivery_to" class="form-control" ng-model="location.deliveryTo" only-date="true" st-date-format ng-class="{'etb_invalid':  $ctrl.datesValid(locationIdx)}" ng-required="true" ng-disabled="$ctrl.disableAllFields">
                                                        <span class="input-group-btn" ng-show="!$ctrl.isReadonlyForm" >
                                                            <button class="btn btn-sm date-set" type="button" ng-disabled="$ctrl.disableAllFields">
                                                                <i class="fa fa-calendar"></i>
                                                            </button>
                                                        </span>
                                                        <span class="input-group-addon" ng-show="$ctrl.isReadonlyForm" ng-disabled="$ctrl.disableAllFields">
                                                            <i class="glyphicon glyphicon-calendar"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                       <!-- END DELIVERYWINDOWDISPLAY -->
                                        <!-- <span ng-init="$ctrl.productInfoFields.DestinationPort.visible = true"></span> -->
                                        <div ng-if="$ctrl.productInfoFields.DestinationPort.visible" class="col-md-4" ng-init='CM.getOptions({"Name": "BunkerablePort","masterSource": "masters_locations"})'>
                                            <div class="row">
                                                <label class="control-label col-md-4">
                                                    {{ $ctrl.productInfoFields.DestinationPort.caption | translate }}
                                                </label>
                                                <div class="form-group-sm00">
                                                    <!-- <span ng-if="location.destination" ng-init="location.destination = location.destination"></span> -->
                                                    <div class="input-group col-md-8">
                                                    	 <!-- {{location.destination}} -->
                                                        <input name="{{ $ctrl.productInfoFields.DestinationPort.name }}{{ $index }}" id="id_{{ $ctrl.productInfoFields.DestinationPort.name }}{{ $index }}" class="typeahead form-control" ng-model="location.destination" uib-typeahead="destPort as destPort.name for destPort in updateDestinations($viewValue)" typeahead-on-select="$ctrl.selectDestinationPort($item, locationIdx)" typeahead-editable="false" ng-model-options="{ allowInvalid: false, debounce: 100 }" typeahead-loading="$ctrl.loadedTypeaheadPort" typeahead-wait-ms="100" data-origina-title="{{ location.destination.name }}" ng-disabled="$ctrl.disableAllFields">
                                                        
                                                <!--         <span class="input-group-addon" data-toggle="modal" href="#lookup_dialog" ng-class="{'disabled' : $ctrl.isReadonlyForm}" ng-click="$ctrl.setDialogTypeDestination('Voyages',location.vesselVoyageDetailId); $ctrl.locationIdx =  $index"> -->
                                                        <span class="input-group-addon" ng-class="{'disabled' : $ctrl.isReadonlyForm}" ng-click="triggerModal('general', 'procurement_destinationport', 'Select Destination Port', '$ctrl.location[' + $index + '].destination','','', $ctrl.productInfoFields.DestinationPort.name + $index, $ctrl.request.vesselDetails.vessel)" ng-disabled="$ctrl.disableAllFields">
                                                            <i class="fa fa-search"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div ng-if="$ctrl.productInfoFields.Buyer.visible" class="col-md-4" ng-init='CM.getOptions({"Name": "Buyer","masterSource": "procurement_buyerslist", filters: $ctrl.request.vesselDetails.vessel})'>
                                            <div class="row">
                                                <label class="control-label col-md-4">
                                                    {{ $ctrl.productInfoFields.Buyer.caption | translate }}
                                                </label>
                                                <!-- <pre>{{location.buyer}}</pre> -->
                                                <div class="form-group-sm00">
                                                    <div class="input-group col-md-8">
                                                        <input name="{{ $ctrl.productInfoFields.Buyer.name }}" id="id_{{ $ctrl.productInfoFields.Buyer.name }}" placeholder="{{ $ctrl.productInfoFields.Buyer.placeholder }}" class="typeahed form-control" uib-typeahead="buyer as buyer.name for buyer in options.Buyer | filter:$viewValue | limitTo:5" ng-model="location.buyer" required typeahead-editable="false" ng-focus="$ctrl.setLookupInput(location)"   ng-blur="location.buyer.name == null || location.buyer.name == '' ? location.buyer = null : '' " ng-value="location.buyer.name" ng-disabled="$ctrl.disableAllFields">

                                                      <!--   <span class="input-group-addon" data-toggle="modal" ng-click="$ctrl.setDialogType($ctrl.productInfoFields.Buyer.name, location)" href="#lookup_dialog" ng-class="{'disabled' : $ctrl.isReadonlyForm}"> -->

                                                            <span class="input-group-addon" ng-class="{'disabled' : $ctrl.isReadonlyForm}" ng-click="triggerModal('general', 'procurement_buyerlist', 'Select Buyer','$ctrl.location[' + $index + '].buyer' ,'','', $$ctrl.productInfoFields.Buyer.name, $ctrl.request.vesselDetails.vessel)" ng-disabled="$ctrl.disableAllFields">
                                                            <i class="glyphicon glyphicon-search"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div ng-if="$ctrl.productInfoFields.Agent.visible" class="col-md-4" ng-init='CM.getOptions({"Name": "Agent","masterSource": "Agent"})'>
                                            <div class="row">
                                                <label class="control-label col-md-4">
                                                    {{ $ctrl.productInfoFields.Agent.caption | translate }}
                                                </label>
                                                <div class="form-group-sm00">

                                                    <div class="input-group col-md-8" ng-if="$ctrl.requestTenantSettings.agentDisplay.name == 'Lookup'">
                                                        <input name="{{ $ctrl.productInfoFields.Agent.name }}" id="id_{{ $ctrl.productInfoFields.Agent.name }}" class="typeahead form-control" uib-typeahead="ag as ag.name for ag in options.Agent | filter:{name:$viewValue} | limitTo:5" typeahead-on-select="$ctrl.agentLocationIdx = $index; $ctrl.selectAgent($item.id)" ng-model="location.agent" typeahead-editable="false" ng-blur="location.agent.name == null || location.agent.name == '' ? location.agent = null : '' " ng-value="location.agent.name" ng-disabled="$ctrl.disableAllFields">
                                                      <!--   <span class="input-group-addon" data-toggle="modal" href="#agents" ng-click="$ctrl.agentLocationIdx = $index;" ng-class="{'disabled' : $ctrl.isReadonlyForm}"> -->
                                                            <span class="input-group-addon" ng-class="{'disabled' : $ctrl.isReadonlyForm}" ng-click="triggerModal('general', 'procurement_agentlist', 'Select Agent', '$ctrl.location[' + $index + '].agent' ,'','', $$ctrl.productInfoFields.Agent.name)" ng-disabled="$ctrl.disableAllFields">
                                                            <i class="glyphicon glyphicon-search"></i>
                                                        </span>
                                                    </div>
                                                    <div class="input-group col-md-8" ng-if="$ctrl.requestTenantSettings.agentDisplay.name == 'Free text'">
                                                        <input name="{{ $ctrl.productInfoFields.Agent.name }}" id="id_{{ $ctrl.productInfoFields.Agent.name }}" class="typeahead form-control" ng-model="location.agentCounterpartyFreeText" ng-disabled="$ctrl.disableAllFields">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

					                    <div class="col-md-4" ng-if="$ctrl.requestTenantSettings.displayOfService.id == 2" ng-init='CM.getOptions({"Name": "Service","masterSource": "Service"})'>
											<span ng-if="location.service.id" ng-init="$ctrl.selectServiceInLocation(location.service.id, $index); "></span>
					                    	<!-- <span ng-init="location.service = $ctrl.vesselDefaultDetails.service" ng-if="!location.service.id">aaaa</span> -->
					                        <div class="row">
					                            <label class="control-label col-md-4">
					                            	{{ $ctrl.tenantSettings.serviceDisplayName.name + ' Code' | translate }} 
					                            </label>
					                            <div class="form-group-sm00">
					                                <div class="input-group col-md-8">
					                                    <input ng-disabled="$ctrl.disableAllFields" name="Location {{$index+1}} {{$ctrl.tenantSettings.serviceDisplayName.name}}" id="id_{{ $ctrl.vesselDetailsFields.ServiceCode.name }}" placeholder="{{ $ctrl.vesselDetailsFields.ServiceCode.placeholder }}" uib-typeahead="service as service.name for service in options.Service | filter:$viewValue | limitTo:5" typeahead-on-select="$ctrl.selectServiceInLocation($item.id, $index)" typeahead-editable="false" class="typeahead form-control" ng-model="location.service.name" required>
					                          <!--           <span class="input-group-addon" data-toggle="modal" ng-click="$ctrl.setDialogType($ctrl.vesselDetailsFields.ServiceCode.name); $ctrl.serviceInLocationIndex = $index" href="#lookup_dialog" ng-class="{'disabled' : $ctrl.isReadonlyForm}"> -->

                                                        <span ng-disabled="$ctrl.disableAllFields" class="input-group-addon" ng-click="triggerModal('general', 'masters_servicelist', $ctrl.tenantSettings.serviceDisplayName.name + ' Code' | translate, '$ctrl.location[' + $index + '].service' ,'','',Location + $index+1 + $ctrl.tenantSettings.serviceDisplayName.name)" >
					                                        <i class="fa fa-search"></i>
					                                    </span>
					                                </div>
					                            </div>
					                        </div>
					                    </div>
                                        <!--  -->
					                    <div class="col-md-4"  ng-if="$ctrl.requestTenantSettings.displayOfCompany.id == 2" ng-init='CM.getOptions({"Name": "Company","masterSource": "Company"})'>
					                    	<!-- <span ng-init="location.company = $ctrl.vesselDefaultDetails.company" ng-if="!location.company.id">bbbb</span> -->
					                        <div class="row">
					                            <label class="control-label col-md-4">
					                                {{ $ctrl.tenantSettings.companyDisplayName.name | translate }}
					                            </label>
					                            <div class="form-group-sm00">
					                                <div class="input-group col-md-8">
					                                    <input name="Location {{$index+1}} {{$ctrl.tenantSettings.companyDisplayName.name}}" id="id_{{ $ctrl.vesselDetailsFields.Company.name }}" placeholder="{{ $ctrl.vesselDetailsFields.Company.placeholder }}" uib-typeahead="company as company.name for company in options.Company | filter:$viewValue | limitTo:5" typeahead-on-select="$ctrl.selectCompanyInLocation($item.id, $index)" typeahead-editable="false" class="typeahead form-control" ng-model="location.company.name" ng-disabled="$ctrl.disableAllFields">
					                                  <!--   <span class="input-group-addon" data-toggle="modal" ng-click="$ctrl.setDialogType($ctrl.vesselDetailsFields.Company.name); $ctrl.companyInLocationIndex = $index" href="#lookup_dialog" ng-class="{'disabled' : $ctrl.isReadonlyForm}">
					                                        <i class="fa fa-search"></i>
					                                    </span> -->
                                                        <span class="input-group-addon" ng-click="triggerModal('general', 'masters_companylist', $ctrl.tenantSettings.serviceDisplayName.name + ' Code' | translate, '$ctrl.location[' + $index + '].company' ,'','',Location + $index+1 + $ctrl.tenantSettings.companyDisplayName.name)" ng-disabled="$ctrl.disableAllFields">
                                                            <i class="fa fa-search"></i>
                                                        </span>
					                                </div>
					                            </div>
					                        </div>
					                    </div>

                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-12">
                            <form class="st-new-request-form form-horizontal collapse in row" name="forms.productForm[$index]" novalidate id="location{{ $index }}" autocomplete="off">
                                <table class="table table-striped table-hover table-bordered table-condensed st-product-info-table" id="product_info_table_{{ $index + 1 }}">
                                    <thead>
                                        <tr>
                                            <th>  &nbsp;
                                                <span class="st-btn-icon" ng-show="!$ctrl.isReadonlyForm">
                                                    <a href="javascript:;" ng-click="$ctrl.addEmptyProduct(location.products, true)" ng-disabled="$ctrl.disableAllFields">
                                                        <i class="fa fa-plus clickable" ></i>
                                                    </a>
                                                </span>
                                            </th>
                                            <th></th>
                                            <th></th>
                                            <th ng-repeat="column in $ctrl.ui.Locations.columns" ng-if="column.visible">
                                                {{ column.caption | translate }}
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- <pre>{{location.products}}</pre> -->
                                        <!-- | orderBy : 'product.productType.name' track by $index -->
                                        <tr ng-repeat="(productIdx,product) in location.products  " ng-if="!product.isDeleted" ng-mouseover="$ctrl.actveProductUniqueIdUi = product.uniqueIdUI">

                                            <td>
                                                <span class="st-btn-icon" ng-show="!$ctrl.isReadonlyForm">
                                                    <a href="javascript:;" ng-click="$ctrl.addEmptyProduct(location.products, true)" ng-disabled="$ctrl.disableAllFields">
                                                        <i class="fa fa-plus clickable" ></i>
                                                    </a>
                                                </span>
                                            </td>

                                            <td>
                                                <span class="st-btn-icon" ng-show="product.productStatus.id != $ctrl.STATUS['Cancelled'].id && !$ctrl.isReadonlyForm && $ctrl.canCancelProduct(product)">
                                                    <!-- <i class="fa fa-minus clickable" ng-click="$ctrl.deleteProductFromLocation(product, location, productIdx, locationIdx, false)"></i> -->
                                                    <!-- {{product.uniqueIdUI}} -->
                                                    <a href="javascript:;" ng-click="$ctrl.showDeleteProductFromLocationConfirm(product, location, productIdx, locationIdx, false)">
                                                        <i class="fa fa-minus clickable" ></i>
                                                    </a>
                                                </span>
                                            </td>

                                            <td>
                                                <label class="mt-checkbox mt-checkbox-outline">
                                                    <input type="checkbox" ng-model="$ctrl.checkedProducts[product.id]" ng-change="$ctrl.calculateScreenActions();$ctrl.addInSelection(product.id);" ng-disabled="$ctrl.isSelectProductDisabled() || $ctrl.disableAllFields" >
                                                    <span></span>
                                                </label>
                                            </td>

                                            <td ng-if="$ctrl.productInfoColumns.Product.visible" width="11%" ng-init="CM.getOptions({'Name': 'Product', 'masterSource': 'Product'})">
                                                <div class="input-group" tooltip tooltiptrigger="hover" data-original-title="{{ $ctrl.getProductTooltipByProductId(product.product.id) }}">
                                                    <input name="{{ $ctrl.productInfoColumns.Product.name }}" id="id_{{ $ctrl.productInfoColumns.Product.name }}" placeholder="{{ $ctrl.productInfoColumns.Product.placeholder }}" class="typeahead form-control" uib-typeahead="prod as prod.name for prod in options.Product | filter:$viewValue | limitTo:5" typeahead-on-select="$ctrl.selectProduct($item.id)" typeahead-editable="false" ng-model="product.product" ng-disabled="product.productStatus.name == 'Cancelled' || product.productStatus.name == 'Stemmed' || $ctrl.disableAllFields" ng-click="$ctrl.setLookupInput(product); $ctrl.requestProductDataOnChange = {'product':product.uniqueIdUI, 'location': locationIdx}" ng-mouseover="$ctrl.actveProductUniqueIdUi = product.uniqueIdUI">

                                                    <!-- span class="input-group-addon" data-toggle="modal" ng-click="$ctrl.setDialogType($ctrl.productInfoColumns.Product.name, product); $ctrl.requestProductDataOnChange = {'product':$index, 'location': locationIdx}" href="#lookup_dialog" ng-class="{'disabled' : $ctrl.isReadonlyForm}"> -->
                                                    <span class="input-group-addon {{(product.productStatus.name == 'Cancelled' || product.productStatus.name == 'Stemmed') ? 'disabled' : ''}}"  ng-click="triggerModal('general', 'masters_productlist', '' , '$ctrl.location[' + locationIdx + '].products[' +  productIdx + ']','','', $ctrl.productInfoColumns.Product.name ); $ctrl.requestProductDataOnChange = {'product':product.uniqueIdUI, 'location': locationIdx}" ng-disabled="$ctrl.disableAllFields" ng-mouseover="$ctrl.actveProductUniqueIdUi = product.uniqueIdUI">
                                                        <i class="fa fa-search"></i>
                                                    </span>
                                                    <!-- <span ng-init="$ctrl.selectProduct(product.product.id)"></span> -->
                                                </div>
                                            </td>

                                            <td ng-if="$ctrl.productInfoColumns.ProductType.visible" width="8%">
                                                <input type="text"  name="ProductType" id="ProductType" class="form-control input-sm" ng-model="product.productType.name" ng-disabled="true" >

                                            </td>
                                            
                                            <td ng-if="$ctrl.productInfoColumns.SpecGroup.visible" width="11%">
                                                <select ng-options="specGroup as specGroup.name for specGroup in product.specGroups track by specGroup.id" ng-model="product.specGroup" class="form-control pull-left" ng-required="product.product !== null"  data-original-title="{{ product.specGroup.name }}" style="width: calc(100% - 20px);" ng-disabled="product.productStatus.name == 'Cancelled' || product.productStatus.name == 'Stemmed' || $ctrl.disableAllFields"></select>
                                                <!-- {{NAV.requestId}} -->
                                                <!-- filteredSpecs['product_'+product.product.id] -->
                                                <a ng-controller="Controller_Master" ng-click="modalSpecGroupEdit(product, NAV.requestId,  'request')" class="pull-left" style="line-height: 34px;margin-left: 5px;" ng-hide="product.productStatus.name == 'Cancelled' || product.productStatus.name == 'Stemmed'" tooltip data-original-title="Open Spec group" ng-disabled="$ctrl.disableAllFields">
                                                    <i class="fa fa-file-text font-grey-cascade"></i>
                                                </a>
                                                <!-- ng-click="$ctrl.editSpecGroup()" -->
                                            </td>
                                            <td ng-if="$ctrl.productInfoColumns.RobOnArrival.visible" width="8%">
                                                <input type="text" format="number:{{ $ctrl.numberPrecision.quantityPrecision }}" name="RobOnArrival" id="RobOnArrival" class="form-control input-sm" ng-model="product.robOnArrival"  data-original-title="{{ product.robOnArrival }}" ng-disabled="product.productStatus.name == 'Cancelled' || product.productStatus.name == 'Stemmed' || $ctrl.disableAllFields">
                                            </td>
                                            <td ng-if="$ctrl.productInfoColumns.DeliveryOption.visible" width="11%">
                                                <select ng-options="deliveryOption as deliveryOption.name for deliveryOption in $ctrl.lists.DeliveryOption track by deliveryOption.id" ng-model="product.deliveryOption" class="form-control"  data-original-title="{{ product.deliveryOption.name }}" ng-disabled="product.productStatus.name == 'Cancelled' || product.productStatus.name == 'Stemmed' ||$ctrl.disableAllFields"></select>
                                            </td>
                                            <!-- ng-init="forms.productForm[$index].MinQuantity_0.$setValidity('required', false)" -->
                                            <td ng-if="$ctrl.productInfoColumns.MinQty.visible" width="8%" >
                                                <input type="text"  format="number:{{ $ctrl.numberPrecision.quantityPrecision }}" name="MinQuantity_{{$index}}" id="MinQuantity_{{$index}}" class="form-control input-sm" ng-model="product.minQuantity" max="{{ product.maxQuantity }}" ng-required="$ctrl.requiredQty && (product.productStatus.name != 'Cancelled' && product.productStatus.name != 'Stemmed')" ng-blur="$ctrl.minQtyBlur(product)"  data-original-title="{{ product.minQuantity }}" ng-disabled="product.productStatus.name == 'Cancelled' || product.productStatus.name == 'Stemmed' || $ctrl.disableAllFields" ng-change="$ctrl.invalidMinMax(product.minQuantity,product.maxQuantity,$index,locationIdx)">
                                            </td>
                                            <td ng-if="$ctrl.productInfoColumns.MaxQty.visible" width="8%">
                                                <input type="text"  format="number:{{ $ctrl.numberPrecision.quantityPrecision }}" name="MaxQuantity_{{$index}}" id="MaxQuantity_{{$index}}" class="form-control input-sm" ng-model="product.maxQuantity" ng-required="$ctrl.requiredQty && (product.productStatus.name != 'Cancelled' && product.productStatus.name != 'Stemmed')" ng-min="{{ product.minQuantity }}"  data-original-title="{{ product.maxQuantity }}" ng-disabled="product.productStatus.name == 'Cancelled' || product.productStatus.name == 'Stemmed' || $ctrl.disableAllFields" ng-change="$ctrl.invalidMinMax(product.minQuantity,product.maxQuantity,$index,locationIdx)">
                                            </td>
                                            <td ng-if="$ctrl.productInfoColumns.Uom.visible" width="8%">
                                                <select ng-options="uomItem as uomItem.name for uomItem in $ctrl.lists.Uom track by uomItem.id" ng-model="product.uom" class="form-control" ng-required="product.product !== null && !$ctrl.requestTenantSettings.isPrerequestEnabled"  data-original-title="{{ product.uom.name }}" ng-disabled="product.productStatus.name == 'Cancelled' || product.productStatus.name == 'Stemmed' || $ctrl.disableAllFields"></select>
                                            </td>
                                            <td ng-if="$ctrl.productInfoColumns.AgreementType.visible" width="12%">

                                                <select ng-options="agreementType as agreementType.name for agreementType in $ctrl.lists.AgreementType track by agreementType.id" ng-model="product.agreementType" class="form-control" ng-required="product.product !== null"  data-original-title="{{ product.agreementType.name }} " ng-disabled="product.productStatus.name == 'Cancelled' || product.productStatus.name == 'Stemmed' || $ctrl.disableAllFields"></select>
                                            </td>
                                            <td>
                                            	<a href="/#/contracts/contract/edit/{{product.contract.contract.id}}">{{product.contract.contract.id}}</a>
                                            </td>
                                            <td ng-if="$ctrl.productInfoColumns.Comment.visible" width="15%">
                                                <input type="text" class="form-control input-sm" ng-disabled="product.productStatus.name == 'Cancelled' || product.productStatus.name == 'Stemmed' || $ctrl.disableAllFields" ng-model="product.comments" >
                                                <!-- {{ product.buyerComments }} -->
                                            </td>
                                            <td ng-if="$ctrl.productInfoColumns.ProductStatus.visible" width="10%">
                                                {{ product.productStatus.displayName ? product.productStatus.displayName: product.productStatus.name }}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <hr >
                            </form>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>
    <div ng-if="$ctrl.request.hasBestContract">
        <!-- <span ng-include="'pages/select-contract/views/select-contract-component.html'"></span> -->
        <select-contract contracts="$ctrl.contracts" contract-has-product="$ctrl.contractHasProduct" selected-contracts="$ctrl.selectedContracts"></select-contract>
    </div>
    <div class="portlet light" style="background: #eeeeee">
        <div class="portlet-body">
            <div class="row">
                <form class="form-inline st-new-request-form" name="forms.footerForm" novalidate autocomplete="off">
                    <!-- <span ng-if="$ctrl.request.vesselDetails.service" ng-init="$ctrl.selectService($ctrl.request.vesselDetails.service.id);"></span> -->
                    <div class="col-md-4">
                        <div class="row">
                            <div ng-if="$ctrl.footerSectionFields.ValidatedBy.visible" class="col-md-12">
                                <div class="row">
                                    <label class="control-label col-md-4">
                                        {{ $ctrl.footerSectionFields.ValidatedBy.caption | translate }}
                                    </label>
                                    <div class="form-group-sm00">
                                        <div class="input-group col-md-6" >
                                        	<span ng-if="$ctrl.request.vesselDetails.service.id && $ctrl.lists" ng-init="$ctrl.selectService($ctrl.request.vesselDetails.service.id)"></span>
                                            <select name="" id="" class="form-control" ng-model="$ctrl.request.footerSection.validatedBy" ng-options="item as item.name for item in $ctrl.lists.contacts track by item.id" ng-disabled="$ctrl.disableAllFields"></select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div ng-if="$ctrl.footerSectionFields.ValidatedBy.visible" class="col-md-12">
                                <div class="row">
                                    <label class="control-label col-md-4">
                                        Email
                                    </label>
                                    <!-- ng-required="$ctrl.requestTenantSettings.isPrerequestEnabled" -->
                                    <div class="form-group-sm00">
                                        <div class="input-group col-md-6">
                                            <input name="{{ $ctrl.footerSectionFields.ValidatedBy.name }}" id="id_{{ $ctrl.footerSectionFields.ValidatedBy.name }}" class="form-control" ng-model="($ctrl.lists.contactEmails | filter:{id: $ctrl.request.footerSection.validatedBy.id})[0].email" ng-disabled="$ctrl.disableAllFields">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="row">
                            <div ng-if="$ctrl.footerSectionFields.GeneralComments.visible" class="col-md-12">
                                <div class="row">
                                    <label class="control-label col-md-2">
                                        {{ $ctrl.footerSectionFields.GeneralComments.caption | translate }}
                                    </label>
                                    <div class="form-group-sm00">
                                        <div class="input-group col-md-10">
                                            <textarea rows="5" class="form-control" name="{{ $ctrl.footerSectionFields.GeneralComments.name }}" id="id_{{ $ctrl.footerSectionFields.GeneralComments.name }}" ng-model="$ctrl.request.footerSection.generalComments" ng-disabled="$ctrl.disableAllFields"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="st-main-content-menu bottom-menu">
            <div class="pull-right buttons">
                <div class="st-new-request-form">
                    <a class="control-label select_from" ng-click="$ctrl.goEmail()" style="{{$ctrl.previewEmailDisabled ? ('opacity:0.5') : '';}}" ng-class="{'disabled' : $ctrl.isReadonlyForm || $ctrl.previewEmailDisabled || $ctrl.disableAllFields}">
                        Email Preview
                        <i class="glyphicon glyphicon-envelope"></i>
                    </a>
                </div>

              
                <a class="btn orange btn-outline" ng-show="$ctrl.request.requestStatus.id == $ctrl.STATUS.PartiallyStemmed.id" ng-click="$ctrl.completeRequest()">
                    Complete Request
                </a> 

                <a ng-show="$ctrl.canSave($ctrl.screenActions) && !$ctrl.disableAllFields" class="btn orange btn-outline" ng-click="$ctrl.saveRequest()" ng-class="{'disabled' : $ctrl.buttonsDisabled }">
                    Save
                </a>
         <!-- {{$ctrl.contractHasProduct }} - {{$ctrl.canSave($ctrl.screenActions)}} - {{$ctrl.checkGoContract()}} - {{!$ctrl.selectedContractHasStemmedProduct}} -->
                <a class="btn orange btn-outline" ng-click="$ctrl.confirmContractSelection()" ng-show="$ctrl.contractHasProduct && $ctrl.canSave($ctrl.screenActions) && $ctrl.checkGoContract() && !$ctrl.selectedContractHasStemmedProduct" ng-class="{'disabled' : $ctrl.buttonsDisabled}">
                    Proceed to order
                </a>
                <a ng-show="$ctrl.canSave($ctrl.screenActions) && $ctrl.hasAction($ctrl.SCREEN_ACTIONS.GOSPOT)" class="btn orange btn-outline" ng-click="$ctrl.goSpot(true)" ng-class="{'disabled' : $ctrl.buttonsDisabled}">
                    Go spot
                </a>
                <div class="btn-group">
                    <a class="btn btn-default dropdown-toggle st-show-buttons" data-toggle="dropdown" aria-expanded="false" ng-class="{'disabled' : $ctrl.extraButtons() || $ctrl.buttonsDisabled}">
                        &hellip;
                    </a>
                    <ul class="dropdown-menu st-extra-buttons" role="menu">
                        <li ng-if="$ctrl.hasAction($ctrl.SCREEN_ACTIONS.COPY) && $ctrl.request.requestStatus.name != 'Cancelled'">
                            <a ng-click="$ctrl.copyRequest()">
                                Copy
                            </a>
                        </li>
                        <!-- <li ng-if="$ctrl.hasAction($ctrl.SCREEN_ACTIONS.CANCEL)"> -->
                        <li ng-if="$ctrl.canCancel() > 0">
                            <a ng-click="$ctrl.showCancelRequestConfirm()">
                                Cancel
                            </a>
                        </li>
                        <li ng-if="$ctrl.canValidate()> 0">
                            <a ng-click="$ctrl.validatePreRequest()">
                                Validate
                            </a>
                        </li>
                        <li ng-if="$ctrl.canQuestionnaire()> 0">
                            <a ng-click="$ctrl.sendQuestionnaire()">
                                Send Questionnaire
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</fieldset>
<!-- <pre>{{$ctrl.requiredQty }}</pre> -->
<lookup-dialog class="modal fade in" id="lookup_dialog" aria-hidden="true" data-width="80%" lookup-type="$ctrl.lookupType" vessel-id="$ctrl.request.vesselId" args="$ctrl.voyageId" on-vessel-select="$ctrl.selectVessel(vessel)" on-company-select="$ctrl.selectCompany(company)" on-location-select="$ctrl.selectPort(location, extraDetails)" on-product-select="$ctrl.selectProduct(product)" on-service-select="$ctrl.selectService(service)" on-buyer-select="$ctrl.selectBuyer(buyer)"></lookup-dialog>
<sellers-dialog class="modal fade in sellers-dialog" id="agents" aria-hidden="true" data-width="90%" seller-types="$ctrl.agentCounterpartyTypeId" on-seller-select="$ctrl.selectAgent(sellerId)"></sellers-dialog>
<vessel-schedule class="modal fade in" id="route_schedule" aria-hidden="true" data-width="66%" vessel-id="$ctrl.request.vesselId" on-vessel-schedules-select="$ctrl.selectVesselSchedules(locations)"></vessel-schedule>
<amend-dialog class="modal fade in" id="amend" aria-hidden="true" on-amend="$ctrl.amendRFQ()" on-reload="$ctrl.reloadRequest()"></amend-dialog>
<spec-group-edit class="modal fade in" aria-hidden="true" data-width="66%">
    <span ng-controller="Controller_Master as CM">
        <div  id="grid_specGroupParameters" external-scopes="clickHandler"  ui-grid-edit ui-grid-row-edit ui-grid-auto-resize class="dataGrid"  ui-grid="gridOptions['specGroupParameters']"></div>
    </span>
</spec-group-edit>
<sweet-confirm id="sweetConfirm"
on-confirmproductdelete="$ctrl.deleteProductFromLocation(product, location, pIndex, locIndex)"
on-confirmlocationdelete="$ctrl.deleteLocation(location)"
on-confirmrequestdelete="$ctrl.cancelRequest()"
on-canbecancelledproductfromlocation="$ctrl.canBeCancelledProductFromLocation(location, productId)"
on-canbecancelledlocation="$ctrl.canBeCancelledLocation(locationId)"
on-canbecancelledrequest="$ctrl.sendCancelRequestAction()"
delete-data-params="$ctrl.deleteDataParams"
entity-to-delete="$ctrl.entityToDelete"></sweet-confirm>

<confirm-order-dialog class="modal fade in" id="confirm" aria-hidden="true" data-width="90%" confirmation-product-orders=$ctrl.confirmationProductOrders></confirm-order-dialog>
