{{selectedTabIndex}}
<div class="col-md-12 contract-section selected-product-container" style="margin-left: 0px;">
    <div class="col-md-12 no-padding d-flex" style="top: 10px;">
      <div class="header-product-details col-md-2 no-padding">
          Product details
      </div>
      <div class="contract-details-info col-md-10 no-padding" style="text-align: right;">
        <span>
          Main location
          <span class="location-contract-info">
            {{ formValues.products[selectedTabIndex] && formValues.products[selectedTabIndex].location ? formValues.products[selectedTabIndex].location.name : ''}}
          </span>
        </span>
        <span>
          Main product
          <span class="product-contract-info">
            {{ formValues.products[selectedTabIndex] && formValues.products[selectedTabIndex].product ? formValues.products[selectedTabIndex].product.name : ''}}
          </span>
        </span> 
      </div>
    </div>
    <div class="col-md-12 allowed-locations-section no-padding">
      <div [ngClass]="{'allowed-locations-container': !expandAllowLocations, 'allowed-locations-container-expand': expandAllowLocations}">
        <div class="allowed-container col-md-12 d-flex">
          <div class="allowed-list-modal-container">
              Allowed Locations
          </div>
          <div *ngIf="formValues.status && formValues.status.name == 'Confirmed'"  class="edit-allow-locations">
          </div>
          <div *ngIf="!(formValues.status && formValues.status.name == 'Confirmed')"  [matMenuTriggerFor]="menuAllowedLocations" class="edit-allow-locations">
          </div>
          <mat-menu #menuAllowedLocations="matMenu" class="allowed-locations-modal ">
            <div class="col-md-12 header-allowed-locations">
              <div class="allowed-locations-header col-md-12 contract-no-padding" >
                Allowed locations
              </div>
            </div>
            <div (click)="$event.stopPropagation();" class="col-md-12 contract-no-padding allowed-locations-line"  *ngFor="let location of selectedLocationList">
              <mat-checkbox [(ngModel)]="location.isSelected">
                {{location.name}}
              </mat-checkbox>
            </div>
            <div class="col-md-12">
              <button  class="ui-button-info mr-1 btn-i-blue-color" label="Save"
                pButton
                style="float:right"
                (click)="saveAllowedLocations(selectedTabIndex)"
                type="button"></button>
            </div>
          </mat-menu>
        </div>
        <div class="allowed-container col-md-12 d-flex">
          <div class="allowed-list" *ngIf="formValues.products">
            <ng-container  *ngFor="let allowedLocation of formValues.products[selectedTabIndex].allowedLocations"> 
              <span class="allow-location">
                <span class="dot-allow-location">
                </span>
                {{allowedLocation.name}}
              </span>
            </ng-container>
          </div>
          <div class="more-button"  (click)="expandAllowLocations = !expandAllowLocations">
            ...more
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-12 allowed-locations-section no-padding">
      <div [ngClass]="{'allowed-locations-container': !expandAllowProducts, 'allowed-locations-container-expand': expandAllowProducts}">
        <div class="allowed-container col-md-12 d-flex">
          <div class="allowed-list-modal-container">
              Allowed products
          </div>
          <div *ngIf="!(formValues.status && formValues.status.name == 'Confirmed')" [matMenuTriggerFor]="menuAllowedProducts" class="edit-allow-locations">
          </div>
          <div  *ngIf="formValues.status && formValues.status.name == 'Confirmed'" class="edit-allow-locations">
          </div>
          <mat-menu #menuAllowedProducts="matMenu" class="allowed-locations-modal ">
            <div class="col-md-12 header-allowed-locations">
              <div class="allowed-locations-header col-md-12 contract-no-padding" >
                Allowed products
              </div>
            </div>
            <div (click)="$event.stopPropagation();" class="col-md-12 contract-no-padding allowed-locations-line"  *ngFor="let product of selectedProductList">
              <mat-checkbox [(ngModel)]="product.isSelected">
                {{product.name}}
              </mat-checkbox>
            </div>
            <div class="col-md-12">
              <button  class="ui-button-info mr-1 btn-i-blue-color" label="Save"
                pButton
                style="float:right"
                (click)="saveAllowedProducts(selectedTabIndex)"
                type="button"></button>
            </div>
          </mat-menu>
        </div>
        <div class="allowed-container col-md-12 d-flex">
          <div class="allowed-list" *ngIf="formValues.products">
            <ng-container  *ngFor="let allowedProduct of formValues.products[selectedTabIndex].allowedProducts"> 
              <span class="allow-location">
                <span class="dot-allow-location">
                </span>
                {{allowedProduct.name}}
              </span>
            </ng-container>
          </div>
          <div class="more-button"  (click)="expandAllowProducts = !expandAllowProducts">
            ...more
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-12 no-padding contract-section d-flex">
      <div class="custom-form-field product-details" [ngClass]="{'darkTheme':switchTheme,'lightTheme':!switchTheme}">
        <div class="d-flex">
          <mat-form-field class="with-search" appearance="legacy">
            <mat-label>Spec Group</mat-label>
            <mat-select 
                [(ngModel)]="formValues.products[selectedTabIndex].specGroup"
                placeholder="Spec Group"
                [disableOptionCentering]="true"
                panelClass="general-information-select-container"
                [compareWith]="compareUomObjects"
                [disabled]="formValues.status && formValues.status.name == 'Confirmed'">
              <ng-container *ngIf="formValues.products[selectedTabIndex].product">
                <mat-option *ngFor="let option of productSpecGroup[formValues.products[selectedTabIndex].product.id]" [value]="option">
                  {{option.name}}
              </mat-option>
              </ng-container>
          </mat-select>
          </mat-form-field>
          <div [ngClass]="{'search-icon-disabled': formValues.status && formValues.status.name == 'Confirmed'}"
             class="search-icon" (click)="(formValues.status && formValues.status.name == 'Confirmed') ? '' : openSpecGroupPopUp(formValues.products[selectedTabIndex])">
            <div class="img"></div>
          </div>
        </div>
      </div>
      <div class="custom-form-field product-details" [ngClass]="{'darkTheme':switchTheme,'lightTheme':!switchTheme}">
        <div class="d-flex">
            <mat-form-field class="with-search" appearance="legacy">
                <mat-label>Supplier</mat-label>
                <input class="free-text-field" 
                      [(ngModel)]="formValues.products[selectedTabIndex].physicalSuppliers[0]"
                      type="text"
                      matInput 
                      [matAutocomplete]="auto1"
                      placeholder="Supplier"
                      [disabled]="formValues.status && formValues.status.name == 'Confirmed'">
                <mat-autocomplete #auto1="matAutocomplete" 
                                    class="darkPanelAuto"
                                    [displayWith]="displayFn">
                    <mat-option *ngFor="let physicalSupplier of filterPhysicalSupplierList()" 
                            [value]="physicalSupplier">
                        {{physicalSupplier.name}}
                    </mat-option>
                </mat-autocomplete>
            </mat-form-field>
            <button class="search-icon"
              [disabled]="formValues.status && formValues.status.name == 'Confirmed'" 
              [ngClass]="{'search-icon-disabled': formValues.status && formValues.status.name == 'Confirmed'}" 
                appMasterSelectorTrigger [masterSelector]="masterSelector1" #masterSelectorTrigger1="masterSelectorTrigger" [header]="getHeaderNameSelector1()">
                <div class="img">
                  <ng-template cdkPortal #masterSelector1="cdkPortal" >
                      <shiptech-shared-master-selector (selectedChange)="selectorPhysicalSupplierSelectionChange($event); masterSelectorTrigger1.close()" (shouldCloseModal)="masterSelectorTrigger1.close()" [selectorType]="autocompletePhysicalSupplier"
                                                      [disabled]="disabled"
                                                      [readonly]="readonly"
                                                      [entityName]="entityName"
                                                      [entityId]="entityId"
                                                      [vesselId]="vesselId"
                                                      [headerName]="getHeaderNameSelector1()"
                      ></shiptech-shared-master-selector>
                  </ng-template> 
                </div>
            </button>
        </div>
      </div>
      <div class="custom-form-field product-details" 
          [ngClass]="{'darkTheme':switchTheme,'lightTheme':!switchTheme}">
        <mat-form-field class="without-search" 
            [ngClass]="{'date-invalid': isDealDateInvalid , 'date-valid': !isDealDateInvalid}"
            appearance="legacy">
          <mat-label>Deal Date</mat-label>
          <input [(ngModel)]="formValues.products[selectedTabIndex].dealDate" 
                #validToDateField="ngModel" 
                matInput 
                [disabled]="formValues.status && formValues.status.name == 'Confirmed'"
                [matDatepicker]="dealDate"
                (focus)="dealDate.open()"
                autocomplete="off"
                placeholder="Deal Date"
                (dateInput)="onChange($event, 'dealDate')"
                (dateChange)="formValues.products[selectedTabIndex].dealDate = formatDateForBe(formValues.products[selectedTabIndex].dealDate)">
                <mat-datepicker-toggle matSuffix [for]="dealDate">
                  <mat-icon matDatepickerToggleIcon class="icon-date">
                  </mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #dealDate [panelClass]="switchTheme?'datepicker-darktheme':''"></mat-datepicker>
        </mat-form-field>
      </div>
    </div>
    <div class="header-product-details col-md-12 no-padding" style="margin-top: 10px;">
      Product conversion factors
    </div>
    <div class="col-md-12 no-padding">
      <table class="product-details-table table table-stripped table-hover" style="width:100%">
        <thead>
          <tr>
              <td class="padding" style="width:20%">
                <b>Product</b>
              </td>
              <td class="padding" style="width:20%">
                <b>Mass Uom</b>
              </td>
              <td class="padding" style="width:20%">
                <b>Volume Uom</b>
              </td>
              <td class="padding" style="width:20%">
                <b>Conversion factor</b>
              </td>
              <td class="padding" style="width:20%">
                <b>Conversion value</b>
              </td>
          </tr>
        </thead>
        <tbody>
            <ng-container  *ngFor="let conversionFactor of formValues.products[selectedTabIndex].conversionFactors">
              <tr *ngIf="!conversionFactor.isDeleted">
                <td class="padding-left"  style="width:20%">
                  {{conversionFactor.product.name}}
                </td>
                <td  style="width:20%">
                  <div class="custom-form-field conversion-factor-info" [ngClass]="{'darkTheme':switchTheme,'lightTheme':!switchTheme}">
                    <mat-form-field *ngIf="conversionFactor.contractConversionFactorOptions.id == 1"
                      class="without-search conversion-factor-dropdown-component" appearance="legacy">
                      <mat-select 
                          [disableOptionCentering]="true"
                          panelClass="general-information-select-container"
                          [disabled]="true">
                          <mat-option *ngFor="let option of []" [value]="option">
                              {{option.name}}
                          </mat-option>
                      </mat-select>
                    </mat-form-field>
                    <mat-form-field  *ngIf="conversionFactor.contractConversionFactorOptions.id != 1"
                      class="without-search conversion-factor-dropdown-component" appearance="legacy">
                      <mat-select 
                          [(ngModel)]="conversionFactor.massUom"
                          [disableOptionCentering]="true"
                          panelClass="general-information-select-container"
                          [compareWith]="compareUomObjects"
                          (selectionChange)="saveConversionFactors(conversionFactor, false)"
                          [disabled]="conversionFactor.contractConversionFactorOptions.id == 3 || (formValues.hasInvoicedOrder && conversionFactor.contractConversionFactorOptions.id == 2)">
                          <mat-option *ngFor="let option of uomMassList" [value]="option">
                              {{option.name}}
                          </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </td> 
                <td  style="width:20%">
                  <div class="custom-form-field conversion-factor-info" [ngClass]="{'darkTheme':switchTheme,'lightTheme':!switchTheme}">
                    <mat-form-field *ngIf="conversionFactor.contractConversionFactorOptions.id == 1"
                      class="without-search conversion-factor-dropdown-component" appearance="legacy">
                      <mat-select 
                            [disableOptionCentering]="true"
                            panelClass="general-information-select-container"
                            [disabled]="true">
                          <mat-option *ngFor="let option of []" [value]="option">
                              {{option.name}}
                          </mat-option>
                      </mat-select>
                    </mat-form-field>
                    <mat-form-field *ngIf="conversionFactor.contractConversionFactorOptions.id != 1"
                      class="without-search conversion-factor-dropdown-component" appearance="legacy">
                      <mat-select 
                            [(ngModel)]="conversionFactor.volumeUom"
                            [disableOptionCentering]="true"
                            panelClass="general-information-select-container"
                            [compareWith]="compareUomObjects"
                            (selectionChange)="saveConversionFactors(conversionFactor, false)"
                            [disabled]="conversionFactor.contractConversionFactorOptions.id == 3 || (formValues.hasInvoicedOrder && conversionFactor.contractConversionFactorOptions.id == 2)">
                          <mat-option *ngFor="let option of uomVolumeList" [value]="option">
                              {{option.name}}
                          </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </td> 
                <td  style="width:20%">
                  <div class="custom-form-field conversion-factor-info" [ngClass]="{'darkTheme':switchTheme,'lightTheme':!switchTheme}">
                    <mat-form-field class="without-search conversion-factor-dropdown-component" appearance="legacy">
                      <mat-select 
                            [(ngModel)]="conversionFactor.contractConversionFactorOptions"
                            [disableOptionCentering]="true"
                            panelClass="general-information-select-container"
                            [compareWith]="compareUomObjects"
                            (selectionChange)="saveConversionFactors(conversionFactor, true)"
                            [disabled]="formValues.hasInvoicedOrder">
                          <mat-option *ngFor="let option of contractConversionFactorOptions" [value]="option">
                              {{option.name}}
                          </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </td> 
                <td style="width:20%">
                  <div class="custom-form-field conversion-factor-info" [ngClass]="{'darkTheme':switchTheme,'lightTheme':!switchTheme}">
                    <mat-form-field *ngIf="conversionFactor.contractConversionFactorOptions.id == 1" 
                      class="without-search" appearance="legacy">
                      <input  
                          matInput 
                          autocomplete="off"
                          [disabled]="true">
                    </mat-form-field>
                    <mat-form-field *ngIf="conversionFactor.contractConversionFactorOptions.id != 1" 
                      class="without-search" appearance="legacy">
                      <input  
                          [(ngModel)]="conversionFactor.value"
                          matInput 
                          autocomplete="off"
                          (blur)="saveConversionFactors(conversionFactor, false)"
                          [disabled]="conversionFactor.contractConversionFactorOptions.id == 3 || (formValues.hasInvoicedOrder && conversionFactor.contractConversionFactorOptions.id == 2)">
                    </mat-form-field>
                </div>
                </td>
                
              </tr>
            </ng-container>
        </tbody>
      </table>
    </div>
<div>
<ngx-spinner
  bdColor="rgba(51,51,51,0.8)"
  size="medium"
  color="#fff"
  type="ball-spin-clockwise-fade">
</ngx-spinner>
  